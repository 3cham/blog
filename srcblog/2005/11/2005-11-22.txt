Date: 2005-11-22 06:28:46
Format: wphtml
Title: Unix for masochists, or the art of e-mail forwarding with procmail

 Unix is for truly masochistic. Consider my recent adventures of setting up something as trivial as e-mail forwarding. All I wanted is that e-mail delivered to my Unix account was kept locally as well as forwarded to my gmail account (reading e-mail in pine over ssh connection isn't as fun as it sounds).<br> <br> Knowing nothing I had to google for information, armed only with one keyword: sendmail. I google, I read here and there and I get to know about .forward file and procmail. So I create the setup cobbled together from several different places:<br> <br> $HOME/.forward is:<br> <blockquote>"|exec /usr/bin/procmail || exit 75"<br> </blockquote> <br> $HOME/.procmailrc is:<br> <blockquote>PATH=/bin:/usr/bin:/usr/local/bin<br> MAILDIR=$HOME/mail<br> PMDIR=$HOME/.procmail<br> LOGFILE=$PMDIR/log<br> INCLUDERC=$PMDIR/general.rc<br> </blockquote> <br> $HOME/.procmail/general.rc is:<br> <blockquote>:0 c<br> *<br> ! my-gmail-account@gmail.com<br>   <br> :0<br> *<br> $DEFAULT<br> </blockquote> It took me, literally, hours of reading, debugging and trying different variations of this stuff.<br> <br> But that's not everything. Before my battle was over I had to fix two other problems.<br> <br> First, my sendmail uses smsrh i.e. restricted shell, for very noble security reasons. That means that it can't see /usr/bin/procmail in .forward. The fix is simple:<br> <blockquote>cd /etc/smsrh<br> ln -s /usr/bin/procmail procmail<br> </blockquote> Of course, to arrive at this fix I first had to happen to figure out sendmail's error message from bounced e-mail and google for the exact message to figure out how to fix it.<br> <br> The other problem is that if I didn't have root privileges on this box I wouldn't be able to fix it all.<br> <br> But, as Steve Jobs likes to say, there was one more thing. It turns out procmail is very picky about file permissions. For good reasons, I'm sure, but it doesn't change the fact that it's another thing I had to figure out from log files and google for. The fix (from <a title="http://www.ii.com/internet/robots/procmail/qs/#forward" href="http://www.ii.com/internet/robots/procmail/qs/#forward">http://www.ii.com/internet/robots/procmail/qs/#forward</a>):<br> <blockquote>cd $HOME<br>   <span style="text-decoration: underline;"></span>chmod go-w,a+x .<br> chmod go-w .procmailrc<br> chmod 644 .forward<span style="font-family: verdana;"></span><br>   <span style="font-family: verdana;"></span></blockquote> <br>And all I wanted is to have my e-mail forwarded. All it takes on Exchange-based system is a creation of server-side rule using a simple UI interface from within Outlook.
 