
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type=text/css> 
pre,code {font-size:9pt; font:Consolas,Monaco,"Courier New","DejaVu Sans Mono","Bitstream Vera Sans Mono",monospace;}
.c { background-color: #96EBA6; }
</style>
</head>
<body>
<pre><a href="index.html">Home</a> : csharp\src\impl\AltBtree.cs</pre>
<table cellpadding="0" cellspacing="0">
<tbody>
  <tr>
  <td style="margin:0px; vertical-align:top">
  <pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
<span>7</span>
<span>8</span>
<span>9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span>
<span>22</span>
<span>23</span>
<span>24</span>
<span>25</span>
<span>26</span>
<span>27</span>
<span>28</span>
<span>29</span>
<span>30</span>
<span>31</span>
<span>32</span>
<span>33</span>
<span>34</span>
<span>35</span>
<span>36</span>
<span>37</span>
<span>38</span>
<span>39</span>
<span>40</span>
<span>41</span>
<span>42</span>
<span>43</span>
<span>44</span>
<span>45</span>
<span>46</span>
<span>47</span>
<span>48</span>
<span>49</span>
<span>50</span>
<span>51</span>
<span>52</span>
<span>53</span>
<span>54</span>
<span>55</span>
<span>56</span>
<span>57</span>
<span>58</span>
<span>59</span>
<span>60</span>
<span>61</span>
<span>62</span>
<span>63</span>
<span>64</span>
<span>65</span>
<span>66</span>
<span>67</span>
<span>68</span>
<span>69</span>
<span>70</span>
<span>71</span>
<span>72</span>
<span>73</span>
<span>74</span>
<span>75</span>
<span>76</span>
<span>77</span>
<span>78</span>
<span>79</span>
<span>80</span>
<span>81</span>
<span>82</span>
<span>83</span>
<span>84</span>
<span>85</span>
<span>86</span>
<span>87</span>
<span>88</span>
<span>89</span>
<span>90</span>
<span>91</span>
<span>92</span>
<span>93</span>
<span>94</span>
<span>95</span>
<span>96</span>
<span>97</span>
<span>98</span>
<span>99</span>
<span>100</span>
<span>101</span>
<span>102</span>
<span>103</span>
<span>104</span>
<span>105</span>
<span>106</span>
<span>107</span>
<span>108</span>
<span>109</span>
<span>110</span>
<span>111</span>
<span>112</span>
<span>113</span>
<span>114</span>
<span>115</span>
<span>116</span>
<span>117</span>
<span>118</span>
<span>119</span>
<span>120</span>
<span>121</span>
<span>122</span>
<span>123</span>
<span>124</span>
<span>125</span>
<span>126</span>
<span>127</span>
<span>128</span>
<span>129</span>
<span>130</span>
<span>131</span>
<span>132</span>
<span>133</span>
<span>134</span>
<span>135</span>
<span>136</span>
<span>137</span>
<span>138</span>
<span>139</span>
<span>140</span>
<span>141</span>
<span>142</span>
<span>143</span>
<span>144</span>
<span>145</span>
<span>146</span>
<span>147</span>
<span>148</span>
<span>149</span>
<span>150</span>
<span>151</span>
<span>152</span>
<span>153</span>
<span>154</span>
<span>155</span>
<span>156</span>
<span>157</span>
<span>158</span>
<span>159</span>
<span>160</span>
<span>161</span>
<span>162</span>
<span>163</span>
<span>164</span>
<span>165</span>
<span>166</span>
<span>167</span>
<span>168</span>
<span>169</span>
<span>170</span>
<span>171</span>
<span>172</span>
<span>173</span>
<span>174</span>
<span>175</span>
<span>176</span>
<span>177</span>
<span>178</span>
<span>179</span>
<span>180</span>
<span>181</span>
<span>182</span>
<span>183</span>
<span>184</span>
<span>185</span>
<span>186</span>
<span>187</span>
<span>188</span>
<span>189</span>
<span>190</span>
<span>191</span>
<span>192</span>
<span>193</span>
<span>194</span>
<span>195</span>
<span>196</span>
<span>197</span>
<span>198</span>
<span>199</span>
<span>200</span>
<span>201</span>
<span>202</span>
<span>203</span>
<span>204</span>
<span>205</span>
<span>206</span>
<span>207</span>
<span>208</span>
<span>209</span>
<span>210</span>
<span>211</span>
<span>212</span>
<span>213</span>
<span>214</span>
<span>215</span>
<span>216</span>
<span>217</span>
<span>218</span>
<span>219</span>
<span>220</span>
<span>221</span>
<span>222</span>
<span>223</span>
<span>224</span>
<span>225</span>
<span>226</span>
<span>227</span>
<span>228</span>
<span>229</span>
<span>230</span>
<span>231</span>
<span>232</span>
<span>233</span>
<span>234</span>
<span>235</span>
<span>236</span>
<span>237</span>
<span>238</span>
<span>239</span>
<span>240</span>
<span>241</span>
<span>242</span>
<span>243</span>
<span>244</span>
<span>245</span>
<span>246</span>
<span>247</span>
<span>248</span>
<span>249</span>
<span>250</span>
<span>251</span>
<span>252</span>
<span>253</span>
<span>254</span>
<span>255</span>
<span>256</span>
<span>257</span>
<span>258</span>
<span>259</span>
<span>260</span>
<span>261</span>
<span>262</span>
<span>263</span>
<span>264</span>
<span>265</span>
<span>266</span>
<span>267</span>
<span>268</span>
<span>269</span>
<span>270</span>
<span>271</span>
<span>272</span>
<span>273</span>
<span>274</span>
<span>275</span>
<span>276</span>
<span>277</span>
<span>278</span>
<span>279</span>
<span>280</span>
<span>281</span>
<span>282</span>
<span>283</span>
<span>284</span>
<span>285</span>
<span>286</span>
<span>287</span>
<span>288</span>
<span>289</span>
<span>290</span>
<span>291</span>
<span>292</span>
<span>293</span>
<span>294</span>
<span>295</span>
<span>296</span>
<span>297</span>
<span>298</span>
<span>299</span>
<span>300</span>
<span>301</span>
<span>302</span>
<span>303</span>
<span>304</span>
<span>305</span>
<span>306</span>
<span>307</span>
<span>308</span>
<span>309</span>
<span>310</span>
<span>311</span>
<span>312</span>
<span>313</span>
<span>314</span>
<span>315</span>
<span>316</span>
<span>317</span>
<span>318</span>
<span>319</span>
<span>320</span>
<span>321</span>
<span>322</span>
<span>323</span>
<span>324</span>
<span>325</span>
<span>326</span>
<span>327</span>
<span>328</span>
<span>329</span>
<span>330</span>
<span>331</span>
<span>332</span>
<span>333</span>
<span>334</span>
<span>335</span>
<span>336</span>
<span>337</span>
<span>338</span>
<span>339</span>
<span>340</span>
<span>341</span>
<span>342</span>
<span>343</span>
<span>344</span>
<span>345</span>
<span>346</span>
<span>347</span>
<span>348</span>
<span>349</span>
<span>350</span>
<span>351</span>
<span>352</span>
<span>353</span>
<span>354</span>
<span>355</span>
<span>356</span>
<span>357</span>
<span>358</span>
<span>359</span>
<span>360</span>
<span>361</span>
<span>362</span>
<span>363</span>
<span>364</span>
<span>365</span>
<span>366</span>
<span>367</span>
<span>368</span>
<span>369</span>
<span>370</span>
<span>371</span>
<span>372</span>
<span>373</span>
<span>374</span>
<span>375</span>
<span>376</span>
<span>377</span>
<span>378</span>
<span>379</span>
<span>380</span>
<span>381</span>
<span>382</span>
<span>383</span>
<span>384</span>
<span>385</span>
<span>386</span>
<span>387</span>
<span>388</span>
<span>389</span>
<span>390</span>
<span>391</span>
<span>392</span>
<span>393</span>
<span>394</span>
<span>395</span>
<span>396</span>
<span>397</span>
<span>398</span>
<span>399</span>
<span>400</span>
<span>401</span>
<span>402</span>
<span>403</span>
<span>404</span>
<span>405</span>
<span>406</span>
<span>407</span>
<span>408</span>
<span>409</span>
<span>410</span>
<span>411</span>
<span>412</span>
<span>413</span>
<span>414</span>
<span>415</span>
<span>416</span>
<span>417</span>
<span>418</span>
<span>419</span>
<span>420</span>
<span>421</span>
<span>422</span>
<span>423</span>
<span>424</span>
<span>425</span>
<span>426</span>
<span>427</span>
<span>428</span>
<span>429</span>
<span>430</span>
<span>431</span>
<span>432</span>
<span>433</span>
<span>434</span>
<span>435</span>
<span>436</span>
<span>437</span>
<span>438</span>
<span>439</span>
<span>440</span>
<span>441</span>
<span>442</span>
<span>443</span>
<span>444</span>
<span>445</span>
<span>446</span>
<span>447</span>
<span>448</span>
<span>449</span>
<span>450</span>
<span>451</span>
<span>452</span>
<span>453</span>
<span>454</span>
<span>455</span>
<span>456</span>
<span>457</span>
<span>458</span>
<span>459</span>
<span>460</span>
<span>461</span>
<span>462</span>
<span>463</span>
<span>464</span>
<span>465</span>
<span>466</span>
<span>467</span>
<span>468</span>
<span>469</span>
<span>470</span>
<span>471</span>
<span>472</span>
<span>473</span>
<span>474</span>
<span>475</span>
<span>476</span>
<span>477</span>
<span>478</span>
<span>479</span>
<span>480</span>
<span>481</span>
<span>482</span>
<span>483</span>
<span>484</span>
<span>485</span>
<span>486</span>
<span>487</span>
<span>488</span>
<span>489</span>
<span>490</span>
<span>491</span>
<span>492</span>
<span>493</span>
<span>494</span>
<span>495</span>
<span>496</span>
<span>497</span>
<span>498</span>
<span>499</span>
<span>500</span>
<span>501</span>
<span>502</span>
<span>503</span>
<span>504</span>
<span>505</span>
<span>506</span>
<span>507</span>
<span>508</span>
<span>509</span>
<span>510</span>
<span>511</span>
<span>512</span>
<span>513</span>
<span>514</span>
<span>515</span>
<span>516</span>
<span>517</span>
<span>518</span>
<span>519</span>
<span>520</span>
<span>521</span>
<span>522</span>
<span>523</span>
<span>524</span>
<span>525</span>
<span>526</span>
<span>527</span>
<span>528</span>
<span>529</span>
<span>530</span>
<span>531</span>
<span>532</span>
<span>533</span>
<span>534</span>
<span>535</span>
<span>536</span>
<span>537</span>
<span>538</span>
<span>539</span>
<span>540</span>
<span>541</span>
<span>542</span>
<span>543</span>
<span>544</span>
<span>545</span>
<span>546</span>
<span>547</span>
<span>548</span>
<span>549</span>
<span>550</span>
<span>551</span>
<span>552</span>
<span>553</span>
<span>554</span>
<span>555</span>
<span>556</span>
<span>557</span>
<span>558</span>
<span>559</span>
<span>560</span>
<span>561</span>
<span>562</span>
<span>563</span>
<span>564</span>
<span>565</span>
<span>566</span>
<span>567</span>
<span>568</span>
<span>569</span>
<span>570</span>
<span>571</span>
<span>572</span>
<span>573</span>
<span>574</span>
<span>575</span>
<span>576</span>
<span>577</span>
<span>578</span>
<span>579</span>
<span>580</span>
<span>581</span>
<span>582</span>
<span>583</span>
<span>584</span>
<span>585</span>
<span>586</span>
<span>587</span>
<span>588</span>
<span>589</span>
<span>590</span>
<span>591</span>
<span>592</span>
<span>593</span>
<span>594</span>
<span>595</span>
<span>596</span>
<span>597</span>
<span>598</span>
<span>599</span>
<span>600</span>
<span>601</span>
<span>602</span>
<span>603</span>
<span>604</span>
<span>605</span>
<span>606</span>
<span>607</span>
<span>608</span>
<span>609</span>
<span>610</span>
<span>611</span>
<span>612</span>
<span>613</span>
<span>614</span>
<span>615</span>
<span>616</span>
<span>617</span>
<span>618</span>
<span>619</span>
<span>620</span>
<span>621</span>
<span>622</span>
<span>623</span>
<span>624</span>
<span>625</span>
<span>626</span>
<span>627</span>
<span>628</span>
<span>629</span>
<span>630</span>
<span>631</span>
<span>632</span>
<span>633</span>
<span>634</span>
<span>635</span>
<span>636</span>
<span>637</span>
<span>638</span>
<span>639</span>
<span>640</span>
<span>641</span>
<span>642</span>
<span>643</span>
<span>644</span>
<span>645</span>
<span>646</span>
<span>647</span>
<span>648</span>
<span>649</span>
<span>650</span>
<span>651</span>
<span>652</span>
<span>653</span>
<span>654</span>
<span>655</span>
<span>656</span>
<span>657</span>
<span>658</span>
<span>659</span>
<span>660</span>
<span>661</span>
<span>662</span>
<span>663</span>
<span>664</span>
<span>665</span>
<span>666</span>
<span>667</span>
<span>668</span>
<span>669</span>
<span>670</span>
<span>671</span>
<span>672</span>
<span>673</span>
<span>674</span>
<span>675</span>
<span>676</span>
<span>677</span>
<span>678</span>
<span>679</span>
<span>680</span>
<span>681</span>
<span>682</span>
<span>683</span>
<span>684</span>
<span>685</span>
<span>686</span>
<span>687</span>
<span>688</span>
<span>689</span>
<span>690</span>
<span>691</span>
<span>692</span>
<span>693</span>
<span>694</span>
<span>695</span>
<span>696</span>
<span>697</span>
<span>698</span>
<span>699</span>
<span>700</span>
<span>701</span>
<span>702</span>
<span>703</span>
<span>704</span>
<span>705</span>
<span>706</span>
<span>707</span>
<span>708</span>
<span>709</span>
<span>710</span>
<span>711</span>
<span>712</span>
<span>713</span>
<span>714</span>
<span>715</span>
<span>716</span>
<span>717</span>
<span>718</span>
<span>719</span>
<span>720</span>
<span>721</span>
<span>722</span>
<span>723</span>
<span>724</span>
<span>725</span>
<span>726</span>
<span>727</span>
<span>728</span>
<span>729</span>
<span>730</span>
<span>731</span>
<span>732</span>
<span>733</span>
<span>734</span>
<span>735</span>
<span>736</span>
<span>737</span>
<span>738</span>
<span>739</span>
<span>740</span>
<span>741</span>
<span>742</span>
<span>743</span>
<span>744</span>
<span>745</span>
<span>746</span>
<span>747</span>
<span>748</span>
<span>749</span>
<span>750</span>
<span>751</span>
<span>752</span>
<span>753</span>
<span>754</span>
<span>755</span>
<span>756</span>
<span>757</span>
<span>758</span>
<span>759</span>
<span>760</span>
<span>761</span>
<span>762</span>
<span>763</span>
<span>764</span>
<span>765</span>
<span>766</span>
<span>767</span>
<span>768</span>
<span>769</span>
<span>770</span>
<span>771</span>
<span>772</span>
<span>773</span>
<span>774</span>
<span>775</span>
<span>776</span>
<span>777</span>
<span>778</span>
<span>779</span>
<span>780</span>
<span>781</span>
<span>782</span>
<span>783</span>
<span>784</span>
<span>785</span>
<span>786</span>
<span>787</span>
<span>788</span>
<span>789</span>
<span>790</span>
<span>791</span>
<span>792</span>
<span>793</span>
<span>794</span>
<span>795</span>
<span>796</span>
<span>797</span>
<span>798</span>
<span>799</span>
<span>800</span>
<span>801</span>
<span>802</span>
<span>803</span>
<span>804</span>
<span>805</span>
<span>806</span>
<span>807</span>
<span>808</span>
<span>809</span>
<span>810</span>
<span>811</span>
<span>812</span>
<span>813</span>
<span>814</span>
<span>815</span>
<span>816</span>
<span>817</span>
<span>818</span>
<span>819</span>
<span>820</span>
<span>821</span>
<span>822</span>
<span>823</span>
<span>824</span>
<span>825</span>
<span>826</span>
<span>827</span>
<span>828</span>
<span>829</span>
<span>830</span>
<span>831</span>
<span>832</span>
<span>833</span>
<span>834</span>
<span>835</span>
<span>836</span>
<span>837</span>
<span>838</span>
<span>839</span>
<span>840</span>
<span>841</span>
<span>842</span>
<span>843</span>
<span>844</span>
<span>845</span>
<span>846</span>
<span>847</span>
<span>848</span>
<span>849</span>
<span>850</span>
<span>851</span>
<span>852</span>
<span>853</span>
<span>854</span>
<span>855</span>
<span>856</span>
<span>857</span>
<span>858</span>
<span>859</span>
<span>860</span>
<span>861</span>
<span>862</span>
<span>863</span>
<span>864</span>
<span>865</span>
<span>866</span>
<span>867</span>
<span>868</span>
<span>869</span>
<span>870</span>
<span>871</span>
<span>872</span>
<span>873</span>
<span>874</span>
<span>875</span>
<span>876</span>
<span>877</span>
<span>878</span>
<span>879</span>
<span>880</span>
<span>881</span>
<span>882</span>
<span>883</span>
<span>884</span>
<span>885</span>
<span>886</span>
<span>887</span>
<span>888</span>
<span>889</span>
<span>890</span>
<span>891</span>
<span>892</span>
<span>893</span>
<span>894</span>
<span>895</span>
<span>896</span>
<span>897</span>
<span>898</span>
<span>899</span>
<span>900</span>
<span>901</span>
<span>902</span>
<span>903</span>
<span>904</span>
<span>905</span>
<span>906</span>
<span>907</span>
<span>908</span>
<span>909</span>
<span>910</span>
<span>911</span>
<span>912</span>
<span>913</span>
<span>914</span>
<span>915</span>
<span>916</span>
<span>917</span>
<span>918</span>
<span>919</span>
<span>920</span>
<span>921</span>
<span>922</span>
<span>923</span>
<span>924</span>
<span>925</span>
<span>926</span>
<span>927</span>
<span>928</span>
<span>929</span>
<span>930</span>
<span>931</span>
<span>932</span>
<span>933</span>
<span>934</span>
<span>935</span>
<span>936</span>
<span>937</span>
<span>938</span>
<span>939</span>
<span>940</span>
<span>941</span>
<span>942</span>
<span>943</span>
<span>944</span>
<span>945</span>
<span>946</span>
<span>947</span>
<span>948</span>
<span>949</span>
<span>950</span>
<span>951</span>
<span>952</span>
<span>953</span>
<span>954</span>
<span>955</span>
<span>956</span>
<span>957</span>
<span>958</span>
<span>959</span>
<span>960</span>
<span>961</span>
<span>962</span>
<span>963</span>
<span>964</span>
<span>965</span>
<span>966</span>
<span>967</span>
<span>968</span>
<span>969</span>
<span>970</span>
<span>971</span>
<span>972</span>
<span>973</span>
<span>974</span>
<span>975</span>
<span>976</span>
<span>977</span>
<span>978</span>
<span>979</span>
<span>980</span>
<span>981</span>
<span>982</span>
<span>983</span>
<span>984</span>
<span>985</span>
<span>986</span>
<span>987</span>
<span>988</span>
<span>989</span>
<span>990</span>
<span>991</span>
<span>992</span>
<span>993</span>
<span>994</span>
<span>995</span>
<span>996</span>
<span>997</span>
<span>998</span>
<span>999</span>
<span>1000</span>
<span>1001</span>
<span>1002</span>
<span>1003</span>
<span>1004</span>
<span>1005</span>
<span>1006</span>
<span>1007</span>
<span>1008</span>
<span>1009</span>
<span>1010</span>
<span>1011</span>
<span>1012</span>
<span>1013</span>
<span>1014</span>
<span>1015</span>
<span>1016</span>
<span>1017</span>
<span>1018</span>
<span>1019</span>
<span>1020</span>
<span>1021</span>
<span>1022</span>
<span>1023</span>
<span>1024</span>
<span>1025</span>
<span>1026</span>
<span>1027</span>
<span>1028</span>
<span>1029</span>
<span>1030</span>
<span>1031</span>
<span>1032</span>
<span>1033</span>
<span>1034</span>
<span>1035</span>
<span>1036</span>
<span>1037</span>
<span>1038</span>
<span>1039</span>
<span>1040</span>
<span>1041</span>
<span>1042</span>
<span>1043</span>
<span>1044</span>
<span>1045</span>
<span>1046</span>
<span>1047</span>
<span>1048</span>
<span>1049</span>
<span>1050</span>
<span>1051</span>
<span>1052</span>
<span>1053</span>
<span>1054</span>
<span>1055</span>
<span>1056</span>
<span>1057</span>
<span>1058</span>
<span>1059</span>
<span>1060</span>
<span>1061</span>
<span>1062</span>
<span>1063</span>
<span>1064</span>
<span>1065</span>
<span>1066</span>
<span>1067</span>
<span>1068</span>
<span>1069</span>
<span>1070</span>
<span>1071</span>
<span>1072</span>
<span>1073</span>
<span>1074</span>
<span>1075</span>
<span>1076</span>
<span>1077</span>
<span>1078</span>
<span>1079</span>
<span>1080</span>
<span>1081</span>
<span>1082</span>
<span>1083</span>
<span>1084</span>
<span>1085</span>
<span>1086</span>
<span>1087</span>
<span>1088</span>
<span>1089</span>
<span>1090</span>
<span>1091</span>
<span>1092</span>
<span>1093</span>
<span>1094</span>
<span>1095</span>
<span>1096</span>
<span>1097</span>
<span>1098</span>
<span>1099</span>
<span>1100</span>
<span>1101</span>
<span>1102</span>
<span>1103</span>
<span>1104</span>
<span>1105</span>
<span>1106</span>
<span>1107</span>
<span>1108</span>
<span>1109</span>
<span>1110</span>
<span>1111</span>
<span>1112</span>
<span>1113</span>
<span>1114</span>
<span>1115</span>
<span>1116</span>
<span>1117</span>
<span>1118</span>
<span>1119</span>
<span>1120</span>
<span>1121</span>
<span>1122</span>
<span>1123</span>
<span>1124</span>
<span>1125</span>
<span>1126</span>
<span>1127</span>
<span>1128</span>
<span>1129</span>
<span>1130</span>
<span>1131</span>
<span>1132</span>
<span>1133</span>
<span>1134</span>
<span>1135</span>
<span>1136</span>
<span>1137</span>
<span>1138</span>
<span>1139</span>
<span>1140</span>
<span>1141</span>
<span>1142</span>
<span>1143</span>
<span>1144</span>
<span>1145</span>
<span>1146</span>
<span>1147</span>
<span>1148</span>
<span>1149</span>
<span>1150</span>
<span>1151</span>
<span>1152</span>
<span>1153</span>
<span>1154</span>
<span>1155</span>
<span>1156</span>
<span>1157</span>
<span>1158</span>
<span>1159</span>
<span>1160</span>
<span>1161</span>
<span>1162</span>
<span>1163</span>
<span>1164</span>
<span>1165</span>
<span>1166</span>
<span>1167</span>
<span>1168</span>
<span>1169</span>
<span>1170</span>
<span>1171</span>
<span>1172</span>
<span>1173</span>
<span>1174</span>
<span>1175</span>
<span>1176</span>
<span>1177</span>
<span>1178</span>
<span>1179</span>
<span>1180</span>
<span>1181</span>
<span>1182</span>
<span>1183</span>
<span>1184</span>
<span>1185</span>
<span>1186</span>
<span>1187</span>
<span>1188</span>
<span>1189</span>
<span>1190</span>
<span>1191</span>
<span>1192</span>
<span>1193</span>
<span>1194</span>
<span>1195</span>
<span>1196</span>
<span>1197</span>
<span>1198</span>
<span>1199</span>
<span>1200</span>
<span>1201</span>
<span>1202</span>
<span>1203</span>
<span>1204</span>
<span>1205</span>
<span>1206</span>
<span>1207</span>
<span>1208</span>
<span>1209</span>
<span>1210</span>
<span>1211</span>
<span>1212</span>
<span>1213</span>
<span>1214</span>
<span>1215</span>
<span>1216</span>
<span>1217</span>
<span>1218</span>
<span>1219</span>
<span>1220</span>
<span>1221</span>
<span>1222</span>
<span>1223</span>
<span>1224</span>
<span>1225</span>
<span>1226</span>
<span>1227</span>
<span>1228</span>
<span>1229</span>
<span>1230</span>
<span>1231</span>
<span>1232</span>
<span>1233</span>
<span>1234</span>
<span>1235</span>
<span>1236</span>
<span>1237</span>
<span>1238</span>
<span>1239</span>
<span>1240</span>
<span>1241</span>
<span>1242</span>
<span>1243</span>
<span>1244</span>
<span>1245</span>
<span>1246</span>
<span>1247</span>
<span>1248</span>
<span>1249</span>
<span>1250</span>
<span>1251</span>
<span>1252</span>
<span>1253</span>
<span>1254</span>
<span>1255</span>
<span>1256</span>
<span>1257</span>
<span>1258</span>
<span>1259</span>
<span>1260</span>
<span>1261</span>
<span>1262</span>
<span>1263</span>
<span>1264</span>
<span>1265</span>
<span>1266</span>
<span>1267</span>
<span>1268</span>
<span>1269</span>
<span>1270</span>
<span>1271</span>
<span>1272</span>
<span>1273</span>
<span>1274</span>
<span>1275</span>
<span>1276</span>
<span>1277</span>
<span>1278</span>
<span>1279</span>
<span>1280</span>
<span>1281</span>
<span>1282</span>
<span>1283</span>
<span>1284</span>
<span>1285</span>
<span>1286</span>
<span>1287</span>
<span>1288</span>
<span>1289</span>
<span>1290</span>
<span>1291</span>
<span>1292</span>
<span>1293</span>
<span>1294</span>
<span>1295</span>
<span>1296</span>
<span>1297</span>
<span>1298</span>
<span>1299</span>
<span>1300</span>
<span>1301</span>
<span>1302</span>
<span>1303</span>
<span>1304</span>
<span>1305</span>
<span>1306</span>
<span>1307</span>
<span>1308</span>
<span>1309</span>
<span>1310</span>
<span>1311</span>
<span>1312</span>
<span>1313</span>
<span>1314</span>
<span>1315</span>
<span>1316</span>
<span>1317</span>
<span>1318</span>
<span>1319</span>
<span>1320</span>
<span>1321</span>
<span>1322</span>
<span>1323</span>
<span>1324</span>
<span>1325</span>
<span>1326</span>
<span>1327</span>
<span>1328</span>
<span>1329</span>
<span>1330</span>
<span>1331</span>
<span>1332</span>
<span>1333</span>
<span>1334</span>
<span>1335</span>
<span>1336</span>
<span>1337</span>
<span>1338</span>
<span>1339</span>
<span>1340</span>
<span>1341</span>
<span>1342</span>
<span>1343</span>
<span>1344</span>
<span>1345</span>
<span>1346</span>
<span>1347</span>
<span>1348</span>
<span>1349</span>
<span>1350</span>
<span>1351</span>
<span>1352</span>
<span>1353</span>
<span>1354</span>
<span>1355</span>
<span>1356</span>
<span>1357</span>
<span>1358</span>
<span>1359</span>
<span>1360</span>
<span>1361</span>
<span>1362</span>
<span>1363</span>
<span>1364</span>
<span>1365</span>
<span>1366</span>
<span>1367</span>
<span>1368</span>
<span>1369</span>
<span>1370</span>
<span>1371</span>
<span>1372</span>
<span>1373</span>
<span>1374</span>
<span>1375</span>
<span>1376</span>
<span>1377</span>
<span>1378</span>
<span>1379</span>
<span>1380</span>
<span>1381</span>
<span>1382</span>
<span>1383</span>
<span>1384</span>
<span>1385</span>
<span>1386</span>
<span>1387</span>
<span>1388</span>
<span>1389</span>
<span>1390</span>
<span>1391</span>
<span>1392</span>
<span>1393</span>
<span>1394</span>
<span>1395</span>
<span>1396</span>
<span>1397</span>
<span>1398</span>
<span>1399</span>
<span>1400</span>
<span>1401</span>
<span>1402</span>
<span>1403</span>
<span>1404</span>
<span>1405</span>
<span>1406</span>
<span>1407</span>
<span>1408</span>
<span>1409</span>
<span>1410</span>
<span>1411</span>
<span>1412</span>
<span>1413</span>
<span>1414</span>
<span>1415</span>
<span>1416</span>
<span>1417</span>
<span>1418</span>
<span>1419</span>
<span>1420</span>
<span>1421</span>
<span>1422</span>
<span>1423</span>
<span>1424</span>
<span>1425</span>
<span>1426</span>
<span>1427</span>
<span>1428</span>
<span>1429</span>
<span>1430</span>
<span>1431</span>
<span>1432</span>
<span>1433</span>
<span>1434</span>
<span>1435</span>
<span>1436</span>
<span>1437</span>
<span>1438</span>
<span>1439</span>
<span>1440</span>
<span>1441</span>
<span>1442</span>
<span>1443</span>
<span>1444</span>
<span>1445</span>
<span>1446</span>
<span>1447</span>
<span>1448</span>
<span>1449</span>
<span>1450</span>
<span>1451</span>
<span>1452</span>
<span>1453</span>
<span>1454</span>
<span>1455</span>
<span>1456</span>
<span>1457</span>
<span>1458</span>
<span>1459</span>
<span>1460</span>
<span>1461</span>
<span>1462</span>
<span>1463</span>
<span>1464</span>
<span>1465</span>
<span>1466</span>
<span>1467</span>
<span>1468</span>
<span>1469</span>
<span>1470</span>
<span>1471</span>
<span>1472</span>
<span>1473</span>
<span>1474</span>
<span>1475</span>
<span>1476</span>
<span>1477</span>
<span>1478</span>
<span>1479</span>
<span>1480</span>
<span>1481</span>
<span>1482</span>
<span>1483</span>
<span>1484</span>
<span>1485</span>
<span>1486</span>
<span>1487</span>
<span>1488</span>
<span>1489</span>
<span>1490</span>
<span>1491</span>
<span>1492</span>
<span>1493</span>
<span>1494</span>
<span>1495</span>
<span>1496</span>
<span>1497</span>
<span>1498</span>
<span>1499</span>
<span>1500</span>
<span>1501</span>
<span>1502</span>
<span>1503</span>
<span>1504</span>
<span>1505</span>
<span>1506</span>
<span>1507</span>
<span>1508</span>
<span>1509</span>
<span>1510</span>
<span>1511</span>
<span>1512</span>
<span>1513</span>
<span>1514</span>
<span>1515</span>
<span>1516</span>
<span>1517</span>
<span>1518</span>
<span>1519</span>
<span>1520</span>
<span>1521</span>
<span>1522</span>
<span>1523</span>
<span>1524</span>
<span>1525</span>
<span>1526</span>
<span>1527</span>
<span>1528</span>
<span>1529</span>
<span>1530</span>
<span>1531</span>
<span>1532</span>
<span>1533</span>
<span>1534</span>
<span>1535</span>
<span>1536</span>
<span>1537</span>
<span>1538</span>
<span>1539</span>
<span>1540</span>
<span>1541</span>
<span>1542</span>
<span>1543</span>
<span>1544</span>
<span>1545</span>
<span>1546</span>
<span>1547</span>
<span>1548</span>
<span>1549</span>
<span>1550</span>
<span>1551</span>
<span>1552</span>
<span>1553</span>
<span>1554</span>
<span>1555</span>
<span>1556</span>
<span>1557</span>
<span>1558</span>
<span>1559</span>
<span>1560</span>
<span>1561</span>
<span>1562</span>
<span>1563</span>
<span>1564</span>
<span>1565</span>
<span>1566</span>
<span>1567</span>
<span>1568</span>
<span>1569</span>
<span>1570</span>
<span>1571</span>
<span>1572</span>
<span>1573</span>
<span>1574</span>
<span>1575</span>
<span>1576</span>
<span>1577</span>
<span>1578</span>
<span>1579</span>
<span>1580</span>
<span>1581</span>
<span>1582</span>
<span>1583</span>
<span>1584</span>
<span>1585</span>
<span>1586</span>
<span>1587</span>
<span>1588</span>
<span>1589</span>
<span>1590</span>
<span>1591</span>
<span>1592</span>
<span>1593</span>
<span>1594</span>
<span>1595</span>
<span>1596</span>
<span>1597</span>
<span>1598</span>
<span>1599</span>
<span>1600</span>
<span>1601</span>
<span>1602</span>
<span>1603</span>
<span>1604</span>
<span>1605</span>
<span>1606</span>
<span>1607</span>
<span>1608</span>
<span>1609</span>
<span>1610</span>
<span>1611</span>
<span>1612</span>
<span>1613</span>
<span>1614</span>
<span>1615</span>
<span>1616</span>
<span>1617</span>
<span>1618</span>
<span>1619</span>
<span>1620</span>
<span>1621</span>
<span>1622</span>
<span>1623</span>
<span>1624</span>
<span>1625</span>
<span>1626</span>
<span>1627</span>
<span>1628</span>
<span>1629</span>
<span>1630</span>
<span>1631</span>
<span>1632</span>
<span>1633</span>
<span>1634</span>
<span>1635</span>
<span>1636</span>
<span>1637</span>
<span>1638</span>
<span>1639</span>
<span>1640</span>
<span>1641</span>
<span>1642</span>
<span>1643</span>
<span>1644</span>
<span>1645</span>
<span>1646</span>
<span>1647</span>
<span>1648</span>
<span>1649</span>
<span>1650</span>
<span>1651</span>
<span>1652</span>
<span>1653</span>
<span>1654</span>
<span>1655</span>
<span>1656</span>
<span>1657</span>
<span>1658</span>
<span>1659</span>
<span>1660</span>
<span>1661</span>
<span>1662</span>
<span>1663</span>
<span>1664</span>
<span>1665</span>
<span>1666</span>
<span>1667</span>
<span>1668</span>
<span>1669</span>
<span>1670</span>
<span>1671</span>
<span>1672</span>
<span>1673</span>
<span>1674</span>
<span>1675</span>
<span>1676</span>
<span>1677</span>
<span>1678</span>
<span>1679</span>
<span>1680</span>
<span>1681</span>
<span>1682</span>
<span>1683</span>
<span>1684</span>
<span>1685</span>
<span>1686</span>
<span>1687</span>
<span>1688</span>
<span>1689</span>
<span>1690</span>
<span>1691</span>
<span>1692</span>
<span>1693</span>
<span>1694</span>
<span>1695</span>
<span>1696</span>
<span>1697</span>
<span>1698</span>
<span>1699</span>
<span>1700</span>
<span>1701</span>
<span>1702</span>
<span>1703</span>
<span>1704</span>
<span>1705</span>
<span>1706</span>
<span>1707</span>
<span>1708</span>
<span>1709</span>
<span>1710</span>
<span>1711</span>
<span>1712</span>
<span>1713</span>
<span>1714</span>
<span>1715</span>
<span>1716</span>
<span>1717</span>
<span>1718</span>
<span>1719</span>
<span>1720</span>
<span>1721</span>
<span>1722</span>
<span>1723</span>
<span>1724</span>
<span>1725</span>
<span>1726</span>
<span>1727</span>
<span>1728</span>
<span>1729</span>
<span>1730</span>
<span>1731</span>
<span>1732</span>
<span>1733</span>
<span>1734</span>
<span>1735</span>
<span>1736</span>
<span>1737</span>
<span>1738</span>
<span>1739</span>
<span>1740</span>
<span>1741</span>
<span>1742</span>
<span>1743</span>
<span>1744</span>
<span>1745</span>
<span>1746</span>
<span>1747</span>
<span>1748</span>
<span>1749</span>
<span>1750</span>
<span>1751</span>
<span>1752</span>
<span>1753</span>
<span>1754</span>
<span>1755</span>
<span>1756</span>
<span>1757</span>
<span>1758</span>
<span>1759</span>
<span>1760</span>
<span>1761</span>
<span>1762</span>
<span>1763</span>
<span>1764</span>
<span>1765</span>
<span>1766</span>
<span>1767</span>
<span>1768</span>
<span>1769</span>
<span>1770</span>
<span>1771</span>
<span>1772</span>
<span>1773</span>
<span>1774</span>
<span>1775</span>
<span>1776</span>
<span>1777</span>
<span>1778</span>
<span>1779</span>
<span>1780</span>
<span>1781</span>
<span>1782</span>
<span>1783</span>
<span>1784</span>
<span>1785</span>
<span>1786</span>
<span>1787</span>
<span>1788</span>
<span>1789</span>
<span>1790</span>
<span>1791</span>
<span>1792</span>
<span>1793</span>
<span>1794</span>
<span>1795</span>
<span>1796</span>
<span>1797</span>
<span>1798</span>
<span>1799</span>
<span>1800</span>
<span>1801</span>
<span>1802</span>
<span>1803</span>
<span>1804</span>
<span>1805</span>
<span>1806</span>
<span>1807</span>
<span>1808</span>
<span>1809</span>
<span>1810</span>
<span>1811</span>
<span>1812</span>
<span>1813</span>
<span>1814</span>
<span>1815</span>
<span>1816</span>
<span>1817</span>
<span>1818</span>
<span>1819</span>
<span>1820</span>
<span>1821</span>
<span>1822</span>
<span>1823</span>
<span>1824</span>
<span>1825</span>
<span>1826</span>
<span>1827</span>
<span>1828</span>
<span>1829</span>
<span>1830</span>
<span>1831</span>
<span>1832</span>
<span>1833</span>
<span>1834</span>
<span>1835</span>
<span>1836</span>
<span>1837</span>
<span>1838</span>
<span>1839</span>
<span>1840</span>
<span>1841</span>
<span>1842</span>
<span>1843</span>
<span>1844</span>
<span>1845</span>
<span>1846</span>
<span>1847</span>
<span>1848</span>
<span>1849</span>
<span>1850</span>
<span>1851</span>
<span>1852</span>
<span>1853</span>
<span>1854</span>
<span>1855</span>
<span>1856</span>
<span>1857</span>
<span>1858</span>
<span>1859</span>
<span>1860</span>
<span>1861</span>
<span>1862</span>
<span>1863</span>
<span>1864</span>
<span>1865</span>
<span>1866</span>
<span>1867</span>
<span>1868</span>
<span>1869</span>
<span>1870</span>
<span>1871</span>
<span>1872</span>
<span>1873</span>
<span>1874</span>
<span>1875</span>
<span>1876</span>
<span>1877</span>
<span>1878</span>
<span>1879</span>
<span>1880</span>
<span>1881</span>
<span>1882</span>
<span>1883</span>
<span>1884</span>
<span>1885</span>
<span>1886</span>
<span>1887</span>
<span>1888</span>
<span>1889</span>
<span>1890</span>
<span>1891</span>
<span>1892</span>
<span>1893</span>
<span>1894</span>
<span>1895</span>
<span>1896</span>
<span>1897</span>
<span>1898</span>
<span>1899</span>
<span>1900</span>
<span>1901</span>
<span>1902</span>
<span>1903</span>
<span>1904</span>
<span>1905</span>
<span>1906</span>
<span>1907</span>
<span>1908</span>
<span>1909</span>
<span>1910</span>
<span>1911</span>
<span>1912</span>
<span>1913</span>
<span>1914</span>
<span>1915</span>
<span>1916</span>
<span>1917</span>
<span>1918</span>
<span>1919</span>
<span>1920</span>
<span>1921</span>
<span>1922</span>
<span>1923</span>
<span>1924</span>
<span>1925</span>
<span>1926</span>
<span>1927</span>
<span>1928</span>
<span>1929</span>
<span>1930</span>
<span>1931</span>
<span>1932</span>
<span>1933</span>
<span>1934</span>
<span>1935</span>
<span>1936</span>
<span>1937</span>
<span>1938</span>
<span>1939</span>
<span>1940</span>
<span>1941</span>
<span>1942</span>
<span>1943</span>
<span>1944</span>
<span>1945</span>
<span>1946</span>
<span>1947</span>
<span>1948</span>
<span>1949</span>
<span>1950</span>
<span>1951</span>
<span>1952</span>
<span>1953</span>
<span>1954</span>
<span>1955</span>
<span>1956</span>
<span>1957</span>
<span>1958</span>
<span>1959</span>
<span>1960</span>
<span>1961</span>
<span>1962</span>
<span>1963</span>
<span>1964</span>
<span>1965</span>
<span>1966</span>
<span>1967</span>
<span>1968</span>
<span>1969</span>
<span>1970</span>
<span>1971</span>
<span>1972</span>
<span>1973</span>
<span>1974</span>
<span>1975</span>
<span>1976</span>
<span>1977</span>
<span>1978</span>
<span>1979</span>
<span>1980</span>
<span>1981</span>
<span>1982</span>
<span>1983</span>
<span>1984</span>
<span>1985</span>
<span>1986</span>
<span>1987</span>
<span>1988</span>
<span>1989</span>
<span>1990</span>
<span>1991</span>
<span>1992</span>
<span>1993</span>
<span>1994</span>
<span>1995</span>
<span>1996</span>
<span>1997</span>
<span>1998</span>
<span>1999</span>
<span>2000</span>
<span>2001</span>
<span>2002</span>
<span>2003</span>
<span>2004</span>
<span>2005</span>
<span>2006</span>
<span>2007</span>
<span>2008</span>
<span>2009</span>
<span>2010</span>
<span>2011</span>
<span>2012</span>
<span>2013</span>
<span>2014</span>
<span>2015</span>
<span>2016</span>
<span>2017</span>
<span>2018</span>
<span>2019</span>
<span>2020</span>
<span>2021</span>
<span>2022</span>
<span>2023</span>
<span>2024</span>
<span>2025</span>
<span>2026</span>
<span>2027</span>
<span>2028</span>
<span>2029</span>
<span>2030</span>
<span>2031</span>
<span>2032</span>
<span>2033</span>
<span>2034</span>
<span>2035</span>
<span>2036</span>
<span>2037</span>
<span>2038</span>
<span>2039</span>
<span>2040</span>
<span>2041</span>
<span>2042</span>
<span>2043</span>
<span>2044</span>
<span>2045</span>
<span>2046</span>
<span>2047</span>
<span>2048</span>
<span>2049</span>
<span>2050</span>
<span>2051</span>
<span>2052</span>
<span>2053</span>
<span>2054</span>
<span>2055</span>
<span>2056</span>
<span>2057</span>
<span>2058</span>
<span>2059</span>
<span>2060</span>
<span>2061</span>
<span>2062</span>
<span>2063</span>
<span>2064</span>
<span>2065</span>
<span>2066</span>
<span>2067</span>
<span>2068</span>
<span>2069</span>
<span>2070</span>
<span>2071</span>
<span>2072</span>
<span>2073</span>
<span>2074</span>
<span>2075</span>
<span>2076</span>
<span>2077</span>
<span>2078</span>
<span>2079</span>
<span>2080</span>
<span>2081</span>
<span>2082</span>
<span>2083</span>
<span>2084</span>
<span>2085</span>
<span>2086</span>
<span>2087</span>
<span>2088</span>
<span>2089</span>
<span>2090</span>
<span>2091</span>
<span>2092</span>
<span>2093</span>
<span>2094</span>
<span>2095</span>
<span>2096</span>
<span>2097</span>
<span>2098</span>
<span>2099</span>
<span>2100</span>
<span>2101</span>
<span>2102</span>
<span>2103</span>
<span>2104</span>
<span>2105</span>
<span>2106</span>
<span>2107</span>
<span>2108</span>
<span>2109</span>
<span>2110</span>
<span>2111</span>
<span>2112</span>
<span>2113</span>
<span>2114</span>
<span>2115</span>
<span>2116</span>
<span>2117</span>
<span>2118</span>
<span>2119</span>
<span>2120</span>
<span>2121</span>
<span>2122</span>
<span>2123</span>
<span>2124</span>
<span>2125</span>
<span>2126</span>
<span>2127</span>
<span>2128</span>
<span>2129</span>
<span>2130</span>
<span>2131</span>
<span>2132</span>
<span>2133</span>
<span>2134</span>
<span>2135</span>
<span>2136</span>
<span>2137</span>
<span>2138</span>
<span>2139</span>
<span>2140</span>
<span>2141</span>
<span>2142</span>
<span>2143</span>
<span>2144</span>
<span>2145</span>
<span>2146</span>
<span>2147</span>
<span>2148</span>
<span>2149</span>
<span>2150</span>
<span>2151</span>
<span>2152</span>
<span>2153</span>
<span>2154</span>
<span>2155</span>
<span>2156</span>
<span>2157</span>
<span>2158</span>
<span>2159</span>
<span>2160</span>
<span>2161</span>
<span>2162</span>
<span>2163</span>
<span>2164</span>
<span>2165</span>
<span>2166</span>
<span>2167</span>
<span>2168</span>
<span>2169</span>
<span>2170</span>
<span>2171</span>
<span>2172</span>
<span>2173</span>
<span>2174</span>
<span>2175</span>
<span>2176</span>
<span>2177</span>
<span>2178</span>
<span>2179</span>
<span>2180</span>
<span>2181</span>
<span>2182</span>
<span>2183</span>
<span>2184</span>
<span>2185</span>
<span>2186</span>
<span>2187</span>
<span>2188</span>
<span>2189</span>
<span>2190</span>
<span>2191</span>
<span>2192</span>
<span>2193</span>
<span>2194</span>
<span>2195</span>
<span>2196</span>
<span>2197</span>
<span>2198</span>
<span>2199</span>
<span>2200</span>
<span>2201</span>
<span>2202</span>
<span>2203</span>
<span>2204</span>
<span>2205</span>
<span>2206</span>
<span>2207</span>
<span>2208</span>
<span>2209</span>
<span>2210</span>
<span>2211</span>
<span>2212</span>
<span>2213</span>
<span>2214</span>
<span>2215</span>
<span>2216</span>
<span>2217</span>
<span>2218</span>
<span>2219</span>
<span>2220</span>
<span>2221</span>
<span>2222</span>
<span>2223</span>
<span>2224</span>
<span>2225</span>
<span>2226</span>
<span>2227</span>
<span>2228</span>
<span>2229</span>
<span>2230</span>
<span>2231</span>
<span>2232</span>
<span>2233</span>
<span>2234</span>
<span>2235</span>
<span>2236</span>
<span>2237</span>
<span>2238</span>
<span>2239</span>
<span>2240</span>
<span>2241</span>
<span>2242</span>
<span>2243</span>
<span>2244</span>
<span>2245</span>
<span>2246</span>
<span>2247</span>
<span>2248</span>
<span>2249</span>
<span>2250</span>
<span>2251</span>
<span>2252</span>
<span>2253</span>
<span>2254</span>
<span>2255</span>
<span>2256</span>
<span>2257</span>
<span>2258</span>
<span>2259</span>
<span>2260</span>
<span>2261</span>
<span>2262</span>
<span>2263</span>
<span>2264</span>
<span>2265</span>
<span>2266</span>
<span>2267</span>
<span>2268</span>
<span>2269</span>
<span>2270</span>
<span>2271</span>
<span>2272</span>
<span>2273</span>
<span>2274</span>
<span>2275</span>
<span>2276</span>
<span>2277</span>
<span>2278</span>
<span>2279</span>
<span>2280</span>
<span>2281</span>
<span>2282</span>
<span>2283</span>
<span>2284</span>
<span>2285</span>
<span>2286</span>
<span>2287</span>
<span>2288</span>
<span>2289</span>
<span>2290</span>
<span>2291</span>
<span>2292</span>
<span>2293</span>
<span>2294</span>
<span>2295</span>
<span>2296</span>
<span>2297</span>
<span>2298</span>
<span>2299</span>
<span>2300</span>
<span>2301</span>
<span>2302</span>
<span>2303</span>
<span>2304</span>
<span>2305</span>
<span>2306</span>
<span>2307</span>
<span>2308</span>
<span>2309</span>
<span>2310</span>
<span>2311</span>
<span>2312</span>
<span>2313</span>
<span>2314</span>
<span>2315</span>
<span>2316</span>
<span>2317</span>
<span>2318</span>
<span>2319</span>
<span>2320</span>
<span>2321</span>
<span>2322</span>
<span>2323</span>
<span>2324</span>
<span>2325</span>
<span>2326</span>
<span>2327</span>
<span>2328</span>
<span>2329</span>
<span>2330</span>
<span>2331</span>
<span>2332</span>
<span>2333</span>
<span>2334</span>
<span>2335</span>
<span>2336</span>
<span>2337</span>
<span>2338</span>

  </pre>
  </td>

  <td  style="margin:0px; padding-left:8px; vertical-align:top" width="100%">
  <pre><div class="line" id="l1">namespace NachoDB.Impl
</div><div class="line" id="l2">{
</div><div class="line" id="l3">    using System;
</div><div class="line" id="l4">    using System.Collections;
</div><div class="line" id="l5">    using System.Diagnostics;
</div><div class="line" id="l6">    using NachoDB;
</div><div class="line" id="l7">    using System.Collections.Generic;
</div><div class="line" id="l8">    using Link=Link&lt;IPersistent&gt;;
</div><div class="line" id="l9"><br></div><div class="line" id="l10"><br></div><div class="line" id="l11">    class AltBtree&lt;K,V&gt; : PersistentCollection&lt;V&gt;, Index&lt;K,V&gt; where V:class, IPersistent
</div><div class="line" id="l12">    {
</div><div class="line" id="l13">        public Type KeyType
</div><div class="line" id="l14">        {
</div><div class="line" id="l15">            get
</div><div class="line" id="l16">            {
</div><div class="line" id="l17">                return typeof(K);
</div><div class="line" id="l18">            }            
</div><div class="line" id="l19">        }
</div><div class="line" id="l20">        internal int height;
</div><div class="line" id="l21">        internal ClassDescriptor.FieldType type;
</div><div class="line" id="l22">        internal int nElems;
</div><div class="line" id="l23">        internal bool unique;
</div><div class="line" id="l24">        internal BtreePage root;
</div><div class="line" id="l25"><br></div><div class="line" id="l26">        [NonSerialized()]
</div><div class="line" id="l27">        internal int updateCounter;
</div><div class="line" id="l28"><br></div><div class="line" id="l29">        <span class="c">internal AltBtree()</span></div><div class="line" id="l30">        {
</div><div class="line" id="l31">        <span class="c">}</span></div><div class="line" id="l32"><br></div><div class="line" id="l33">        public override void OnLoad()
</div><div class="line" id="l34">        {
</div><div class="line" id="l35">             <span class="c">if (type != ClassDescriptor.getTypeCode(typeof(K)))</span> {</div><div class="line" id="l36">                <span class="c">throw new StorageError(StorageError.ErrorCode.INCOMPATIBLE_KEY_TYPE, typeof(K));</span></div><div class="line" id="l37">            }
</div><div class="line" id="l38">        <span class="c">}</span></div><div class="line" id="l39"><br></div><div class="line" id="l40">        internal class BtreeKey
</div><div class="line" id="l41">        {
</div><div class="line" id="l42">            internal Key key;
</div><div class="line" id="l43">            internal IPersistent node;
</div><div class="line" id="l44">            internal IPersistent oldNode;
</div><div class="line" id="l45"><br></div><div class="line" id="l46">            <span class="c">internal BtreeKey(Key key, IPersistent node)</span></div><div class="line" id="l47">            {
</div><div class="line" id="l48">                <span class="c">this.key = key;</span></div><div class="line" id="l49">                <span class="c">this.node = node;</span></div><div class="line" id="l50">            <span class="c">}</span></div><div class="line" id="l51">        }
</div><div class="line" id="l52"><br></div><div class="line" id="l53">        internal abstract class BtreePage : Persistent
</div><div class="line" id="l54">        {
</div><div class="line" id="l55">            internal abstract Array Data{get;}
</div><div class="line" id="l56">            internal int nItems;
</div><div class="line" id="l57">            internal Link items;
</div><div class="line" id="l58"><br></div><div class="line" id="l59">            internal const int BTREE_PAGE_SIZE = Page.pageSize - ObjectHeader.Sizeof - 4 * 3;
</div><div class="line" id="l60"><br></div><div class="line" id="l61">            internal abstract object getKeyValue(int i);
</div><div class="line" id="l62">            internal abstract Key getKey(int i);
</div><div class="line" id="l63">            internal abstract int compare(Key key, int i);
</div><div class="line" id="l64">            internal abstract void  insert(BtreeKey key, int i);
</div><div class="line" id="l65">            internal abstract BtreePage clonePage();
</div><div class="line" id="l66"><br></div><div class="line" id="l67">            internal virtual void  clearKeyValue(int i)
</div><div class="line" id="l68">            {
</div><div class="line" id="l69">            }
</div><div class="line" id="l70"><br></div><div class="line" id="l71">            internal virtual bool find(Key firstKey, Key lastKey, int height, ArrayList result)
</div><div class="line" id="l72">            {
</div><div class="line" id="l73">                <span class="c">int l = 0,</span> <span class="c">n = nItems,</span> <span class="c">r = n;</span></div><div class="line" id="l74">                <span class="c">height -= 1;</span></div><div class="line" id="l75">                <span class="c">if (firstKey != null)</span></div><div class="line" id="l76">                {
</div><div class="line" id="l77">                    <span class="c">while (l &lt; r)</span></div><div class="line" id="l78">                    {
</div><div class="line" id="l79">                        <span class="c">int i = (l + r) &gt;&gt; 1;</span></div><div class="line" id="l80">                        <span class="c">if (compare(firstKey, i) &gt;= firstKey.inclusion)</span></div><div class="line" id="l81">                        {
</div><div class="line" id="l82">                            <span class="c">l = i + 1;</span></div><div class="line" id="l83">                        }
</div><div class="line" id="l84">                        else
</div><div class="line" id="l85">                        {
</div><div class="line" id="l86">                            <span class="c">r = i;</span></div><div class="line" id="l87">                        }
</div><div class="line" id="l88">                    }
</div><div class="line" id="l89">                    Debug.Assert(r == l);
</div><div class="line" id="l90">                }
</div><div class="line" id="l91">                <span class="c">if (lastKey != null)</span></div><div class="line" id="l92">                {
</div><div class="line" id="l93">                    <span class="c">if (height == 0)</span></div><div class="line" id="l94">                    {
</div><div class="line" id="l95">                        <span class="c">while (l &lt; n)</span></div><div class="line" id="l96">                        {
</div><div class="line" id="l97">                            <span class="c">if (-compare(lastKey, l) &gt;= lastKey.inclusion)</span></div><div class="line" id="l98">                            {
</div><div class="line" id="l99">                                <span class="c">return false;</span></div><div class="line" id="l100">                            }
</div><div class="line" id="l101">                            <span class="c">result.Add(items[l]);</span></div><div class="line" id="l102">                            <span class="c">l += 1;</span></div><div class="line" id="l103">                        }
</div><div class="line" id="l104">                        <span class="c">return true;</span></div><div class="line" id="l105">                    }
</div><div class="line" id="l106">                    else
</div><div class="line" id="l107">                    {
</div><div class="line" id="l108">                        do 
</div><div class="line" id="l109">                        {
</div><div class="line" id="l110">                            <span class="c">if (!((BtreePage) items[l]).find(firstKey, lastKey, height, result))</span></div><div class="line" id="l111">                            {
</div><div class="line" id="l112">                                <span class="c">return false;</span></div><div class="line" id="l113">                            }
</div><div class="line" id="l114">                            <span class="c">if (l == n)</span></div><div class="line" id="l115">                            {
</div><div class="line" id="l116">                                <span class="c">return true;</span></div><div class="line" id="l117">                            }
</div><div class="line" id="l118">                        }
</div><div class="line" id="l119">                        <span class="c">while (compare(lastKey, l++) &gt;= 0);</span></div><div class="line" id="l120">                        <span class="c">return false;</span></div><div class="line" id="l121">                    }
</div><div class="line" id="l122">                }
</div><div class="line" id="l123">                <span class="c">if (height == 0)</span></div><div class="line" id="l124">                {
</div><div class="line" id="l125">                    <span class="c">while (l &lt; n)</span></div><div class="line" id="l126">                    {
</div><div class="line" id="l127">                        <span class="c">result.Add(items[l]);</span></div><div class="line" id="l128">                        <span class="c">l += 1;</span></div><div class="line" id="l129">                    }
</div><div class="line" id="l130">                }
</div><div class="line" id="l131">                else
</div><div class="line" id="l132">                {
</div><div class="line" id="l133">                    do 
</div><div class="line" id="l134">                    {
</div><div class="line" id="l135">                        <span class="c">if (!((BtreePage) items[l]).find(firstKey, lastKey, height, result))</span></div><div class="line" id="l136">                        {
</div><div class="line" id="l137">                            <span class="c">return false;</span></div><div class="line" id="l138">                        }
</div><div class="line" id="l139">                    }
</div><div class="line" id="l140">                    <span class="c">while (++l &lt;= n);</span></div><div class="line" id="l141">                }
</div><div class="line" id="l142">                <span class="c">return true;</span></div><div class="line" id="l143">            }
</div><div class="line" id="l144"><br></div><div class="line" id="l145">            internal static void  memcpyData(BtreePage dst_pg, int dst_idx, BtreePage src_pg, int src_idx, int len)
</div><div class="line" id="l146">            {
</div><div class="line" id="l147">                <span class="c">Array.Copy(src_pg.Data, src_idx, dst_pg.Data, dst_idx, len);</span></div><div class="line" id="l148">            <span class="c">}</span></div><div class="line" id="l149"><br></div><div class="line" id="l150">            internal static void  memcpyItems(BtreePage dst_pg, int dst_idx, BtreePage src_pg, int src_idx, int len)
</div><div class="line" id="l151">            {
</div><div class="line" id="l152">                <span class="c">Array.Copy(src_pg.items.ToRawArray(), src_idx, dst_pg.items.ToRawArray(), dst_idx, len);</span></div><div class="line" id="l153">            <span class="c">}</span></div><div class="line" id="l154"><br></div><div class="line" id="l155">            internal static void  memcpy(BtreePage dst_pg, int dst_idx, BtreePage src_pg, int src_idx, int len)
</div><div class="line" id="l156">            {
</div><div class="line" id="l157">                <span class="c">memcpyData(dst_pg, dst_idx, src_pg, src_idx, len);</span></div><div class="line" id="l158">                <span class="c">memcpyItems(dst_pg, dst_idx, src_pg, src_idx, len);</span></div><div class="line" id="l159">            <span class="c">}</span></div><div class="line" id="l160"><br></div><div class="line" id="l161">            internal virtual void  memset(int i, int len)
</div><div class="line" id="l162">            {
</div><div class="line" id="l163">                while (--len &gt;= 0)
</div><div class="line" id="l164">                {
</div><div class="line" id="l165">                    items[i++] = null;
</div><div class="line" id="l166">                }
</div><div class="line" id="l167">            }
</div><div class="line" id="l168"><br></div><div class="line" id="l169">            internal virtual OperationResult insert(BtreeKey ins, int height, bool unique, bool overwrite)
</div><div class="line" id="l170">            {
</div><div class="line" id="l171">                OperationResult result;
</div><div class="line" id="l172">                <span class="c">int l = 0,</span> <span class="c">n = nItems,</span> <span class="c">r = n;</span></div><div class="line" id="l173">                <span class="c">while (l &lt; r)</span></div><div class="line" id="l174">                {
</div><div class="line" id="l175">                    <span class="c">int i = (l + r) &gt;&gt; 1;</span></div><div class="line" id="l176">                    <span class="c">if (compare(ins.key, i) &gt; 0)</span></div><div class="line" id="l177">                    {
</div><div class="line" id="l178">                        <span class="c">l = i + 1;</span></div><div class="line" id="l179">                    }
</div><div class="line" id="l180">                    else
</div><div class="line" id="l181">                    {
</div><div class="line" id="l182">                        <span class="c">r = i;</span></div><div class="line" id="l183">                    }
</div><div class="line" id="l184">                }
</div><div class="line" id="l185">                Debug.Assert(l == r);
</div><div class="line" id="l186">                /* insert before e[r] */
</div><div class="line" id="l187">                <span class="c">if (--height != 0)</span></div><div class="line" id="l188">                {
</div><div class="line" id="l189">                    <span class="c">result = ((BtreePage) items[r]).insert(ins, height, unique, overwrite);</span></div><div class="line" id="l190">                    Debug.Assert(result != OperationResult.NotFound);
</div><div class="line" id="l191">                    <span class="c">if (result != OperationResult.Overflow)</span></div><div class="line" id="l192">                    {
</div><div class="line" id="l193">                        <span class="c">return result;</span></div><div class="line" id="l194">                    }
</div><div class="line" id="l195">                    <span class="c">n += 1;</span></div><div class="line" id="l196">                }
</div><div class="line" id="l197">                else <span class="c">if (r &lt; n &amp;&amp; compare(ins.key, r) == 0)</span></div><div class="line" id="l198">                {
</div><div class="line" id="l199">                    <span class="c">if (overwrite)</span></div><div class="line" id="l200">                    {
</div><div class="line" id="l201">                        <span class="c">ins.oldNode = items[r];</span></div><div class="line" id="l202">                        <span class="c">Modify();</span></div><div class="line" id="l203">                        <span class="c">items[r] = ins.node;</span></div><div class="line" id="l204">                        <span class="c">return OperationResult.Overwrite;</span></div><div class="line" id="l205">                    }
</div><div class="line" id="l206">                    else <span class="c">if (unique)</span></div><div class="line" id="l207">                    {
</div><div class="line" id="l208">                        <span class="c">ins.oldNode = items[r];</span></div><div class="line" id="l209">                        <span class="c">return OperationResult.Duplicate;</span></div><div class="line" id="l210">                    }
</div><div class="line" id="l211">                }
</div><div class="line" id="l212">                <span class="c">int max = items.Length;</span></div><div class="line" id="l213">                <span class="c">Modify();</span></div><div class="line" id="l214">                <span class="c">if (n &lt; max)</span></div><div class="line" id="l215">                {
</div><div class="line" id="l216">                    <span class="c">memcpy(this, r + 1, this, r, n - r);</span></div><div class="line" id="l217">                    <span class="c">insert(ins, r);</span></div><div class="line" id="l218">                    <span class="c">nItems += 1;</span></div><div class="line" id="l219">                    <span class="c">return OperationResult.Done;</span></div><div class="line" id="l220">                }
</div><div class="line" id="l221">                else
</div><div class="line" id="l222">                {
</div><div class="line" id="l223">                    /* page is full then divide page */
</div><div class="line" id="l224">                    <span class="c">BtreePage b = clonePage();</span></div><div class="line" id="l225">                    Debug.Assert(n == max);
</div><div class="line" id="l226">                    <span class="c">int m = max / 2;</span></div><div class="line" id="l227">                    <span class="c">if (r &lt; m)</span></div><div class="line" id="l228">                    {
</div><div class="line" id="l229">                        <span class="c">memcpy(b, 0, this, 0, r);</span></div><div class="line" id="l230">                        <span class="c">memcpy(b, r + 1, this, r, m - r - 1);</span></div><div class="line" id="l231">                        <span class="c">memcpy(this, 0, this, m - 1, max - m + 1);</span></div><div class="line" id="l232">                        <span class="c">b.insert(ins, r);</span></div><div class="line" id="l233">                    }
</div><div class="line" id="l234">                    else
</div><div class="line" id="l235">                    {
</div><div class="line" id="l236">                        <span class="c">memcpy(b, 0, this, 0, m);</span></div><div class="line" id="l237">                        <span class="c">memcpy(this, 0, this, m, r - m);</span></div><div class="line" id="l238">                        <span class="c">memcpy(this, r - m + 1, this, r, max - r);</span></div><div class="line" id="l239">                        <span class="c">insert(ins, r - m);</span></div><div class="line" id="l240">                    }
</div><div class="line" id="l241">                    <span class="c">memset(max - m + 1, m - 1);</span></div><div class="line" id="l242">                    <span class="c">ins.node = b;</span></div><div class="line" id="l243">                    <span class="c">ins.key = b.getKey(m - 1);</span></div><div class="line" id="l244">                    <span class="c">if (height == 0)</span></div><div class="line" id="l245">                    {
</div><div class="line" id="l246">                        <span class="c">nItems = max - m + 1;</span></div><div class="line" id="l247">                        <span class="c">b.nItems = m;</span></div><div class="line" id="l248">                    }
</div><div class="line" id="l249">                    else
</div><div class="line" id="l250">                    {
</div><div class="line" id="l251">                        <span class="c">b.clearKeyValue(m - 1);</span></div><div class="line" id="l252">                        <span class="c">nItems = max - m;</span></div><div class="line" id="l253">                        <span class="c">b.nItems = m - 1;</span></div><div class="line" id="l254">                    }
</div><div class="line" id="l255">                    <span class="c">return OperationResult.Overflow;</span></div><div class="line" id="l256">                }
</div><div class="line" id="l257">            }
</div><div class="line" id="l258"><br></div><div class="line" id="l259">            internal virtual OperationResult handlePageUnderflow(int r, BtreeKey rem, int height)
</div><div class="line" id="l260">            {
</div><div class="line" id="l261">                BtreePage a = (BtreePage) items[r];
</div><div class="line" id="l262">                a.Modify();
</div><div class="line" id="l263">                Modify();
</div><div class="line" id="l264">                int an = a.nItems;
</div><div class="line" id="l265">                if (r &lt; nItems)
</div><div class="line" id="l266">                {
</div><div class="line" id="l267">                    // exists greater page
</div><div class="line" id="l268">                    BtreePage b = (BtreePage) items[r + 1];
</div><div class="line" id="l269">                    int bn = b.nItems;
</div><div class="line" id="l270">                    Debug.Assert(bn &gt;= an);
</div><div class="line" id="l271">                    if (height != 1)
</div><div class="line" id="l272">                    {
</div><div class="line" id="l273">                        memcpyData(a, an, this, r, 1);
</div><div class="line" id="l274">                        an += 1;
</div><div class="line" id="l275">                        bn += 1;
</div><div class="line" id="l276">                    }
</div><div class="line" id="l277">                    if (an + bn &gt; items.Length)
</div><div class="line" id="l278">                    {
</div><div class="line" id="l279">                        // reallocation of nodes between pages a and b
</div><div class="line" id="l280">                        int i = bn - ((an + bn) &gt;&gt; 1);
</div><div class="line" id="l281">                        b.Modify();
</div><div class="line" id="l282">                        memcpy(a, an, b, 0, i);
</div><div class="line" id="l283">                        memcpy(b, 0, b, i, bn - i);
</div><div class="line" id="l284">                        memcpyData(this, r, a, an + i - 1, 1);
</div><div class="line" id="l285">                        if (height != 1)
</div><div class="line" id="l286">                        {
</div><div class="line" id="l287">                            a.clearKeyValue(an + i - 1);
</div><div class="line" id="l288">                        }
</div><div class="line" id="l289">                        b.memset(bn - i, i);
</div><div class="line" id="l290">                        b.nItems -= i;
</div><div class="line" id="l291">                        a.nItems += i;
</div><div class="line" id="l292">                        return OperationResult.Done;
</div><div class="line" id="l293">                    }
</div><div class="line" id="l294">                    else
</div><div class="line" id="l295">                    {
</div><div class="line" id="l296">                        // merge page b to a  
</div><div class="line" id="l297">                        memcpy(a, an, b, 0, bn);
</div><div class="line" id="l298">                        b.Deallocate();
</div><div class="line" id="l299">                        memcpyData(this, r, this, r + 1, nItems - r - 1);
</div><div class="line" id="l300">                        memcpyItems(this, r + 1, this, r + 2, nItems - r - 1);
</div><div class="line" id="l301">                        items[nItems] = null;
</div><div class="line" id="l302">                        a.nItems += bn;
</div><div class="line" id="l303">                        nItems -= 1;
</div><div class="line" id="l304">                        return nItems &lt; (items.Size() &gt;&gt; 1) ? OperationResult.Underflow : OperationResult.Done;
</div><div class="line" id="l305">                    }
</div><div class="line" id="l306">                }
</div><div class="line" id="l307">                else
</div><div class="line" id="l308">                {
</div><div class="line" id="l309">                    // page b is before a
</div><div class="line" id="l310">                    BtreePage b = (BtreePage) items[r - 1];
</div><div class="line" id="l311">                    int bn = b.nItems;
</div><div class="line" id="l312">                    Debug.Assert(bn &gt;= an);
</div><div class="line" id="l313">                    if (height != 1)
</div><div class="line" id="l314">                    {
</div><div class="line" id="l315">                        an += 1;
</div><div class="line" id="l316">                        bn += 1;
</div><div class="line" id="l317">                    }
</div><div class="line" id="l318">                    if (an + bn &gt; items.Size())
</div><div class="line" id="l319">                    {
</div><div class="line" id="l320">                        // reallocation of nodes between pages a and b
</div><div class="line" id="l321">                        int i = bn - ((an + bn) &gt;&gt; 1);
</div><div class="line" id="l322">                        b.Modify();
</div><div class="line" id="l323">                        memcpy(a, i, a, 0, an);
</div><div class="line" id="l324">                        memcpy(a, 0, b, bn - i, i);
</div><div class="line" id="l325">                        if (height != 1)
</div><div class="line" id="l326">                        {
</div><div class="line" id="l327">                            memcpyData(a, i - 1, this, r - 1, 1);
</div><div class="line" id="l328">                        }
</div><div class="line" id="l329">                        memcpyData(this, r - 1, b, bn - i - 1, 1);
</div><div class="line" id="l330">                        if (height != 1)
</div><div class="line" id="l331">                        {
</div><div class="line" id="l332">                            b.clearKeyValue(bn - i - 1);
</div><div class="line" id="l333">                        }
</div><div class="line" id="l334">                        b.memset(bn - i, i);
</div><div class="line" id="l335">                        b.nItems -= i;
</div><div class="line" id="l336">                        a.nItems += i;
</div><div class="line" id="l337">                        return OperationResult.Done;
</div><div class="line" id="l338">                    }
</div><div class="line" id="l339">                    else
</div><div class="line" id="l340">                    {
</div><div class="line" id="l341">                        // merge page b to a
</div><div class="line" id="l342">                        memcpy(a, bn, a, 0, an);
</div><div class="line" id="l343">                        memcpy(a, 0, b, 0, bn);
</div><div class="line" id="l344">                        if (height != 1)
</div><div class="line" id="l345">                        {
</div><div class="line" id="l346">                            memcpyData(a, bn - 1, this, r - 1, 1);
</div><div class="line" id="l347">                        }
</div><div class="line" id="l348">                        b.Deallocate();
</div><div class="line" id="l349">                        items[r - 1] = a;
</div><div class="line" id="l350">                        items[nItems] = null;
</div><div class="line" id="l351">                        a.nItems += bn;
</div><div class="line" id="l352">                        nItems -= 1;
</div><div class="line" id="l353">                        return nItems &lt; (items.Size() &gt;&gt; 1) ? OperationResult.Underflow : OperationResult.Done;
</div><div class="line" id="l354">                    }
</div><div class="line" id="l355">                }
</div><div class="line" id="l356">            }
</div><div class="line" id="l357"><br></div><div class="line" id="l358">            internal virtual OperationResult remove(BtreeKey rem, int height)
</div><div class="line" id="l359">            {
</div><div class="line" id="l360">                int i, n = nItems, l = 0, r = n;
</div><div class="line" id="l361"><br></div><div class="line" id="l362">                while (l &lt; r)
</div><div class="line" id="l363">                {
</div><div class="line" id="l364">                    i = (l + r) &gt;&gt; 1;
</div><div class="line" id="l365">                    if (compare(rem.key, i) &gt; 0)
</div><div class="line" id="l366">                    {
</div><div class="line" id="l367">                        l = i + 1;
</div><div class="line" id="l368">                    }
</div><div class="line" id="l369">                    else
</div><div class="line" id="l370">                    {
</div><div class="line" id="l371">                        r = i;
</div><div class="line" id="l372">                    }
</div><div class="line" id="l373">                }
</div><div class="line" id="l374">                if (--height == 0)
</div><div class="line" id="l375">                {
</div><div class="line" id="l376">                    IPersistent node = rem.node;
</div><div class="line" id="l377">                    while (r &lt; n)
</div><div class="line" id="l378">                    {
</div><div class="line" id="l379">                        if (compare(rem.key, r) == 0)
</div><div class="line" id="l380">                        {
</div><div class="line" id="l381">                            if (node == null || items.ContainsElement(r, node))
</div><div class="line" id="l382">                            {
</div><div class="line" id="l383">                                rem.oldNode = items[r];
</div><div class="line" id="l384">                                Modify();
</div><div class="line" id="l385">                                memcpy(this, r, this, r + 1, n - r - 1);
</div><div class="line" id="l386">                                nItems = --n;
</div><div class="line" id="l387">                                memset(n, 1);
</div><div class="line" id="l388">                                return n &lt; (items.Size() &gt;&gt; 1) ? OperationResult.Underflow : OperationResult.Done;
</div><div class="line" id="l389">                            }
</div><div class="line" id="l390">                        }
</div><div class="line" id="l391">                        else
</div><div class="line" id="l392">                        {
</div><div class="line" id="l393">                            break;
</div><div class="line" id="l394">                        }
</div><div class="line" id="l395">                        r += 1;
</div><div class="line" id="l396">                    }
</div><div class="line" id="l397">                    return OperationResult.NotFound;
</div><div class="line" id="l398">                }
</div><div class="line" id="l399">                do 
</div><div class="line" id="l400">                {
</div><div class="line" id="l401">                    switch (((BtreePage) items[r]).remove(rem, height))
</div><div class="line" id="l402">                    {                       
</div><div class="line" id="l403">                        case OperationResult.Underflow: 
</div><div class="line" id="l404">                            return handlePageUnderflow(r, rem, height);
</div><div class="line" id="l405"><br></div><div class="line" id="l406">                        case OperationResult.Done: 
</div><div class="line" id="l407">                            return OperationResult.Done;
</div><div class="line" id="l408">                    }
</div><div class="line" id="l409">                }
</div><div class="line" id="l410">                while (++r &lt;= n);
</div><div class="line" id="l411"><br></div><div class="line" id="l412">                return OperationResult.NotFound;
</div><div class="line" id="l413">            }
</div><div class="line" id="l414"><br></div><div class="line" id="l415">            internal virtual void purge(int height)
</div><div class="line" id="l416">            {
</div><div class="line" id="l417">                if (--height != 0)
</div><div class="line" id="l418">                {
</div><div class="line" id="l419">                    int n = nItems;
</div><div class="line" id="l420">                    do 
</div><div class="line" id="l421">                    {
</div><div class="line" id="l422">                        ((BtreePage) items[n]).purge(height);
</div><div class="line" id="l423">                    }
</div><div class="line" id="l424">                    while (--n &gt;= 0);
</div><div class="line" id="l425">                }
</div><div class="line" id="l426">                Deallocate();
</div><div class="line" id="l427">            }
</div><div class="line" id="l428"><br></div><div class="line" id="l429">            internal virtual int traverseForward(int height, IPersistent[] result, int pos)
</div><div class="line" id="l430">            {
</div><div class="line" id="l431">                int i, n = nItems;
</div><div class="line" id="l432">                if (--height != 0)
</div><div class="line" id="l433">                {
</div><div class="line" id="l434">                    for (i = 0; i &lt;= n; i++)
</div><div class="line" id="l435">                    {
</div><div class="line" id="l436">                        pos = ((BtreePage) items[i]).traverseForward(height, result, pos);
</div><div class="line" id="l437">                    }
</div><div class="line" id="l438">                }
</div><div class="line" id="l439">                else
</div><div class="line" id="l440">                {
</div><div class="line" id="l441">                    for (i = 0; i &lt; n; i++)
</div><div class="line" id="l442">                    {
</div><div class="line" id="l443">                        result[pos++] = items[i];
</div><div class="line" id="l444">                    }
</div><div class="line" id="l445">                }
</div><div class="line" id="l446">                return pos;
</div><div class="line" id="l447">            }
</div><div class="line" id="l448"><br></div><div class="line" id="l449">            <span class="c">internal BtreePage(Storage s, int n) : base(s)</span></div><div class="line" id="l450">            {
</div><div class="line" id="l451">                <span class="c">items = s.CreateLink(n);</span></div><div class="line" id="l452">                <span class="c">items.Length = n;</span></div><div class="line" id="l453">            <span class="c">}</span></div><div class="line" id="l454"><br></div><div class="line" id="l455">            <span class="c">internal BtreePage()</span></div><div class="line" id="l456">            {
</div><div class="line" id="l457">            <span class="c">}</span></div><div class="line" id="l458">        }
</div><div class="line" id="l459"><br></div><div class="line" id="l460"><br></div><div class="line" id="l461">        class BtreePageOfByte : BtreePage
</div><div class="line" id="l462">        {
</div><div class="line" id="l463">            override internal Array Data
</div><div class="line" id="l464">            {
</div><div class="line" id="l465">                get
</div><div class="line" id="l466">                {
</div><div class="line" id="l467">                    return data;
</div><div class="line" id="l468">                }
</div><div class="line" id="l469"><br></div><div class="line" id="l470">            }
</div><div class="line" id="l471"><br></div><div class="line" id="l472">            protected byte[] data;
</div><div class="line" id="l473"><br></div><div class="line" id="l474">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 1);
</div><div class="line" id="l475"><br></div><div class="line" id="l476"><br></div><div class="line" id="l477">            internal override object getKeyValue(int i)
</div><div class="line" id="l478">            {
</div><div class="line" id="l479">                return data[i];
</div><div class="line" id="l480">            }
</div><div class="line" id="l481"><br></div><div class="line" id="l482">            internal override Key getKey(int i)
</div><div class="line" id="l483">            {
</div><div class="line" id="l484">                return new Key(data[i]);
</div><div class="line" id="l485">            }
</div><div class="line" id="l486"><br></div><div class="line" id="l487">            internal override BtreePage clonePage()
</div><div class="line" id="l488">            {
</div><div class="line" id="l489">                return new BtreePageOfByte(Storage);
</div><div class="line" id="l490">            }
</div><div class="line" id="l491"><br></div><div class="line" id="l492">            internal override int compare(Key key, int i)
</div><div class="line" id="l493">            {
</div><div class="line" id="l494">                return (byte) key.ival - data[i];
</div><div class="line" id="l495">            }
</div><div class="line" id="l496"><br></div><div class="line" id="l497">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l498">            {
</div><div class="line" id="l499">                items[i] = key.node;
</div><div class="line" id="l500">                data[i] = (byte) key.key.ival;
</div><div class="line" id="l501">            }
</div><div class="line" id="l502"><br></div><div class="line" id="l503">            internal BtreePageOfByte(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l504">            {
</div><div class="line" id="l505">                data = new byte[MAX_ITEMS];
</div><div class="line" id="l506">            }
</div><div class="line" id="l507"><br></div><div class="line" id="l508">            internal BtreePageOfByte()
</div><div class="line" id="l509">            {
</div><div class="line" id="l510">            }
</div><div class="line" id="l511">        }
</div><div class="line" id="l512"><br></div><div class="line" id="l513">        class BtreePageOfSByte : BtreePage
</div><div class="line" id="l514">        {
</div><div class="line" id="l515">            override internal Array Data
</div><div class="line" id="l516">            {
</div><div class="line" id="l517">                get
</div><div class="line" id="l518">                {
</div><div class="line" id="l519">                    return data;
</div><div class="line" id="l520">                }
</div><div class="line" id="l521"><br></div><div class="line" id="l522">            }
</div><div class="line" id="l523"><br></div><div class="line" id="l524">            sbyte[] data;
</div><div class="line" id="l525"><br></div><div class="line" id="l526">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 1);
</div><div class="line" id="l527"><br></div><div class="line" id="l528"><br></div><div class="line" id="l529">            internal override object getKeyValue(int i)
</div><div class="line" id="l530">            {
</div><div class="line" id="l531">                return data[i];
</div><div class="line" id="l532">            }
</div><div class="line" id="l533"><br></div><div class="line" id="l534">            internal override Key getKey(int i)
</div><div class="line" id="l535">            {
</div><div class="line" id="l536">                return new Key(data[i]);
</div><div class="line" id="l537">            }
</div><div class="line" id="l538"><br></div><div class="line" id="l539">            internal override BtreePage clonePage()
</div><div class="line" id="l540">            {
</div><div class="line" id="l541">                return new BtreePageOfSByte(Storage);
</div><div class="line" id="l542">            }
</div><div class="line" id="l543"><br></div><div class="line" id="l544">            internal override int compare(Key key, int i)
</div><div class="line" id="l545">            {
</div><div class="line" id="l546">                return (sbyte) key.ival - data[i];
</div><div class="line" id="l547">            }
</div><div class="line" id="l548"><br></div><div class="line" id="l549">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l550">            {
</div><div class="line" id="l551">                items[i] = key.node;
</div><div class="line" id="l552">                data[i] = (sbyte) key.key.ival;
</div><div class="line" id="l553">            }
</div><div class="line" id="l554"><br></div><div class="line" id="l555">            internal BtreePageOfSByte(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l556">            {
</div><div class="line" id="l557">                data = new sbyte[MAX_ITEMS];
</div><div class="line" id="l558">            }
</div><div class="line" id="l559"><br></div><div class="line" id="l560">            internal BtreePageOfSByte()
</div><div class="line" id="l561">            {
</div><div class="line" id="l562">            }
</div><div class="line" id="l563">        }
</div><div class="line" id="l564"><br></div><div class="line" id="l565">        class BtreePageOfBoolean : BtreePageOfByte
</div><div class="line" id="l566">        {
</div><div class="line" id="l567">            internal override Key getKey(int i)
</div><div class="line" id="l568">            {
</div><div class="line" id="l569">                return new Key(data[i] != 0);
</div><div class="line" id="l570">            }
</div><div class="line" id="l571"><br></div><div class="line" id="l572">            internal override object getKeyValue(int i)
</div><div class="line" id="l573">            {
</div><div class="line" id="l574">                return data[i] != 0;
</div><div class="line" id="l575">            }
</div><div class="line" id="l576"><br></div><div class="line" id="l577">            internal override BtreePage clonePage()
</div><div class="line" id="l578">            {
</div><div class="line" id="l579">                return new BtreePageOfBoolean(Storage);
</div><div class="line" id="l580">            }
</div><div class="line" id="l581"><br></div><div class="line" id="l582">            internal BtreePageOfBoolean()
</div><div class="line" id="l583">            {
</div><div class="line" id="l584">            }
</div><div class="line" id="l585"><br></div><div class="line" id="l586">            internal BtreePageOfBoolean(Storage s) : base(s)
</div><div class="line" id="l587">            {
</div><div class="line" id="l588">            }
</div><div class="line" id="l589">        }
</div><div class="line" id="l590"><br></div><div class="line" id="l591">        class BtreePageOfShort : BtreePage
</div><div class="line" id="l592">        {
</div><div class="line" id="l593">            override internal Array Data
</div><div class="line" id="l594">            {
</div><div class="line" id="l595">                get
</div><div class="line" id="l596">                {
</div><div class="line" id="l597">                    return data;
</div><div class="line" id="l598">                }
</div><div class="line" id="l599"><br></div><div class="line" id="l600">            }
</div><div class="line" id="l601">            internal short[] data;
</div><div class="line" id="l602"><br></div><div class="line" id="l603">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 2);
</div><div class="line" id="l604"><br></div><div class="line" id="l605"><br></div><div class="line" id="l606">            internal override Key getKey(int i)
</div><div class="line" id="l607">            {
</div><div class="line" id="l608">                return new Key(data[i]);
</div><div class="line" id="l609">            }
</div><div class="line" id="l610"><br></div><div class="line" id="l611">            internal override object getKeyValue(int i)
</div><div class="line" id="l612">            {
</div><div class="line" id="l613">                return data[i];
</div><div class="line" id="l614">            }
</div><div class="line" id="l615"><br></div><div class="line" id="l616">            internal override BtreePage clonePage()
</div><div class="line" id="l617">            {
</div><div class="line" id="l618">                return new BtreePageOfShort(Storage);
</div><div class="line" id="l619">            }
</div><div class="line" id="l620"><br></div><div class="line" id="l621">            internal override int compare(Key key, int i)
</div><div class="line" id="l622">            {
</div><div class="line" id="l623">                return (short) key.ival - data[i];
</div><div class="line" id="l624">            }
</div><div class="line" id="l625"><br></div><div class="line" id="l626">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l627">            {
</div><div class="line" id="l628">                items[i] = key.node;
</div><div class="line" id="l629">                data[i] = (short) key.key.ival;
</div><div class="line" id="l630">            }
</div><div class="line" id="l631"><br></div><div class="line" id="l632">            internal BtreePageOfShort(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l633">            {
</div><div class="line" id="l634">                data = new short[MAX_ITEMS];
</div><div class="line" id="l635">            }
</div><div class="line" id="l636"><br></div><div class="line" id="l637">            internal BtreePageOfShort()
</div><div class="line" id="l638">            {
</div><div class="line" id="l639">            }
</div><div class="line" id="l640">        }
</div><div class="line" id="l641"><br></div><div class="line" id="l642">        class BtreePageOfUShort : BtreePage
</div><div class="line" id="l643">        {
</div><div class="line" id="l644">            override internal Array Data
</div><div class="line" id="l645">            {
</div><div class="line" id="l646">                get
</div><div class="line" id="l647">                {
</div><div class="line" id="l648">                    return data;
</div><div class="line" id="l649">                }
</div><div class="line" id="l650"><br></div><div class="line" id="l651">            }
</div><div class="line" id="l652">            internal ushort[] data;
</div><div class="line" id="l653"><br></div><div class="line" id="l654">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 2);
</div><div class="line" id="l655"><br></div><div class="line" id="l656"><br></div><div class="line" id="l657">            internal override Key getKey(int i)
</div><div class="line" id="l658">            {
</div><div class="line" id="l659">                return new Key(data[i]);
</div><div class="line" id="l660">            }
</div><div class="line" id="l661"><br></div><div class="line" id="l662">            internal override object getKeyValue(int i)
</div><div class="line" id="l663">            {
</div><div class="line" id="l664">                return data[i];
</div><div class="line" id="l665">            }
</div><div class="line" id="l666"><br></div><div class="line" id="l667">            internal override BtreePage clonePage()
</div><div class="line" id="l668">            {
</div><div class="line" id="l669">                return new BtreePageOfUShort(Storage);
</div><div class="line" id="l670">            }
</div><div class="line" id="l671"><br></div><div class="line" id="l672">            internal override int compare(Key key, int i)
</div><div class="line" id="l673">            {
</div><div class="line" id="l674">                return (ushort) key.ival - data[i];
</div><div class="line" id="l675">            }
</div><div class="line" id="l676"><br></div><div class="line" id="l677">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l678">            {
</div><div class="line" id="l679">                items[i] = key.node;
</div><div class="line" id="l680">                data[i] = (ushort) key.key.ival;
</div><div class="line" id="l681">            }
</div><div class="line" id="l682"><br></div><div class="line" id="l683">            internal BtreePageOfUShort(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l684">            {
</div><div class="line" id="l685">                data = new ushort[MAX_ITEMS];
</div><div class="line" id="l686">            }
</div><div class="line" id="l687"><br></div><div class="line" id="l688">            internal BtreePageOfUShort()
</div><div class="line" id="l689">            {
</div><div class="line" id="l690">            }
</div><div class="line" id="l691">        }
</div><div class="line" id="l692"><br></div><div class="line" id="l693">        class BtreePageOfInt : BtreePage
</div><div class="line" id="l694">        {
</div><div class="line" id="l695">            override internal Array Data
</div><div class="line" id="l696">            {
</div><div class="line" id="l697">                get
</div><div class="line" id="l698">                {
</div><div class="line" id="l699">                    return data;
</div><div class="line" id="l700">                }
</div><div class="line" id="l701"><br></div><div class="line" id="l702">            }
</div><div class="line" id="l703">            internal int[] data;
</div><div class="line" id="l704"><br></div><div class="line" id="l705">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 4);
</div><div class="line" id="l706"><br></div><div class="line" id="l707"><br></div><div class="line" id="l708">            internal override Key getKey(int i)
</div><div class="line" id="l709">            {
</div><div class="line" id="l710">                return new Key(data[i]);
</div><div class="line" id="l711">            }
</div><div class="line" id="l712"><br></div><div class="line" id="l713">            internal override object getKeyValue(int i)
</div><div class="line" id="l714">            {
</div><div class="line" id="l715">                return data[i];
</div><div class="line" id="l716">            }
</div><div class="line" id="l717"><br></div><div class="line" id="l718">            internal override BtreePage clonePage()
</div><div class="line" id="l719">            {
</div><div class="line" id="l720">                return new BtreePageOfInt(Storage);
</div><div class="line" id="l721">            }
</div><div class="line" id="l722"><br></div><div class="line" id="l723">            internal override int compare(Key key, int i)
</div><div class="line" id="l724">            {
</div><div class="line" id="l725">                return key.ival - data[i];
</div><div class="line" id="l726">            }
</div><div class="line" id="l727"><br></div><div class="line" id="l728">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l729">            {
</div><div class="line" id="l730">                items[i] = key.node;
</div><div class="line" id="l731">                data[i] = key.key.ival;
</div><div class="line" id="l732">            }
</div><div class="line" id="l733"><br></div><div class="line" id="l734">            internal BtreePageOfInt(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l735">            {
</div><div class="line" id="l736">                data = new int[MAX_ITEMS];
</div><div class="line" id="l737">            }
</div><div class="line" id="l738"><br></div><div class="line" id="l739">            internal BtreePageOfInt()
</div><div class="line" id="l740">            {
</div><div class="line" id="l741">            }
</div><div class="line" id="l742">        }
</div><div class="line" id="l743"><br></div><div class="line" id="l744">        class BtreePageOfUInt : BtreePage
</div><div class="line" id="l745">        {
</div><div class="line" id="l746">            override internal Array Data
</div><div class="line" id="l747">            {
</div><div class="line" id="l748">                get
</div><div class="line" id="l749">                {
</div><div class="line" id="l750">                    return data;
</div><div class="line" id="l751">                }
</div><div class="line" id="l752"><br></div><div class="line" id="l753">            }
</div><div class="line" id="l754">            internal uint[] data;
</div><div class="line" id="l755"><br></div><div class="line" id="l756">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 4);
</div><div class="line" id="l757"><br></div><div class="line" id="l758"><br></div><div class="line" id="l759">            internal override Key getKey(int i)
</div><div class="line" id="l760">            {
</div><div class="line" id="l761">                return new Key(data[i]);
</div><div class="line" id="l762">            }
</div><div class="line" id="l763"><br></div><div class="line" id="l764">            internal override object getKeyValue(int i)
</div><div class="line" id="l765">            {
</div><div class="line" id="l766">                return data[i];
</div><div class="line" id="l767">            }
</div><div class="line" id="l768"><br></div><div class="line" id="l769">            internal override BtreePage clonePage()
</div><div class="line" id="l770">            {
</div><div class="line" id="l771">                return new BtreePageOfUInt(Storage);
</div><div class="line" id="l772">            }
</div><div class="line" id="l773"><br></div><div class="line" id="l774">            internal override int compare(Key key, int i)
</div><div class="line" id="l775">            {
</div><div class="line" id="l776">                return (uint) key.ival &lt; data[i] ? -1 : (uint) key.ival == data[i] ? 0 : 1;
</div><div class="line" id="l777">            }
</div><div class="line" id="l778"><br></div><div class="line" id="l779">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l780">            {
</div><div class="line" id="l781">                items[i] = key.node;
</div><div class="line" id="l782">                data[i] = (uint) key.key.ival;
</div><div class="line" id="l783">            }
</div><div class="line" id="l784"><br></div><div class="line" id="l785">            internal BtreePageOfUInt(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l786">            {
</div><div class="line" id="l787">                data = new uint[MAX_ITEMS];
</div><div class="line" id="l788">            }
</div><div class="line" id="l789"><br></div><div class="line" id="l790">            internal BtreePageOfUInt()
</div><div class="line" id="l791">            {
</div><div class="line" id="l792">            }
</div><div class="line" id="l793">        }
</div><div class="line" id="l794"><br></div><div class="line" id="l795">        class BtreePageOfLong : BtreePage
</div><div class="line" id="l796">        {
</div><div class="line" id="l797">            override internal Array Data
</div><div class="line" id="l798">            {
</div><div class="line" id="l799">                get
</div><div class="line" id="l800">                {
</div><div class="line" id="l801">                    <span class="c">return data;</span></div><div class="line" id="l802">                }
</div><div class="line" id="l803"><br></div><div class="line" id="l804">            }
</div><div class="line" id="l805">            internal long[] data;
</div><div class="line" id="l806"><br></div><div class="line" id="l807">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 8);
</div><div class="line" id="l808"><br></div><div class="line" id="l809"><br></div><div class="line" id="l810">            internal override Key getKey(int i)
</div><div class="line" id="l811">            {
</div><div class="line" id="l812">                return new Key(data[i]);
</div><div class="line" id="l813">            }
</div><div class="line" id="l814"><br></div><div class="line" id="l815">            internal override object getKeyValue(int i)
</div><div class="line" id="l816">            {
</div><div class="line" id="l817">                return data[i];
</div><div class="line" id="l818">            }
</div><div class="line" id="l819"><br></div><div class="line" id="l820">            internal override BtreePage clonePage()
</div><div class="line" id="l821">            {
</div><div class="line" id="l822">                return new BtreePageOfLong(Storage);
</div><div class="line" id="l823">            }
</div><div class="line" id="l824"><br></div><div class="line" id="l825">            internal override int compare(Key key, int i)
</div><div class="line" id="l826">            {
</div><div class="line" id="l827">                <span class="c">return key.lval &lt; data[i] ? -1 : key.lval == data[i] ? 0 : 1;</span></div><div class="line" id="l828">            }
</div><div class="line" id="l829"><br></div><div class="line" id="l830">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l831">            {
</div><div class="line" id="l832">                <span class="c">items[i] = key.node;</span></div><div class="line" id="l833">                <span class="c">data[i] = key.key.lval;</span></div><div class="line" id="l834">            <span class="c">}</span></div><div class="line" id="l835"><br></div><div class="line" id="l836">            <span class="c">internal BtreePageOfLong(Storage s) : base(s, MAX_ITEMS)</span></div><div class="line" id="l837">            {
</div><div class="line" id="l838">                <span class="c">data = new long[MAX_ITEMS];</span></div><div class="line" id="l839">            <span class="c">}</span></div><div class="line" id="l840"><br></div><div class="line" id="l841">            <span class="c">internal BtreePageOfLong()</span></div><div class="line" id="l842">            {
</div><div class="line" id="l843">            <span class="c">}</span></div><div class="line" id="l844">        }
</div><div class="line" id="l845"><br></div><div class="line" id="l846">        class BtreePageOfULong : BtreePage
</div><div class="line" id="l847">        {
</div><div class="line" id="l848">            override internal Array Data
</div><div class="line" id="l849">            {
</div><div class="line" id="l850">                get
</div><div class="line" id="l851">                {
</div><div class="line" id="l852">                    return data;
</div><div class="line" id="l853">                }
</div><div class="line" id="l854"><br></div><div class="line" id="l855">            }
</div><div class="line" id="l856">            internal ulong[] data;
</div><div class="line" id="l857"><br></div><div class="line" id="l858">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 8);
</div><div class="line" id="l859"><br></div><div class="line" id="l860"><br></div><div class="line" id="l861">            internal override Key getKey(int i)
</div><div class="line" id="l862">            {
</div><div class="line" id="l863">                return new Key(data[i]);
</div><div class="line" id="l864">            }
</div><div class="line" id="l865"><br></div><div class="line" id="l866">            internal override object getKeyValue(int i)
</div><div class="line" id="l867">            {
</div><div class="line" id="l868">                return data[i];
</div><div class="line" id="l869">            }
</div><div class="line" id="l870"><br></div><div class="line" id="l871">            internal override BtreePage clonePage()
</div><div class="line" id="l872">            {
</div><div class="line" id="l873">                return new BtreePageOfULong(Storage);
</div><div class="line" id="l874">            }
</div><div class="line" id="l875"><br></div><div class="line" id="l876">            internal override int compare(Key key, int i)
</div><div class="line" id="l877">            {
</div><div class="line" id="l878">                return (ulong)key.lval &lt; data[i] ? -1 : (ulong)key.lval == data[i] ? 0 : 1;
</div><div class="line" id="l879">            }
</div><div class="line" id="l880"><br></div><div class="line" id="l881">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l882">            {
</div><div class="line" id="l883">                items[i] = key.node;
</div><div class="line" id="l884">                data[i] = (ulong)key.key.lval;
</div><div class="line" id="l885">            }
</div><div class="line" id="l886"><br></div><div class="line" id="l887">            internal BtreePageOfULong(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l888">            {
</div><div class="line" id="l889">                data = new ulong[MAX_ITEMS];
</div><div class="line" id="l890">            }
</div><div class="line" id="l891"><br></div><div class="line" id="l892">            internal BtreePageOfULong()
</div><div class="line" id="l893">            {
</div><div class="line" id="l894">            }
</div><div class="line" id="l895">        }
</div><div class="line" id="l896"><br></div><div class="line" id="l897">        class BtreePageOfFloat : BtreePage
</div><div class="line" id="l898">        {
</div><div class="line" id="l899">            override internal Array Data
</div><div class="line" id="l900">            {
</div><div class="line" id="l901">                get
</div><div class="line" id="l902">                {
</div><div class="line" id="l903">                    return data;
</div><div class="line" id="l904">                }
</div><div class="line" id="l905"><br></div><div class="line" id="l906">            }
</div><div class="line" id="l907">            internal float[] data;
</div><div class="line" id="l908"><br></div><div class="line" id="l909">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 4);
</div><div class="line" id="l910"><br></div><div class="line" id="l911"><br></div><div class="line" id="l912">            internal override Key getKey(int i)
</div><div class="line" id="l913">            {
</div><div class="line" id="l914">                return new Key(data[i]);
</div><div class="line" id="l915">            }
</div><div class="line" id="l916"><br></div><div class="line" id="l917">            internal override object getKeyValue(int i)
</div><div class="line" id="l918">            {
</div><div class="line" id="l919">                return data[i];
</div><div class="line" id="l920">            }
</div><div class="line" id="l921"><br></div><div class="line" id="l922">            internal override BtreePage clonePage()
</div><div class="line" id="l923">            {
</div><div class="line" id="l924">                return new BtreePageOfFloat(Storage);
</div><div class="line" id="l925">            }
</div><div class="line" id="l926"><br></div><div class="line" id="l927">            internal override int compare(Key key, int i)
</div><div class="line" id="l928">            {
</div><div class="line" id="l929">                return (float) key.dval &lt; data[i]?- 1:(float) key.dval == data[i]?0:1;
</div><div class="line" id="l930">            }
</div><div class="line" id="l931"><br></div><div class="line" id="l932">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l933">            {
</div><div class="line" id="l934">                items[i] = key.node;
</div><div class="line" id="l935">                data[i] = (float) key.key.dval;
</div><div class="line" id="l936">            }
</div><div class="line" id="l937"><br></div><div class="line" id="l938">            internal BtreePageOfFloat(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l939">            {
</div><div class="line" id="l940">                data = new float[MAX_ITEMS];
</div><div class="line" id="l941">            }
</div><div class="line" id="l942"><br></div><div class="line" id="l943">            internal BtreePageOfFloat()
</div><div class="line" id="l944">            {
</div><div class="line" id="l945">            }
</div><div class="line" id="l946">        }
</div><div class="line" id="l947"><br></div><div class="line" id="l948">        class BtreePageOfDouble : BtreePage
</div><div class="line" id="l949">        {
</div><div class="line" id="l950">            override internal Array Data
</div><div class="line" id="l951">            {
</div><div class="line" id="l952">                get
</div><div class="line" id="l953">                {
</div><div class="line" id="l954">                    return data;
</div><div class="line" id="l955">                }
</div><div class="line" id="l956"><br></div><div class="line" id="l957">            }
</div><div class="line" id="l958">            internal double[] data;
</div><div class="line" id="l959"><br></div><div class="line" id="l960">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 8);
</div><div class="line" id="l961"><br></div><div class="line" id="l962"><br></div><div class="line" id="l963">            internal override Key getKey(int i)
</div><div class="line" id="l964">            {
</div><div class="line" id="l965">                return new Key(data[i]);
</div><div class="line" id="l966">            }
</div><div class="line" id="l967"><br></div><div class="line" id="l968">            internal override object getKeyValue(int i)
</div><div class="line" id="l969">            {
</div><div class="line" id="l970">                return data[i];
</div><div class="line" id="l971">            }
</div><div class="line" id="l972"><br></div><div class="line" id="l973">            internal override BtreePage clonePage()
</div><div class="line" id="l974">            {
</div><div class="line" id="l975">                return new BtreePageOfDouble(Storage);
</div><div class="line" id="l976">            }
</div><div class="line" id="l977"><br></div><div class="line" id="l978">            internal override int compare(Key key, int i)
</div><div class="line" id="l979">            {
</div><div class="line" id="l980">                return key.dval &lt; data[i]?- 1:key.dval == data[i]?0:1;
</div><div class="line" id="l981">            }
</div><div class="line" id="l982"><br></div><div class="line" id="l983">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l984">            {
</div><div class="line" id="l985">                items[i] = key.node;
</div><div class="line" id="l986">                data[i] = key.key.dval;
</div><div class="line" id="l987">            }
</div><div class="line" id="l988"><br></div><div class="line" id="l989">            internal BtreePageOfDouble(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l990">            {
</div><div class="line" id="l991">                data = new double[MAX_ITEMS];
</div><div class="line" id="l992">            }
</div><div class="line" id="l993"><br></div><div class="line" id="l994">            internal BtreePageOfDouble()
</div><div class="line" id="l995">            {
</div><div class="line" id="l996">            }
</div><div class="line" id="l997">        }
</div><div class="line" id="l998"><br></div><div class="line" id="l999">        class BtreePageOfGuid : BtreePage
</div><div class="line" id="l1000">        {
</div><div class="line" id="l1001">            override internal Array Data
</div><div class="line" id="l1002">            {
</div><div class="line" id="l1003">                get
</div><div class="line" id="l1004">                {
</div><div class="line" id="l1005">                    return data;
</div><div class="line" id="l1006">                }
</div><div class="line" id="l1007"><br></div><div class="line" id="l1008">            }
</div><div class="line" id="l1009">            internal Guid[] data;
</div><div class="line" id="l1010"><br></div><div class="line" id="l1011">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 16);
</div><div class="line" id="l1012"><br></div><div class="line" id="l1013"><br></div><div class="line" id="l1014">            internal override Key getKey(int i)
</div><div class="line" id="l1015">            {
</div><div class="line" id="l1016">                return new Key(data[i]);
</div><div class="line" id="l1017">            }
</div><div class="line" id="l1018"><br></div><div class="line" id="l1019">            internal override object getKeyValue(int i)
</div><div class="line" id="l1020">            {
</div><div class="line" id="l1021">                return data[i];
</div><div class="line" id="l1022">            }
</div><div class="line" id="l1023"><br></div><div class="line" id="l1024">            internal override BtreePage clonePage()
</div><div class="line" id="l1025">            {
</div><div class="line" id="l1026">                return new BtreePageOfGuid(Storage);
</div><div class="line" id="l1027">            }
</div><div class="line" id="l1028"><br></div><div class="line" id="l1029">            internal override int compare(Key key, int i)
</div><div class="line" id="l1030">            {
</div><div class="line" id="l1031">                return key.guid.CompareTo(data[i]);
</div><div class="line" id="l1032">            }
</div><div class="line" id="l1033"><br></div><div class="line" id="l1034">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l1035">            {
</div><div class="line" id="l1036">                items[i] = key.node;
</div><div class="line" id="l1037">                data[i] = key.key.guid;
</div><div class="line" id="l1038">            }
</div><div class="line" id="l1039"><br></div><div class="line" id="l1040">            internal BtreePageOfGuid(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l1041">            {
</div><div class="line" id="l1042">                data = new Guid[MAX_ITEMS];
</div><div class="line" id="l1043">            }
</div><div class="line" id="l1044"><br></div><div class="line" id="l1045">            internal BtreePageOfGuid()
</div><div class="line" id="l1046">            {
</div><div class="line" id="l1047">            }
</div><div class="line" id="l1048">        }
</div><div class="line" id="l1049"><br></div><div class="line" id="l1050">        class BtreePageOfDecimal : BtreePage
</div><div class="line" id="l1051">        {
</div><div class="line" id="l1052">            override internal Array Data
</div><div class="line" id="l1053">            {
</div><div class="line" id="l1054">                get
</div><div class="line" id="l1055">                {
</div><div class="line" id="l1056">                    return data;
</div><div class="line" id="l1057">                }
</div><div class="line" id="l1058"><br></div><div class="line" id="l1059">            }
</div><div class="line" id="l1060">            internal decimal[] data;
</div><div class="line" id="l1061"><br></div><div class="line" id="l1062">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 16);
</div><div class="line" id="l1063"><br></div><div class="line" id="l1064"><br></div><div class="line" id="l1065">            internal override Key getKey(int i)
</div><div class="line" id="l1066">            {
</div><div class="line" id="l1067">                return new Key(data[i]);
</div><div class="line" id="l1068">            }
</div><div class="line" id="l1069"><br></div><div class="line" id="l1070">            internal override object getKeyValue(int i)
</div><div class="line" id="l1071">            {
</div><div class="line" id="l1072">                return data[i];
</div><div class="line" id="l1073">            }
</div><div class="line" id="l1074"><br></div><div class="line" id="l1075">            internal override BtreePage clonePage()
</div><div class="line" id="l1076">            {
</div><div class="line" id="l1077">                return new BtreePageOfDecimal(Storage);
</div><div class="line" id="l1078">            }
</div><div class="line" id="l1079"><br></div><div class="line" id="l1080">            internal override int compare(Key key, int i)
</div><div class="line" id="l1081">            {
</div><div class="line" id="l1082">                return key.dec.CompareTo(data[i]);
</div><div class="line" id="l1083">            }
</div><div class="line" id="l1084"><br></div><div class="line" id="l1085">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l1086">            {
</div><div class="line" id="l1087">                items[i] = key.node;
</div><div class="line" id="l1088">                data[i] = key.key.dec;
</div><div class="line" id="l1089">            }
</div><div class="line" id="l1090"><br></div><div class="line" id="l1091">            internal BtreePageOfDecimal(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l1092">            {
</div><div class="line" id="l1093">                data = new decimal[MAX_ITEMS];
</div><div class="line" id="l1094">            }
</div><div class="line" id="l1095"><br></div><div class="line" id="l1096">            internal BtreePageOfDecimal()
</div><div class="line" id="l1097">            {
</div><div class="line" id="l1098">            }
</div><div class="line" id="l1099">        }
</div><div class="line" id="l1100"><br></div><div class="line" id="l1101">        class BtreePageOfObject : BtreePage
</div><div class="line" id="l1102">        {
</div><div class="line" id="l1103">            override internal Array Data
</div><div class="line" id="l1104">            {
</div><div class="line" id="l1105">                get
</div><div class="line" id="l1106">                {
</div><div class="line" id="l1107">                    return data.ToRawArray();
</div><div class="line" id="l1108">                }
</div><div class="line" id="l1109"><br></div><div class="line" id="l1110">            }
</div><div class="line" id="l1111">            internal Link data;
</div><div class="line" id="l1112"><br></div><div class="line" id="l1113">            const int MAX_ITEMS = BTREE_PAGE_SIZE / (4 + 4);
</div><div class="line" id="l1114"><br></div><div class="line" id="l1115"><br></div><div class="line" id="l1116">            internal override Key getKey(int i)
</div><div class="line" id="l1117">            {
</div><div class="line" id="l1118">                return new Key(data.GetRaw(i));
</div><div class="line" id="l1119">            }
</div><div class="line" id="l1120"><br></div><div class="line" id="l1121">            internal override object getKeyValue(int i)
</div><div class="line" id="l1122">            {
</div><div class="line" id="l1123">                return data[i];
</div><div class="line" id="l1124">            }
</div><div class="line" id="l1125"><br></div><div class="line" id="l1126">            internal override BtreePage clonePage()
</div><div class="line" id="l1127">            {
</div><div class="line" id="l1128">                return new BtreePageOfObject(Storage);
</div><div class="line" id="l1129">            }
</div><div class="line" id="l1130"><br></div><div class="line" id="l1131">            internal override int compare(Key key, int i)
</div><div class="line" id="l1132">            {
</div><div class="line" id="l1133">                return (int) key.ival - data[i].Oid;
</div><div class="line" id="l1134">            }
</div><div class="line" id="l1135"><br></div><div class="line" id="l1136">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l1137">            {
</div><div class="line" id="l1138">                items[i] = key.node;
</div><div class="line" id="l1139">                data[i] = (IPersistent) key.key.oval;
</div><div class="line" id="l1140">            }
</div><div class="line" id="l1141"><br></div><div class="line" id="l1142">            internal BtreePageOfObject(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l1143">            {
</div><div class="line" id="l1144">                data = s.CreateLink(MAX_ITEMS);
</div><div class="line" id="l1145">                data.Length = MAX_ITEMS;
</div><div class="line" id="l1146">            }
</div><div class="line" id="l1147"><br></div><div class="line" id="l1148">            internal BtreePageOfObject()
</div><div class="line" id="l1149">            {
</div><div class="line" id="l1150">            }
</div><div class="line" id="l1151">        }
</div><div class="line" id="l1152"><br></div><div class="line" id="l1153">        class BtreePageOfString : BtreePage
</div><div class="line" id="l1154">        {
</div><div class="line" id="l1155">            override internal Array Data
</div><div class="line" id="l1156">            {
</div><div class="line" id="l1157">                get
</div><div class="line" id="l1158">                {
</div><div class="line" id="l1159">                    <span class="c">return data;</span></div><div class="line" id="l1160">                }
</div><div class="line" id="l1161"><br></div><div class="line" id="l1162">            }
</div><div class="line" id="l1163">            internal string[] data;
</div><div class="line" id="l1164"><br></div><div class="line" id="l1165">            internal const int MAX_ITEMS = 100;
</div><div class="line" id="l1166"><br></div><div class="line" id="l1167"><br></div><div class="line" id="l1168">            internal override Key getKey(int i)
</div><div class="line" id="l1169">            {
</div><div class="line" id="l1170">                return new Key(data[i]);
</div><div class="line" id="l1171">            }
</div><div class="line" id="l1172"><br></div><div class="line" id="l1173">            internal override object getKeyValue(int i)
</div><div class="line" id="l1174">            {
</div><div class="line" id="l1175">                return data[i];
</div><div class="line" id="l1176">            }
</div><div class="line" id="l1177"><br></div><div class="line" id="l1178">            internal override void  clearKeyValue(int i)
</div><div class="line" id="l1179">            {
</div><div class="line" id="l1180">                data[i] = null;
</div><div class="line" id="l1181">            }
</div><div class="line" id="l1182"><br></div><div class="line" id="l1183">            internal override BtreePage clonePage()
</div><div class="line" id="l1184">            {
</div><div class="line" id="l1185">                return new BtreePageOfString(Storage);
</div><div class="line" id="l1186">            }
</div><div class="line" id="l1187"><br></div><div class="line" id="l1188">            internal override int compare(Key key, int i)
</div><div class="line" id="l1189">            {
</div><div class="line" id="l1190">                <span class="c">return ((string) key.oval).CompareTo(data[i]);</span></div><div class="line" id="l1191">            }
</div><div class="line" id="l1192"><br></div><div class="line" id="l1193">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l1194">            {
</div><div class="line" id="l1195">                <span class="c">items[i] = key.node;</span></div><div class="line" id="l1196">                <span class="c">data[i] = (string) key.key.oval;</span></div><div class="line" id="l1197">            <span class="c">}</span></div><div class="line" id="l1198"><br></div><div class="line" id="l1199">            internal override void  memset(int i, int len)
</div><div class="line" id="l1200">            {
</div><div class="line" id="l1201">                while (--len &gt;= 0)
</div><div class="line" id="l1202">                {
</div><div class="line" id="l1203">                    items[i] = null;
</div><div class="line" id="l1204">                    data[i] = null;
</div><div class="line" id="l1205">                    i += 1;
</div><div class="line" id="l1206">                }
</div><div class="line" id="l1207">            }
</div><div class="line" id="l1208"><br></div><div class="line" id="l1209">            internal virtual bool prefixSearch(string key, int height, ArrayList result)
</div><div class="line" id="l1210">            {
</div><div class="line" id="l1211">                int l = 0, n = nItems, r = n;
</div><div class="line" id="l1212">                height -= 1;
</div><div class="line" id="l1213">                while (l &lt; r)
</div><div class="line" id="l1214">                {
</div><div class="line" id="l1215">                    int i = (l + r) &gt;&gt; 1;
</div><div class="line" id="l1216">                    if (!key.StartsWith(data[i]) &amp;&amp; key.CompareTo(data[i]) &gt; 0)
</div><div class="line" id="l1217">                    {
</div><div class="line" id="l1218">                        l = i + 1;
</div><div class="line" id="l1219">                    }
</div><div class="line" id="l1220">                    else
</div><div class="line" id="l1221">                    {
</div><div class="line" id="l1222">                        r = i;
</div><div class="line" id="l1223">                    }
</div><div class="line" id="l1224">                }
</div><div class="line" id="l1225">                Debug.Assert(r == l);
</div><div class="line" id="l1226">                if (height == 0)
</div><div class="line" id="l1227">                {
</div><div class="line" id="l1228">                    while (l &lt; n)
</div><div class="line" id="l1229">                    {
</div><div class="line" id="l1230">                        if (key.CompareTo(data[l]) &lt; 0)
</div><div class="line" id="l1231">                        {
</div><div class="line" id="l1232">                            return false;
</div><div class="line" id="l1233">                        }
</div><div class="line" id="l1234">                        result.Add(items[l]);
</div><div class="line" id="l1235">                        l += 1;
</div><div class="line" id="l1236">                    }
</div><div class="line" id="l1237">                }
</div><div class="line" id="l1238">                else
</div><div class="line" id="l1239">                {
</div><div class="line" id="l1240">                    do 
</div><div class="line" id="l1241">                    {
</div><div class="line" id="l1242">                        if (!((BtreePageOfString) items[l]).prefixSearch(key, height, result))
</div><div class="line" id="l1243">                        {
</div><div class="line" id="l1244">                            return false;
</div><div class="line" id="l1245">                        }
</div><div class="line" id="l1246">                        if (l == n)
</div><div class="line" id="l1247">                        {
</div><div class="line" id="l1248">                            return true;
</div><div class="line" id="l1249">                        }
</div><div class="line" id="l1250">                    }
</div><div class="line" id="l1251">                    while (key.CompareTo(data[l++]) &gt;= 0);
</div><div class="line" id="l1252">                    return false;
</div><div class="line" id="l1253">                }
</div><div class="line" id="l1254">                return true;
</div><div class="line" id="l1255">            }
</div><div class="line" id="l1256"><br></div><div class="line" id="l1257"><br></div><div class="line" id="l1258">            <span class="c">internal BtreePageOfString(Storage s) : base(s, MAX_ITEMS)</span></div><div class="line" id="l1259">            {
</div><div class="line" id="l1260">                <span class="c">data = new string[MAX_ITEMS];</span></div><div class="line" id="l1261">            <span class="c">}</span></div><div class="line" id="l1262"><br></div><div class="line" id="l1263">            <span class="c">internal BtreePageOfString()</span></div><div class="line" id="l1264">            {
</div><div class="line" id="l1265">            <span class="c">}</span></div><div class="line" id="l1266">        }
</div><div class="line" id="l1267"><br></div><div class="line" id="l1268">        class BtreePageOfRaw : BtreePage
</div><div class="line" id="l1269">        {
</div><div class="line" id="l1270">            override internal Array Data
</div><div class="line" id="l1271">            {
</div><div class="line" id="l1272">                get
</div><div class="line" id="l1273">                {
</div><div class="line" id="l1274">                    return (Array)data;
</div><div class="line" id="l1275">                }
</div><div class="line" id="l1276"><br></div><div class="line" id="l1277">            }
</div><div class="line" id="l1278">            internal object data;
</div><div class="line" id="l1279"><br></div><div class="line" id="l1280">            internal const int MAX_ITEMS = 100;
</div><div class="line" id="l1281"><br></div><div class="line" id="l1282"><br></div><div class="line" id="l1283">            internal override Key getKey(int i)
</div><div class="line" id="l1284">            {
</div><div class="line" id="l1285">                return new Key((IComparable)((object[]) data)[i]);
</div><div class="line" id="l1286">            }
</div><div class="line" id="l1287"><br></div><div class="line" id="l1288">            internal override object getKeyValue(int i)
</div><div class="line" id="l1289">            {
</div><div class="line" id="l1290">                return ((object[])data)[i];
</div><div class="line" id="l1291">            }
</div><div class="line" id="l1292"><br></div><div class="line" id="l1293">            internal override void  clearKeyValue(int i)
</div><div class="line" id="l1294">            {
</div><div class="line" id="l1295">                ((object[])data)[i] = null;
</div><div class="line" id="l1296">            }
</div><div class="line" id="l1297"><br></div><div class="line" id="l1298">            internal override BtreePage clonePage()
</div><div class="line" id="l1299">            {
</div><div class="line" id="l1300">                return new BtreePageOfRaw(Storage);
</div><div class="line" id="l1301">            }
</div><div class="line" id="l1302"><br></div><div class="line" id="l1303">            internal override int compare(Key key, int i)
</div><div class="line" id="l1304">            {
</div><div class="line" id="l1305">                return ((IComparable) key.oval).CompareTo(((object[]) data)[i]);
</div><div class="line" id="l1306">            }
</div><div class="line" id="l1307"><br></div><div class="line" id="l1308">            internal override void insert(BtreeKey key, int i)
</div><div class="line" id="l1309">            {
</div><div class="line" id="l1310">                items[i] = key.node;
</div><div class="line" id="l1311">                ((object[])data)[i] = key.key.oval;
</div><div class="line" id="l1312">            }
</div><div class="line" id="l1313"><br></div><div class="line" id="l1314">            internal BtreePageOfRaw(Storage s) : base(s, MAX_ITEMS)
</div><div class="line" id="l1315">            {
</div><div class="line" id="l1316">                data = new object[MAX_ITEMS];
</div><div class="line" id="l1317">            }
</div><div class="line" id="l1318"><br></div><div class="line" id="l1319">            internal BtreePageOfRaw()
</div><div class="line" id="l1320">            {
</div><div class="line" id="l1321">            }
</div><div class="line" id="l1322">        }
</div><div class="line" id="l1323"><br></div><div class="line" id="l1324">        internal static ClassDescriptor.FieldType checkType(Type c)
</div><div class="line" id="l1325">        {
</div><div class="line" id="l1326">            <span class="c">ClassDescriptor.FieldType elemType = ClassDescriptor.getTypeCode(c);</span></div><div class="line" id="l1327">            <span class="c">if ((int)elemType &gt; (int)ClassDescriptor.FieldType.tpOid</span></div><div class="line" id="l1328"><span class="c">                &amp;&amp; elemType != ClassDescriptor.FieldType.tpDecimal</span></div><div class="line" id="l1329"><span class="c">                &amp;&amp; elemType != ClassDescriptor.FieldType.tpRaw</span></div><div class="line" id="l1330">                &amp;&amp; elemType != ClassDescriptor.FieldType.tpGuid<span class="c">)</span></div><div class="line" id="l1331">            {
</div><div class="line" id="l1332">                <span class="c">throw new StorageError(StorageError.ErrorCode.UNSUPPORTED_INDEX_TYPE, c);</span></div><div class="line" id="l1333">            }
</div><div class="line" id="l1334">            <span class="c">return elemType;</span></div><div class="line" id="l1335">        }
</div><div class="line" id="l1336"><br></div><div class="line" id="l1337">        <span class="c">internal AltBtree(bool unique)</span></div><div class="line" id="l1338">        {
</div><div class="line" id="l1339">            <span class="c">type = checkType(typeof(K));</span></div><div class="line" id="l1340">            <span class="c">this.unique = unique;</span></div><div class="line" id="l1341">        <span class="c">}</span></div><div class="line" id="l1342"><br></div><div class="line" id="l1343">        internal AltBtree(ClassDescriptor.FieldType type, bool unique)
</div><div class="line" id="l1344">        {
</div><div class="line" id="l1345">            this.type = type;
</div><div class="line" id="l1346">            this.unique = unique;
</div><div class="line" id="l1347">        }
</div><div class="line" id="l1348"><br></div><div class="line" id="l1349">        internal enum OperationResult 
</div><div class="line" id="l1350">        { 
</div><div class="line" id="l1351">            Done, 
</div><div class="line" id="l1352">            Overflow,
</div><div class="line" id="l1353">            Underflow,
</div><div class="line" id="l1354">            NotFound,
</div><div class="line" id="l1355">            Duplicate,
</div><div class="line" id="l1356">            Overwrite
</div><div class="line" id="l1357">        }
</div><div class="line" id="l1358"><br></div><div class="line" id="l1359">        public override int Count 
</div><div class="line" id="l1360">        { 
</div><div class="line" id="l1361">            get 
</div><div class="line" id="l1362">            {
</div><div class="line" id="l1363">                return nElems;
</div><div class="line" id="l1364">            }
</div><div class="line" id="l1365">        }
</div><div class="line" id="l1366"><br></div><div class="line" id="l1367">        public V this[K key] 
</div><div class="line" id="l1368">        {
</div><div class="line" id="l1369">            get 
</div><div class="line" id="l1370">            {
</div><div class="line" id="l1371">                <span class="c">return Get(key);</span></div><div class="line" id="l1372">            }
</div><div class="line" id="l1373">            set 
</div><div class="line" id="l1374">            {
</div><div class="line" id="l1375">                <span class="c">Set(key, value);</span></div><div class="line" id="l1376">            <span class="c">}</span></div><div class="line" id="l1377">        } 
</div><div class="line" id="l1378"><br></div><div class="line" id="l1379">        public V[] this[K from, K till] 
</div><div class="line" id="l1380">        {
</div><div class="line" id="l1381">            get 
</div><div class="line" id="l1382">            {
</div><div class="line" id="l1383">                return Get(from, till);
</div><div class="line" id="l1384">            }
</div><div class="line" id="l1385">        }
</div><div class="line" id="l1386"><br></div><div class="line" id="l1387">        internal virtual Key checkKey(Key key)
</div><div class="line" id="l1388">        {
</div><div class="line" id="l1389">            <span class="c">if (key != null)</span></div><div class="line" id="l1390">            {
</div><div class="line" id="l1391">                <span class="c">if (key.type != type)</span></div><div class="line" id="l1392">                {
</div><div class="line" id="l1393">                    <span class="c">throw new StorageError(StorageError.ErrorCode.INCOMPATIBLE_KEY_TYPE);</span></div><div class="line" id="l1394">                }
</div><div class="line" id="l1395">                <span class="c">if ((type == ClassDescriptor.FieldType.tpObject</span></div><div class="line" id="l1396"><span class="c">                     || type == ClassDescriptor.FieldType.tpOid)</span></div><div class="line" id="l1397">                    &amp;&amp; key.ival == 0 &amp;&amp; key.oval != null<span class="c">)</span></div><div class="line" id="l1398">                {
</div><div class="line" id="l1399">                    <span class="c">throw new StorageError(StorageError.ErrorCode.INVALID_OID);</span></div><div class="line" id="l1400">                }
</div><div class="line" id="l1401">                <span class="c">if (key.oval is char[])</span></div><div class="line" id="l1402">                {
</div><div class="line" id="l1403">                    <span class="c">key = new Key(new string((char[]) key.oval), key.inclusion != 0);</span></div><div class="line" id="l1404">                }
</div><div class="line" id="l1405">            }
</div><div class="line" id="l1406">            <span class="c">return key;</span></div><div class="line" id="l1407">        }
</div><div class="line" id="l1408"><br></div><div class="line" id="l1409">        public virtual V Get(Key key)
</div><div class="line" id="l1410">        {
</div><div class="line" id="l1411">            <span class="c">key = checkKey(key);</span></div><div class="line" id="l1412">            <span class="c">if (root != null)</span></div><div class="line" id="l1413">            {
</div><div class="line" id="l1414">                <span class="c">ArrayList list = new ArrayList();</span></div><div class="line" id="l1415">                <span class="c">root.find(key, key, height, list);</span></div><div class="line" id="l1416">                <span class="c">if (list.Count &gt; 1)</span></div><div class="line" id="l1417">                {
</div><div class="line" id="l1418">                    <span class="c">throw new StorageError(StorageError.ErrorCode.KEY_NOT_UNIQUE);</span></div><div class="line" id="l1419">                }
</div><div class="line" id="l1420">                else <span class="c">if (list.Count == 0)</span></div><div class="line" id="l1421">                {
</div><div class="line" id="l1422">                    <span class="c">return null;</span></div><div class="line" id="l1423">                }
</div><div class="line" id="l1424">                else
</div><div class="line" id="l1425">                {
</div><div class="line" id="l1426">                    <span class="c">return (V) list[0];</span></div><div class="line" id="l1427">                }
</div><div class="line" id="l1428">            }
</div><div class="line" id="l1429">            <span class="c">return null;</span></div><div class="line" id="l1430">        }
</div><div class="line" id="l1431"><br></div><div class="line" id="l1432">        public virtual V Get(K key) 
</div><div class="line" id="l1433">        {
</div><div class="line" id="l1434">            <span class="c">return Get(KeyBuilder.getKeyFromObject(key));</span></div><div class="line" id="l1435">        }
</div><div class="line" id="l1436"><br></div><div class="line" id="l1437"><br></div><div class="line" id="l1438">        <span class="c">internal static V[] emptySelection = new V[0];</span></div><div class="line" id="l1439"><br></div><div class="line" id="l1440">        public virtual V[] PrefixSearch(string key)
</div><div class="line" id="l1441">        {
</div><div class="line" id="l1442">            if (ClassDescriptor.FieldType.tpString != type)
</div><div class="line" id="l1443">            {
</div><div class="line" id="l1444">                throw new StorageError(StorageError.ErrorCode.INCOMPATIBLE_KEY_TYPE);
</div><div class="line" id="l1445">            }
</div><div class="line" id="l1446">            if (root != null)
</div><div class="line" id="l1447">            {
</div><div class="line" id="l1448">                ArrayList list = new ArrayList();
</div><div class="line" id="l1449">                ((BtreePageOfString) root).prefixSearch(key, height, list);
</div><div class="line" id="l1450">                if (list.Count != 0)
</div><div class="line" id="l1451">                {
</div><div class="line" id="l1452">                    return (V[]) list.ToArray(typeof(V));
</div><div class="line" id="l1453">                }
</div><div class="line" id="l1454">            }
</div><div class="line" id="l1455">            return emptySelection;
</div><div class="line" id="l1456">        }
</div><div class="line" id="l1457"><br></div><div class="line" id="l1458">        public virtual V[] Get(Key from, Key till)
</div><div class="line" id="l1459">        {
</div><div class="line" id="l1460">            if (root != null)
</div><div class="line" id="l1461">            {
</div><div class="line" id="l1462">                ArrayList list = new ArrayList();
</div><div class="line" id="l1463">                root.find(checkKey(from), checkKey(till), height, list);
</div><div class="line" id="l1464">                if (list.Count != 0)
</div><div class="line" id="l1465">                {
</div><div class="line" id="l1466">                    return (V[]) list.ToArray(typeof(V));
</div><div class="line" id="l1467">                }
</div><div class="line" id="l1468">            }
</div><div class="line" id="l1469">            return emptySelection;
</div><div class="line" id="l1470">        }
</div><div class="line" id="l1471"><br></div><div class="line" id="l1472">        public virtual V[] Get(K from, K till)
</div><div class="line" id="l1473">        {
</div><div class="line" id="l1474">            return Get(KeyBuilder.getKeyFromObject(from), KeyBuilder.getKeyFromObject(till));
</div><div class="line" id="l1475">        }
</div><div class="line" id="l1476"><br></div><div class="line" id="l1477">        public virtual bool Put(Key key, V obj)
</div><div class="line" id="l1478">        {
</div><div class="line" id="l1479">            <span class="c">return insert(key, obj, false) == null;</span></div><div class="line" id="l1480">        }
</div><div class="line" id="l1481"><br></div><div class="line" id="l1482">        public virtual bool Put(K key, V obj)
</div><div class="line" id="l1483">        {
</div><div class="line" id="l1484">            return Put(KeyBuilder.getKeyFromObject(key), obj);
</div><div class="line" id="l1485">        }
</div><div class="line" id="l1486"><br></div><div class="line" id="l1487">        public virtual V Set(Key key, V obj)
</div><div class="line" id="l1488">        {
</div><div class="line" id="l1489">            <span class="c">return (V)insert(key, obj, true);</span></div><div class="line" id="l1490">        }
</div><div class="line" id="l1491"><br></div><div class="line" id="l1492">        public virtual V Set(K key, V obj)
</div><div class="line" id="l1493">        {
</div><div class="line" id="l1494">            <span class="c">return Set(KeyBuilder.getKeyFromObject(key), obj);</span></div><div class="line" id="l1495">        }
</div><div class="line" id="l1496"><br></div><div class="line" id="l1497">        internal void allocateRootPage(BtreeKey ins)
</div><div class="line" id="l1498">        {
</div><div class="line" id="l1499">            <span class="c">Storage s = Storage;</span></div><div class="line" id="l1500">            <span class="c">BtreePage newRoot = null;</span></div><div class="line" id="l1501">            <span class="c">switch (type)</span></div><div class="line" id="l1502">            {               
</div><div class="line" id="l1503">                case ClassDescriptor.FieldType.tpByte: 
</div><div class="line" id="l1504">                    <span class="c">newRoot = new BtreePageOfByte(s);</span></div><div class="line" id="l1505">                    <span class="c">break;</span></div><div class="line" id="l1506"><br></div><div class="line" id="l1507">                case ClassDescriptor.FieldType.tpSByte: 
</div><div class="line" id="l1508">                    <span class="c">newRoot = new BtreePageOfSByte(s);</span></div><div class="line" id="l1509">                    <span class="c">break;</span></div><div class="line" id="l1510"><br></div><div class="line" id="l1511">                case ClassDescriptor.FieldType.tpShort: 
</div><div class="line" id="l1512">                    <span class="c">newRoot = new BtreePageOfShort(s);</span></div><div class="line" id="l1513">                    <span class="c">break;</span></div><div class="line" id="l1514"><br></div><div class="line" id="l1515">                case ClassDescriptor.FieldType.tpUShort: 
</div><div class="line" id="l1516">                    <span class="c">newRoot = new BtreePageOfUShort(s);</span></div><div class="line" id="l1517">                    <span class="c">break;</span></div><div class="line" id="l1518"><br></div><div class="line" id="l1519">                case ClassDescriptor.FieldType.tpBoolean: 
</div><div class="line" id="l1520">                    <span class="c">newRoot = new BtreePageOfBoolean(s);</span></div><div class="line" id="l1521">                    <span class="c">break;</span></div><div class="line" id="l1522"><br></div><div class="line" id="l1523">                case ClassDescriptor.FieldType.tpInt: 
</div><div class="line" id="l1524">                case ClassDescriptor.FieldType.tpOid: 
</div><div class="line" id="l1525">                    <span class="c">newRoot = new BtreePageOfInt(s);</span></div><div class="line" id="l1526">                    <span class="c">break;</span></div><div class="line" id="l1527"><br></div><div class="line" id="l1528">                case ClassDescriptor.FieldType.tpUInt: 
</div><div class="line" id="l1529">                    <span class="c">newRoot = new BtreePageOfInt(s);</span></div><div class="line" id="l1530">                    <span class="c">break;</span></div><div class="line" id="l1531"><br></div><div class="line" id="l1532">                case ClassDescriptor.FieldType.tpLong: 
</div><div class="line" id="l1533">                    <span class="c">newRoot = new BtreePageOfLong(s);</span></div><div class="line" id="l1534">                    <span class="c">break;</span></div><div class="line" id="l1535"><br></div><div class="line" id="l1536">                case ClassDescriptor.FieldType.tpULong: 
</div><div class="line" id="l1537">                    <span class="c">newRoot = new BtreePageOfLong(s);</span></div><div class="line" id="l1538">                    <span class="c">break;</span></div><div class="line" id="l1539"><br></div><div class="line" id="l1540">                case ClassDescriptor.FieldType.tpFloat: 
</div><div class="line" id="l1541">                    <span class="c">newRoot = new BtreePageOfFloat(s);</span></div><div class="line" id="l1542">                    <span class="c">break;</span></div><div class="line" id="l1543"><br></div><div class="line" id="l1544">                case ClassDescriptor.FieldType.tpDouble: 
</div><div class="line" id="l1545">                    <span class="c">newRoot = new BtreePageOfDouble(s);</span></div><div class="line" id="l1546">                    <span class="c">break;</span></div><div class="line" id="l1547"><br></div><div class="line" id="l1548">                case ClassDescriptor.FieldType.tpObject: 
</div><div class="line" id="l1549">                    <span class="c">newRoot = new BtreePageOfObject(s);</span></div><div class="line" id="l1550">                    <span class="c">break;</span></div><div class="line" id="l1551"><br></div><div class="line" id="l1552">                case ClassDescriptor.FieldType.tpString: 
</div><div class="line" id="l1553">                    <span class="c">newRoot = new BtreePageOfString(s);</span></div><div class="line" id="l1554">                    <span class="c">break;</span></div><div class="line" id="l1555"><br></div><div class="line" id="l1556">                case ClassDescriptor.FieldType.tpRaw: 
</div><div class="line" id="l1557">                    <span class="c">newRoot = new BtreePageOfRaw(s);</span></div><div class="line" id="l1558">                    <span class="c">break;</span></div><div class="line" id="l1559"><br></div><div class="line" id="l1560">                case ClassDescriptor.FieldType.tpDecimal: 
</div><div class="line" id="l1561">                    <span class="c">newRoot = new BtreePageOfDecimal(s);</span></div><div class="line" id="l1562">                    <span class="c">break;</span></div><div class="line" id="l1563"><br></div><div class="line" id="l1564">                case ClassDescriptor.FieldType.tpGuid: 
</div><div class="line" id="l1565">                    <span class="c">newRoot = new BtreePageOfGuid(s);</span></div><div class="line" id="l1566">                    break;
</div><div class="line" id="l1567"><br></div><div class="line" id="l1568">                default: 
</div><div class="line" id="l1569">                    Debug.Assert(false, "Invalid type");
</div><div class="line" id="l1570">                    break;
</div><div class="line" id="l1571"><br></div><div class="line" id="l1572">            }
</div><div class="line" id="l1573">            <span class="c">newRoot.insert(ins, 0);</span></div><div class="line" id="l1574">            <span class="c">newRoot.items[1] = root;</span></div><div class="line" id="l1575">            <span class="c">newRoot.nItems = 1;</span></div><div class="line" id="l1576">            <span class="c">root = newRoot;</span></div><div class="line" id="l1577">        <span class="c">}</span></div><div class="line" id="l1578"><br></div><div class="line" id="l1579">        internal IPersistent insert(Key key, IPersistent obj, bool overwrite)
</div><div class="line" id="l1580">        {
</div><div class="line" id="l1581">            <span class="c">BtreeKey ins = new BtreeKey(checkKey(key), obj);</span></div><div class="line" id="l1582">            <span class="c">if (root == null)</span></div><div class="line" id="l1583">            {
</div><div class="line" id="l1584">                <span class="c">allocateRootPage(ins);</span></div><div class="line" id="l1585">                <span class="c">height = 1;</span></div><div class="line" id="l1586">            }
</div><div class="line" id="l1587">            else
</div><div class="line" id="l1588">            {
</div><div class="line" id="l1589">                <span class="c">OperationResult result = root.insert(ins, height, unique, overwrite);</span></div><div class="line" id="l1590">                <span class="c">if (result == OperationResult.Overflow)</span></div><div class="line" id="l1591">                {
</div><div class="line" id="l1592">                    <span class="c">allocateRootPage(ins);</span></div><div class="line" id="l1593">                    <span class="c">height += 1;</span></div><div class="line" id="l1594">                }
</div><div class="line" id="l1595">                else <span class="c">if (result == OperationResult.Duplicate || result == OperationResult.Overwrite)</span></div><div class="line" id="l1596">                {
</div><div class="line" id="l1597">                    <span class="c">return ins.oldNode;</span></div><div class="line" id="l1598">                }
</div><div class="line" id="l1599">            }
</div><div class="line" id="l1600">            <span class="c">updateCounter += 1;</span></div><div class="line" id="l1601">            <span class="c">nElems += 1;</span></div><div class="line" id="l1602">            <span class="c">Modify();</span></div><div class="line" id="l1603">            <span class="c">return null;</span></div><div class="line" id="l1604">        }
</div><div class="line" id="l1605"><br></div><div class="line" id="l1606">        public virtual void Remove(Key key, V obj)
</div><div class="line" id="l1607">        {
</div><div class="line" id="l1608">            Remove(new BtreeKey(checkKey(key), obj));
</div><div class="line" id="l1609">        }
</div><div class="line" id="l1610"><br></div><div class="line" id="l1611">        public virtual void Remove(K key, V obj)
</div><div class="line" id="l1612">        {
</div><div class="line" id="l1613">            Remove(new BtreeKey(KeyBuilder.getKeyFromObject(key), obj));    
</div><div class="line" id="l1614">        }
</div><div class="line" id="l1615"><br></div><div class="line" id="l1616">        internal virtual void Remove(BtreeKey rem)
</div><div class="line" id="l1617">        {
</div><div class="line" id="l1618">            if (root == null)
</div><div class="line" id="l1619">            {
</div><div class="line" id="l1620">                throw new StorageError(StorageError.ErrorCode.KEY_NOT_FOUND);
</div><div class="line" id="l1621">            }
</div><div class="line" id="l1622">            OperationResult result = root.remove(rem, height);
</div><div class="line" id="l1623">            if (result == OperationResult.NotFound)
</div><div class="line" id="l1624">            {
</div><div class="line" id="l1625">                throw new StorageError(StorageError.ErrorCode.KEY_NOT_FOUND);
</div><div class="line" id="l1626">            }
</div><div class="line" id="l1627">            nElems -= 1;
</div><div class="line" id="l1628">            if (result == OperationResult.Underflow)
</div><div class="line" id="l1629">            {
</div><div class="line" id="l1630">                if (root.nItems == 0)
</div><div class="line" id="l1631">                {
</div><div class="line" id="l1632">                    BtreePage newRoot = null;
</div><div class="line" id="l1633">                    if (height != 1)
</div><div class="line" id="l1634">                    {
</div><div class="line" id="l1635">                        newRoot = (BtreePage) root.items[0];
</div><div class="line" id="l1636">                    }
</div><div class="line" id="l1637">                    root.Deallocate();
</div><div class="line" id="l1638">                    root = newRoot;
</div><div class="line" id="l1639">                    height -= 1;
</div><div class="line" id="l1640">                }
</div><div class="line" id="l1641">            }
</div><div class="line" id="l1642">            updateCounter += 1;
</div><div class="line" id="l1643">            Modify();
</div><div class="line" id="l1644">        }
</div><div class="line" id="l1645"><br></div><div class="line" id="l1646">        public virtual V Remove(Key key)
</div><div class="line" id="l1647">        {
</div><div class="line" id="l1648">            if (!unique)
</div><div class="line" id="l1649">            {
</div><div class="line" id="l1650">                throw new StorageError(StorageError.ErrorCode.KEY_NOT_UNIQUE);
</div><div class="line" id="l1651">            }
</div><div class="line" id="l1652">            BtreeKey rk = new BtreeKey(checkKey(key), null);
</div><div class="line" id="l1653">            Remove(rk);
</div><div class="line" id="l1654">            return (V)rk.oldNode;
</div><div class="line" id="l1655">        }
</div><div class="line" id="l1656"><br></div><div class="line" id="l1657">        public virtual V RemoveKey(K key)
</div><div class="line" id="l1658">        {
</div><div class="line" id="l1659">            return Remove(KeyBuilder.getKeyFromObject(key));
</div><div class="line" id="l1660">        }
</div><div class="line" id="l1661"><br></div><div class="line" id="l1662">        public virtual V[] GetPrefix(string prefix)
</div><div class="line" id="l1663">        {
</div><div class="line" id="l1664">            return Get(new Key(prefix, true), new Key(prefix + Char.MaxValue, false));
</div><div class="line" id="l1665">        }
</div><div class="line" id="l1666"><br></div><div class="line" id="l1667">        public virtual int Size()
</div><div class="line" id="l1668">        {
</div><div class="line" id="l1669">            return nElems;
</div><div class="line" id="l1670">        }
</div><div class="line" id="l1671"><br></div><div class="line" id="l1672">        public override void Clear() 
</div><div class="line" id="l1673">        {
</div><div class="line" id="l1674">            if (root != null)
</div><div class="line" id="l1675">            {
</div><div class="line" id="l1676">                root.purge(height);
</div><div class="line" id="l1677">                root = null;
</div><div class="line" id="l1678">                nElems = 0;
</div><div class="line" id="l1679">                height = 0;
</div><div class="line" id="l1680">                updateCounter += 1;
</div><div class="line" id="l1681">                Modify();
</div><div class="line" id="l1682">            }
</div><div class="line" id="l1683">        }
</div><div class="line" id="l1684"><br></div><div class="line" id="l1685">        public virtual V[] ToArray()
</div><div class="line" id="l1686">        {
</div><div class="line" id="l1687">            V[] arr = new V[nElems];
</div><div class="line" id="l1688">            if (root != null)
</div><div class="line" id="l1689">            {
</div><div class="line" id="l1690">                root.traverseForward(height, arr, 0);
</div><div class="line" id="l1691">            }
</div><div class="line" id="l1692">            return (V[])arr;
</div><div class="line" id="l1693">        }
</div><div class="line" id="l1694"><br></div><div class="line" id="l1695">        public virtual Array ToArray(Type elemType)
</div><div class="line" id="l1696">        {
</div><div class="line" id="l1697">            Array arr = Array.CreateInstance(elemType, nElems);
</div><div class="line" id="l1698">            if (root != null)
</div><div class="line" id="l1699">            {
</div><div class="line" id="l1700">                root.traverseForward(height, (IPersistent[])arr, 0);
</div><div class="line" id="l1701">            }
</div><div class="line" id="l1702">            return arr;
</div><div class="line" id="l1703">        }
</div><div class="line" id="l1704"><br></div><div class="line" id="l1705">        public override void Deallocate()
</div><div class="line" id="l1706">        {
</div><div class="line" id="l1707">            if (root != null)
</div><div class="line" id="l1708">            {
</div><div class="line" id="l1709">                root.purge(height);
</div><div class="line" id="l1710">            }
</div><div class="line" id="l1711">            base.Deallocate();
</div><div class="line" id="l1712">        }
</div><div class="line" id="l1713"><br></div><div class="line" id="l1714">        class BtreeEnumerator : IEnumerator&lt;V&gt;
</div><div class="line" id="l1715">        {
</div><div class="line" id="l1716">            <span class="c">internal BtreeEnumerator(AltBtree&lt;K,V&gt; tree)</span></div><div class="line" id="l1717">            { 
</div><div class="line" id="l1718">                <span class="c">this.tree = tree;</span></div><div class="line" id="l1719">                <span class="c">Reset();</span></div><div class="line" id="l1720">            <span class="c">}</span></div><div class="line" id="l1721"><br></div><div class="line" id="l1722">            public void Reset() 
</div><div class="line" id="l1723">            {
</div><div class="line" id="l1724">                <span class="c">BtreePage page = tree.root;</span></div><div class="line" id="l1725">                <span class="c">int h = tree.height;</span></div><div class="line" id="l1726">                <span class="c">counter = tree.updateCounter;</span></div><div class="line" id="l1727">                <span class="c">pageStack = new BtreePage[h];</span></div><div class="line" id="l1728">                <span class="c">posStack = new int[h];</span></div><div class="line" id="l1729">                <span class="c">sp = 0;</span></div><div class="line" id="l1730">                <span class="c">if (h &gt; 0)</span></div><div class="line" id="l1731">                {
</div><div class="line" id="l1732">                    <span class="c">while (--h &gt; 0)</span></div><div class="line" id="l1733">                    {
</div><div class="line" id="l1734">                        <span class="c">posStack[sp] = 0;</span></div><div class="line" id="l1735">                        <span class="c">pageStack[sp] = page;</span></div><div class="line" id="l1736">                        <span class="c">page = (BtreePage) page.items[0];</span></div><div class="line" id="l1737">                        <span class="c">sp += 1;</span></div><div class="line" id="l1738">                    }
</div><div class="line" id="l1739">                    <span class="c">posStack[sp] = 0;</span></div><div class="line" id="l1740">                    <span class="c">pageStack[sp] = page;</span></div><div class="line" id="l1741">                    <span class="c">end = page.nItems;</span></div><div class="line" id="l1742">                    <span class="c">sp += 1;</span></div><div class="line" id="l1743">                }
</div><div class="line" id="l1744">            <span class="c">}</span></div><div class="line" id="l1745"><br></div><div class="line" id="l1746">            protected virtual void getCurrent(BtreePage pg, int pos)
</div><div class="line" id="l1747">            {
</div><div class="line" id="l1748">                <span class="c">curr = pg.items[pos];</span></div><div class="line" id="l1749">            <span class="c">}</span></div><div class="line" id="l1750"><br></div><div class="line" id="l1751">            public void Dispose() {<span class="c">}</span></div><div class="line" id="l1752"><br></div><div class="line" id="l1753">            public bool MoveNext() 
</div><div class="line" id="l1754">            {
</div><div class="line" id="l1755">                <span class="c">if (counter != tree.updateCounter)</span></div><div class="line" id="l1756">                { 
</div><div class="line" id="l1757">                    <span class="c">throw new InvalidOperationException("B-Tree was modified");</span></div><div class="line" id="l1758">                }
</div><div class="line" id="l1759">                <span class="c">if (sp &gt; 0 &amp;&amp; posStack[sp-1] &lt; end)</span></div><div class="line" id="l1760">                {
</div><div class="line" id="l1761">                    <span class="c">int pos = posStack[sp - 1];</span></div><div class="line" id="l1762">                    <span class="c">BtreePage pg = pageStack[sp - 1];</span></div><div class="line" id="l1763">                    <span class="c">getCurrent(pg, pos);</span></div><div class="line" id="l1764">                    <span class="c">hasCurrent = true;</span></div><div class="line" id="l1765">                    <span class="c">if (++pos == end)</span></div><div class="line" id="l1766">                    {
</div><div class="line" id="l1767">                        <span class="c">while (--sp != 0)</span></div><div class="line" id="l1768">                        {
</div><div class="line" id="l1769">                            <span class="c">pos = posStack[sp - 1];</span></div><div class="line" id="l1770">                            <span class="c">pg = pageStack[sp - 1];</span></div><div class="line" id="l1771">                            <span class="c">if (++pos &lt;= pg.nItems)</span></div><div class="line" id="l1772">                            {
</div><div class="line" id="l1773">                                <span class="c">posStack[sp - 1] = pos;</span></div><div class="line" id="l1774">                                do 
</div><div class="line" id="l1775">                                {
</div><div class="line" id="l1776">                                    <span class="c">pg = (BtreePage) pg.items[pos];</span></div><div class="line" id="l1777">                                    <span class="c">end = pg.nItems;</span></div><div class="line" id="l1778">                                    <span class="c">pageStack[sp] = pg;</span></div><div class="line" id="l1779">                                    <span class="c">posStack[sp] = pos = 0;</span></div><div class="line" id="l1780">                                }
</div><div class="line" id="l1781">                                <span class="c">while (++sp &lt; pageStack.Length);</span></div><div class="line" id="l1782">                                <span class="c">break;</span></div><div class="line" id="l1783">                            }
</div><div class="line" id="l1784">                        }
</div><div class="line" id="l1785">                    }
</div><div class="line" id="l1786">                    else
</div><div class="line" id="l1787">                    {
</div><div class="line" id="l1788">                        <span class="c">posStack[sp - 1] = pos;</span></div><div class="line" id="l1789">                    }
</div><div class="line" id="l1790">                    <span class="c">return true;</span></div><div class="line" id="l1791">                }
</div><div class="line" id="l1792">                <span class="c">hasCurrent = false;</span></div><div class="line" id="l1793">                <span class="c">return false;</span></div><div class="line" id="l1794">            }
</div><div class="line" id="l1795"><br></div><div class="line" id="l1796">            public virtual V Current
</div><div class="line" id="l1797">            {
</div><div class="line" id="l1798">                get 
</div><div class="line" id="l1799">                {
</div><div class="line" id="l1800">                    <span class="c">if (!hasCurrent)</span></div><div class="line" id="l1801">                    { 
</div><div class="line" id="l1802">                        <span class="c">throw new InvalidOperationException();</span></div><div class="line" id="l1803">                    }
</div><div class="line" id="l1804">                    <span class="c">return (V)curr;</span></div><div class="line" id="l1805">                }
</div><div class="line" id="l1806">            }
</div><div class="line" id="l1807">            object IEnumerator.Current
</div><div class="line" id="l1808">            {
</div><div class="line" id="l1809">                get
</div><div class="line" id="l1810">                {
</div><div class="line" id="l1811">                    return Current;
</div><div class="line" id="l1812">                }
</div><div class="line" id="l1813">            }
</div><div class="line" id="l1814">            protected BtreePage[] pageStack;
</div><div class="line" id="l1815">            protected int[] posStack;
</div><div class="line" id="l1816">            protected int sp;
</div><div class="line" id="l1817">            protected int end;
</div><div class="line" id="l1818">            protected int counter;
</div><div class="line" id="l1819">            protected IPersistent curr;
</div><div class="line" id="l1820">            protected bool hasCurrent;
</div><div class="line" id="l1821">            protected AltBtree&lt;K,V&gt; tree;
</div><div class="line" id="l1822">        }
</div><div class="line" id="l1823"><br></div><div class="line" id="l1824">        class BtreeDictionaryEnumerator : BtreeEnumerator, IDictionaryEnumerator
</div><div class="line" id="l1825">        {
</div><div class="line" id="l1826">            internal BtreeDictionaryEnumerator(AltBtree&lt;K,V&gt; tree) 
</div><div class="line" id="l1827">                : base(tree) 
</div><div class="line" id="l1828">            {   
</div><div class="line" id="l1829">            }
</div><div class="line" id="l1830"><br></div><div class="line" id="l1831">            protected override void getCurrent(BtreePage pg, int pos) 
</div><div class="line" id="l1832">            { 
</div><div class="line" id="l1833">                base.getCurrent(pg, pos);
</div><div class="line" id="l1834">                key = pg.getKeyValue(pos);
</div><div class="line" id="l1835">            }
</div><div class="line" id="l1836"><br></div><div class="line" id="l1837">            public new virtual object Current 
</div><div class="line" id="l1838">            {
</div><div class="line" id="l1839">                get 
</div><div class="line" id="l1840">                {
</div><div class="line" id="l1841">                    return Entry;
</div><div class="line" id="l1842">                }
</div><div class="line" id="l1843">            }
</div><div class="line" id="l1844"><br></div><div class="line" id="l1845">            public DictionaryEntry Entry 
</div><div class="line" id="l1846">            {
</div><div class="line" id="l1847">                get 
</div><div class="line" id="l1848">                {
</div><div class="line" id="l1849">                    if (!hasCurrent) 
</div><div class="line" id="l1850">                    { 
</div><div class="line" id="l1851">                        throw new InvalidOperationException();
</div><div class="line" id="l1852">                    }
</div><div class="line" id="l1853">                    return new DictionaryEntry(key, curr);
</div><div class="line" id="l1854">                }
</div><div class="line" id="l1855">            }
</div><div class="line" id="l1856"><br></div><div class="line" id="l1857">            public object Key 
</div><div class="line" id="l1858">            {
</div><div class="line" id="l1859">                get 
</div><div class="line" id="l1860">                {
</div><div class="line" id="l1861">                    if (!hasCurrent) 
</div><div class="line" id="l1862">                    { 
</div><div class="line" id="l1863">                        throw new InvalidOperationException();
</div><div class="line" id="l1864">                    }
</div><div class="line" id="l1865">                    return key;
</div><div class="line" id="l1866">                }
</div><div class="line" id="l1867">            }
</div><div class="line" id="l1868"><br></div><div class="line" id="l1869">            public object Value 
</div><div class="line" id="l1870">            {
</div><div class="line" id="l1871">                get 
</div><div class="line" id="l1872">                {
</div><div class="line" id="l1873">                    if (!hasCurrent) 
</div><div class="line" id="l1874">                    { 
</div><div class="line" id="l1875">                        throw new InvalidOperationException();
</div><div class="line" id="l1876">                    }
</div><div class="line" id="l1877">                    return curr;
</div><div class="line" id="l1878">                }
</div><div class="line" id="l1879">            }
</div><div class="line" id="l1880"><br></div><div class="line" id="l1881">            protected object key;
</div><div class="line" id="l1882">        }
</div><div class="line" id="l1883"><br></div><div class="line" id="l1884"><br></div><div class="line" id="l1885">        public override IEnumerator&lt;V&gt; GetEnumerator() 
</div><div class="line" id="l1886">        {
</div><div class="line" id="l1887">            <span class="c">return new BtreeEnumerator(this);</span></div><div class="line" id="l1888">        }
</div><div class="line" id="l1889"><br></div><div class="line" id="l1890">        IEnumerator IEnumerable.GetEnumerator()
</div><div class="line" id="l1891">        {
</div><div class="line" id="l1892">            return (IEnumerator)new BtreeEnumerator(this);
</div><div class="line" id="l1893">        }
</div><div class="line" id="l1894"><br></div><div class="line" id="l1895">        public IDictionaryEnumerator GetDictionaryEnumerator() 
</div><div class="line" id="l1896">        {
</div><div class="line" id="l1897">            return new BtreeDictionaryEnumerator(this);
</div><div class="line" id="l1898">        }
</div><div class="line" id="l1899"><br></div><div class="line" id="l1900">        class BtreeSelectionIterator : IEnumerator&lt;V&gt;, IEnumerable&lt;V&gt;
</div><div class="line" id="l1901">        { 
</div><div class="line" id="l1902">            <span class="c">internal BtreeSelectionIterator(AltBtree&lt;K,V&gt; tree, Key from, Key till, IterationOrder order)</span></div><div class="line" id="l1903">            { 
</div><div class="line" id="l1904">                <span class="c">this.from = from;</span></div><div class="line" id="l1905">                <span class="c">this.till = till;</span></div><div class="line" id="l1906">                <span class="c">this.order = order;</span></div><div class="line" id="l1907">                <span class="c">this.tree = tree;</span></div><div class="line" id="l1908">                <span class="c">Reset();</span></div><div class="line" id="l1909">            <span class="c">}</span></div><div class="line" id="l1910"><br></div><div class="line" id="l1911">            public IEnumerator&lt;V&gt; GetEnumerator() 
</div><div class="line" id="l1912">            {
</div><div class="line" id="l1913">                <span class="c">return this;</span></div><div class="line" id="l1914">            }
</div><div class="line" id="l1915"><br></div><div class="line" id="l1916">            IEnumerator IEnumerable.GetEnumerator()
</div><div class="line" id="l1917">            {
</div><div class="line" id="l1918">                return this;
</div><div class="line" id="l1919">            }
</div><div class="line" id="l1920"><br></div><div class="line" id="l1921">            public void Reset() 
</div><div class="line" id="l1922">            {
</div><div class="line" id="l1923">                int i, l, r;
</div><div class="line" id="l1924"><br></div><div class="line" id="l1925">                <span class="c">sp = 0;</span></div><div class="line" id="l1926">                <span class="c">counter = tree.updateCounter;</span></div><div class="line" id="l1927">                <span class="c">if (tree.height == 0)</span></div><div class="line" id="l1928">                {
</div><div class="line" id="l1929">                    <span class="c">return;</span></div><div class="line" id="l1930">                }
</div><div class="line" id="l1931">                <span class="c">BtreePage page = tree.root;</span></div><div class="line" id="l1932">                <span class="c">int h = tree.height;</span></div><div class="line" id="l1933">                <span class="c">this.from = from;</span></div><div class="line" id="l1934">                <span class="c">this.till = till;</span></div><div class="line" id="l1935">                <span class="c">this.order = order;</span></div><div class="line" id="l1936"><br></div><div class="line" id="l1937">                <span class="c">pageStack = new BtreePage[h];</span></div><div class="line" id="l1938">                <span class="c">posStack = new int[h];</span></div><div class="line" id="l1939"><br></div><div class="line" id="l1940">                <span class="c">if (order == IterationOrder.AscentOrder)</span></div><div class="line" id="l1941">                {
</div><div class="line" id="l1942">                    <span class="c">if (from == null)</span></div><div class="line" id="l1943">                    {
</div><div class="line" id="l1944">                        <span class="c">while (--h &gt; 0)</span></div><div class="line" id="l1945">                        {
</div><div class="line" id="l1946">                            <span class="c">posStack[sp] = 0;</span></div><div class="line" id="l1947">                            <span class="c">pageStack[sp] = page;</span></div><div class="line" id="l1948">                            <span class="c">page = (BtreePage) page.items[0];</span></div><div class="line" id="l1949">                            <span class="c">sp += 1;</span></div><div class="line" id="l1950">                        }
</div><div class="line" id="l1951">                        <span class="c">posStack[sp] = 0;</span></div><div class="line" id="l1952">                        <span class="c">pageStack[sp] = page;</span></div><div class="line" id="l1953">                        <span class="c">end = page.nItems;</span></div><div class="line" id="l1954">                        <span class="c">sp += 1;</span></div><div class="line" id="l1955">                    }
</div><div class="line" id="l1956">                    else
</div><div class="line" id="l1957">                    {
</div><div class="line" id="l1958">                        <span class="c">while (--h &gt; 0)</span></div><div class="line" id="l1959">                        {
</div><div class="line" id="l1960">                            <span class="c">pageStack[sp] = page;</span></div><div class="line" id="l1961">                            <span class="c">l = 0;</span></div><div class="line" id="l1962">                            <span class="c">r = page.nItems;</span></div><div class="line" id="l1963">                            <span class="c">while (l &lt; r)</span></div><div class="line" id="l1964">                            {
</div><div class="line" id="l1965">                                <span class="c">i = (l + r) &gt;&gt; 1;</span></div><div class="line" id="l1966">                                <span class="c">if (page.compare(from, i) &gt;= from.inclusion)</span></div><div class="line" id="l1967">                                {
</div><div class="line" id="l1968">                                    <span class="c">l = i + 1;</span></div><div class="line" id="l1969">                                }
</div><div class="line" id="l1970">                                else
</div><div class="line" id="l1971">                                {
</div><div class="line" id="l1972">                                    <span class="c">r = i;</span></div><div class="line" id="l1973">                                }
</div><div class="line" id="l1974">                            }
</div><div class="line" id="l1975">                            Debug.Assert(r == l);
</div><div class="line" id="l1976">                            <span class="c">posStack[sp] = r;</span></div><div class="line" id="l1977">                            <span class="c">page = (BtreePage) page.items[r];</span></div><div class="line" id="l1978">                            <span class="c">sp += 1;</span></div><div class="line" id="l1979">                        }
</div><div class="line" id="l1980">                        <span class="c">pageStack[sp] = page;</span></div><div class="line" id="l1981">                        <span class="c">l = 0;</span></div><div class="line" id="l1982">                        <span class="c">r = end = page.nItems;</span></div><div class="line" id="l1983">                        <span class="c">while (l &lt; r)</span></div><div class="line" id="l1984">                        {
</div><div class="line" id="l1985">                            <span class="c">i = (l + r) &gt;&gt; 1;</span></div><div class="line" id="l1986">                            <span class="c">if (page.compare(from, i) &gt;= from.inclusion)</span></div><div class="line" id="l1987">                            {
</div><div class="line" id="l1988">                                <span class="c">l = i + 1;</span></div><div class="line" id="l1989">                            }
</div><div class="line" id="l1990">                            else
</div><div class="line" id="l1991">                            {
</div><div class="line" id="l1992">                                <span class="c">r = i;</span></div><div class="line" id="l1993">                            }
</div><div class="line" id="l1994">                        }
</div><div class="line" id="l1995">                        Debug.Assert(r == l);
</div><div class="line" id="l1996">                        <span class="c">if (r == end)</span></div><div class="line" id="l1997">                        {
</div><div class="line" id="l1998">                            <span class="c">sp += 1;</span></div><div class="line" id="l1999">                            <span class="c">gotoNextItem(page, r - 1);</span></div><div class="line" id="l2000">                        }
</div><div class="line" id="l2001">                        else
</div><div class="line" id="l2002">                        {
</div><div class="line" id="l2003">                            <span class="c">posStack[sp++] = r;</span></div><div class="line" id="l2004">                        }
</div><div class="line" id="l2005">                    }
</div><div class="line" id="l2006">                    <span class="c">if (sp != 0 &amp;&amp; till != null)</span></div><div class="line" id="l2007">                    {
</div><div class="line" id="l2008">                        <span class="c">page = pageStack[sp - 1];</span></div><div class="line" id="l2009">                        <span class="c">if (- page.compare(till, posStack[sp - 1]) &gt;= till.inclusion)</span></div><div class="line" id="l2010">                        {
</div><div class="line" id="l2011">                            <span class="c">sp = 0;</span></div><div class="line" id="l2012">                        }
</div><div class="line" id="l2013">                    }
</div><div class="line" id="l2014">                }
</div><div class="line" id="l2015">                else
</div><div class="line" id="l2016">                {
</div><div class="line" id="l2017">                    // descent order
</div><div class="line" id="l2018">                    <span class="c">if (till == null)</span></div><div class="line" id="l2019">                    {
</div><div class="line" id="l2020">                        <span class="c">while (--h &gt; 0)</span></div><div class="line" id="l2021">                        {
</div><div class="line" id="l2022">                            <span class="c">pageStack[sp] = page;</span></div><div class="line" id="l2023">                            <span class="c">posStack[sp] = page.nItems;</span></div><div class="line" id="l2024">                            <span class="c">page = (BtreePage) page.items[page.nItems];</span></div><div class="line" id="l2025">                            <span class="c">sp += 1;</span></div><div class="line" id="l2026">                        }
</div><div class="line" id="l2027">                        <span class="c">pageStack[sp] = page;</span></div><div class="line" id="l2028">                        <span class="c">posStack[sp++] = page.nItems - 1;</span></div><div class="line" id="l2029">                    }
</div><div class="line" id="l2030">                    else
</div><div class="line" id="l2031">                    {
</div><div class="line" id="l2032">                        <span class="c">while (--h &gt; 0)</span></div><div class="line" id="l2033">                        {
</div><div class="line" id="l2034">                            <span class="c">pageStack[sp] = page;</span></div><div class="line" id="l2035">                            <span class="c">l = 0;</span></div><div class="line" id="l2036">                            <span class="c">r = page.nItems;</span></div><div class="line" id="l2037">                            <span class="c">while (l &lt; r)</span></div><div class="line" id="l2038">                            {
</div><div class="line" id="l2039">                                <span class="c">i = (l + r) &gt;&gt; 1;</span></div><div class="line" id="l2040">                                <span class="c">if (page.compare(till, i) &gt;= 1 - till.inclusion)</span></div><div class="line" id="l2041">                                {
</div><div class="line" id="l2042">                                    <span class="c">l = i + 1;</span></div><div class="line" id="l2043">                                }
</div><div class="line" id="l2044">                                else
</div><div class="line" id="l2045">                                {
</div><div class="line" id="l2046">                                    <span class="c">r = i;</span></div><div class="line" id="l2047">                                }
</div><div class="line" id="l2048">                            }
</div><div class="line" id="l2049">                            Debug.Assert(r == l);
</div><div class="line" id="l2050">                            <span class="c">posStack[sp] = r;</span></div><div class="line" id="l2051">                            <span class="c">page = (BtreePage) page.items[r];</span></div><div class="line" id="l2052">                            <span class="c">sp += 1;</span></div><div class="line" id="l2053">                        }
</div><div class="line" id="l2054">                        <span class="c">pageStack[sp] = page;</span></div><div class="line" id="l2055">                        <span class="c">l = 0;</span></div><div class="line" id="l2056">                        <span class="c">r = page.nItems;</span></div><div class="line" id="l2057">                        <span class="c">while (l &lt; r)</span></div><div class="line" id="l2058">                        {
</div><div class="line" id="l2059">                            <span class="c">i = (l + r) &gt;&gt; 1;</span></div><div class="line" id="l2060">                            <span class="c">if (page.compare(till, i) &gt;= 1 - till.inclusion)</span></div><div class="line" id="l2061">                            {
</div><div class="line" id="l2062">                                <span class="c">l = i + 1;</span></div><div class="line" id="l2063">                            }
</div><div class="line" id="l2064">                            else
</div><div class="line" id="l2065">                            {
</div><div class="line" id="l2066">                                <span class="c">r = i;</span></div><div class="line" id="l2067">                            }
</div><div class="line" id="l2068">                        }
</div><div class="line" id="l2069">                        Debug.Assert(r == l);
</div><div class="line" id="l2070">                        <span class="c">if (r == 0)</span></div><div class="line" id="l2071">                        {
</div><div class="line" id="l2072">                            <span class="c">sp += 1;</span></div><div class="line" id="l2073">                            <span class="c">gotoNextItem(page, r);</span></div><div class="line" id="l2074">                        }
</div><div class="line" id="l2075">                        else
</div><div class="line" id="l2076">                        {
</div><div class="line" id="l2077">                            <span class="c">posStack[sp++] = r - 1;</span></div><div class="line" id="l2078">                        }
</div><div class="line" id="l2079">                    }
</div><div class="line" id="l2080">                    <span class="c">if (sp != 0 &amp;&amp; from != null)</span></div><div class="line" id="l2081">                    {
</div><div class="line" id="l2082">                        <span class="c">page = pageStack[sp - 1];</span></div><div class="line" id="l2083">                        <span class="c">if (page.compare(from, posStack[sp - 1]) &gt;= from.inclusion)</span></div><div class="line" id="l2084">                        {
</div><div class="line" id="l2085">                            <span class="c">sp = 0;</span></div><div class="line" id="l2086">                        }
</div><div class="line" id="l2087">                    }
</div><div class="line" id="l2088">                }
</div><div class="line" id="l2089">            <span class="c">}</span></div><div class="line" id="l2090"><br></div><div class="line" id="l2091">            public void Dispose() {<span class="c">}</span></div><div class="line" id="l2092"><br></div><div class="line" id="l2093">            public bool MoveNext() 
</div><div class="line" id="l2094">            {
</div><div class="line" id="l2095">                <span class="c">if (counter != tree.updateCounter)</span></div><div class="line" id="l2096">                { 
</div><div class="line" id="l2097">                    <span class="c">throw new InvalidOperationException("B-Tree was modified");</span></div><div class="line" id="l2098">                }
</div><div class="line" id="l2099">                <span class="c">if (sp != 0)</span></div><div class="line" id="l2100">                {
</div><div class="line" id="l2101">                    <span class="c">int pos = posStack[sp - 1];</span></div><div class="line" id="l2102">                    <span class="c">BtreePage pg = pageStack[sp - 1];</span></div><div class="line" id="l2103">                    <span class="c">hasCurrent = true;</span></div><div class="line" id="l2104">                    <span class="c">getCurrent(pg, pos);</span></div><div class="line" id="l2105">                    <span class="c">gotoNextItem(pg, pos);</span></div><div class="line" id="l2106">                    <span class="c">return true;</span></div><div class="line" id="l2107">                }
</div><div class="line" id="l2108">                <span class="c">hasCurrent = false;</span></div><div class="line" id="l2109">                <span class="c">return false;</span></div><div class="line" id="l2110">            }
</div><div class="line" id="l2111"><br></div><div class="line" id="l2112">            protected virtual void getCurrent(BtreePage pg, int pos)
</div><div class="line" id="l2113">            {
</div><div class="line" id="l2114">                <span class="c">curr = pg.items[pos];</span></div><div class="line" id="l2115">            <span class="c">}</span></div><div class="line" id="l2116"><br></div><div class="line" id="l2117">            public virtual V Current 
</div><div class="line" id="l2118">            {
</div><div class="line" id="l2119">                get 
</div><div class="line" id="l2120">                {
</div><div class="line" id="l2121">                    <span class="c">if (!hasCurrent)</span></div><div class="line" id="l2122">                    { 
</div><div class="line" id="l2123">                        <span class="c">throw new InvalidOperationException();</span></div><div class="line" id="l2124">                    }
</div><div class="line" id="l2125">                    <span class="c">return (V)curr;</span></div><div class="line" id="l2126">                }
</div><div class="line" id="l2127">            }
</div><div class="line" id="l2128"><br></div><div class="line" id="l2129">            object IEnumerator.Current
</div><div class="line" id="l2130">            {
</div><div class="line" id="l2131">                get
</div><div class="line" id="l2132">                {
</div><div class="line" id="l2133">                    return Current;
</div><div class="line" id="l2134">                }
</div><div class="line" id="l2135">            }
</div><div class="line" id="l2136"><br></div><div class="line" id="l2137">            protected internal void gotoNextItem(BtreePage pg, int pos)
</div><div class="line" id="l2138">            {
</div><div class="line" id="l2139">                <span class="c">if (order == IterationOrder.AscentOrder)</span></div><div class="line" id="l2140">                {
</div><div class="line" id="l2141">                    <span class="c">if (++pos == end)</span></div><div class="line" id="l2142">                    {
</div><div class="line" id="l2143">                        <span class="c">while (--sp != 0)</span></div><div class="line" id="l2144">                        {
</div><div class="line" id="l2145">                            <span class="c">pos = posStack[sp - 1];</span></div><div class="line" id="l2146">                            <span class="c">pg = pageStack[sp - 1];</span></div><div class="line" id="l2147">                            <span class="c">if (++pos &lt;= pg.nItems)</span></div><div class="line" id="l2148">                            {
</div><div class="line" id="l2149">                                <span class="c">posStack[sp - 1] = pos;</span></div><div class="line" id="l2150">                                do 
</div><div class="line" id="l2151">                                {
</div><div class="line" id="l2152">                                    <span class="c">pg = (BtreePage) pg.items[pos];</span></div><div class="line" id="l2153">                                    <span class="c">end = pg.nItems;</span></div><div class="line" id="l2154">                                    <span class="c">pageStack[sp] = pg;</span></div><div class="line" id="l2155">                                    <span class="c">posStack[sp] = pos = 0;</span></div><div class="line" id="l2156">                                }
</div><div class="line" id="l2157">                                <span class="c">while (++sp &lt; pageStack.Length);</span></div><div class="line" id="l2158">                                <span class="c">break;</span></div><div class="line" id="l2159">                            }
</div><div class="line" id="l2160">                        }
</div><div class="line" id="l2161">                    }
</div><div class="line" id="l2162">                    else
</div><div class="line" id="l2163">                    {
</div><div class="line" id="l2164">                        <span class="c">posStack[sp - 1] = pos;</span></div><div class="line" id="l2165">                    }
</div><div class="line" id="l2166">                    <span class="c">if (sp != 0 &amp;&amp; till != null &amp;&amp; - pg.compare(till, pos) &gt;= till.inclusion)</span></div><div class="line" id="l2167">                    {
</div><div class="line" id="l2168">                        <span class="c">sp = 0;</span></div><div class="line" id="l2169">                    }
</div><div class="line" id="l2170">                }
</div><div class="line" id="l2171">                else
</div><div class="line" id="l2172">                {
</div><div class="line" id="l2173">                    // descent order
</div><div class="line" id="l2174">                    <span class="c">if (--pos &lt; 0)</span></div><div class="line" id="l2175">                    {
</div><div class="line" id="l2176">                        <span class="c">while (--sp != 0)</span></div><div class="line" id="l2177">                        {
</div><div class="line" id="l2178">                            <span class="c">pos = posStack[sp - 1];</span></div><div class="line" id="l2179">                            <span class="c">pg = pageStack[sp - 1];</span></div><div class="line" id="l2180">                            <span class="c">if (--pos &gt;= 0)</span></div><div class="line" id="l2181">                            {
</div><div class="line" id="l2182">                                <span class="c">posStack[sp - 1] = pos;</span></div><div class="line" id="l2183">                                do 
</div><div class="line" id="l2184">                                {
</div><div class="line" id="l2185">                                    <span class="c">pg = (BtreePage) pg.items[pos];</span></div><div class="line" id="l2186">                                    <span class="c">pageStack[sp] = pg;</span></div><div class="line" id="l2187">                                    <span class="c">posStack[sp] = pos = pg.nItems;</span></div><div class="line" id="l2188">                                }
</div><div class="line" id="l2189">                                <span class="c">while (++sp &lt; pageStack.Length);</span></div><div class="line" id="l2190">                                <span class="c">posStack[sp - 1] = --pos;</span></div><div class="line" id="l2191">                                <span class="c">break;</span></div><div class="line" id="l2192">                            }
</div><div class="line" id="l2193">                        }
</div><div class="line" id="l2194">                    }
</div><div class="line" id="l2195">                    else
</div><div class="line" id="l2196">                    {
</div><div class="line" id="l2197">                        <span class="c">posStack[sp - 1] = pos;</span></div><div class="line" id="l2198">                    }
</div><div class="line" id="l2199">                    <span class="c">if (sp != 0 &amp;&amp; from != null &amp;&amp; pg.compare(from, pos) &gt;= from.inclusion)</span></div><div class="line" id="l2200">                    {
</div><div class="line" id="l2201">                        <span class="c">sp = 0;</span></div><div class="line" id="l2202">                    }
</div><div class="line" id="l2203">                }
</div><div class="line" id="l2204">            <span class="c">}</span></div><div class="line" id="l2205"><br></div><div class="line" id="l2206">            protected BtreePage[] pageStack;
</div><div class="line" id="l2207">            protected int[] posStack;
</div><div class="line" id="l2208">            protected int sp;
</div><div class="line" id="l2209">            protected int end;
</div><div class="line" id="l2210">            protected Key from;
</div><div class="line" id="l2211">            protected Key till;
</div><div class="line" id="l2212">            protected IterationOrder order;
</div><div class="line" id="l2213">            protected int counter;
</div><div class="line" id="l2214">            protected bool hasCurrent;
</div><div class="line" id="l2215">            protected IPersistent curr;
</div><div class="line" id="l2216">            protected AltBtree&lt;K,V&gt; tree;
</div><div class="line" id="l2217">        }
</div><div class="line" id="l2218"><br></div><div class="line" id="l2219">        class BtreeDictionarySelectionIterator : BtreeSelectionIterator, IDictionaryEnumerator 
</div><div class="line" id="l2220">        { 
</div><div class="line" id="l2221">            internal BtreeDictionarySelectionIterator(AltBtree&lt;K,V&gt; tree, Key from, Key till, IterationOrder order) 
</div><div class="line" id="l2222">                : base(tree, from, till, order)
</div><div class="line" id="l2223">            {}
</div><div class="line" id="l2224"><br></div><div class="line" id="l2225">            protected override void getCurrent(BtreePage pg, int pos)
</div><div class="line" id="l2226">            {
</div><div class="line" id="l2227">                base.getCurrent(pg, pos);
</div><div class="line" id="l2228">                key = pg.getKeyValue(pos);
</div><div class="line" id="l2229">            }
</div><div class="line" id="l2230"><br></div><div class="line" id="l2231">            public new virtual object Current 
</div><div class="line" id="l2232">            {
</div><div class="line" id="l2233">                get 
</div><div class="line" id="l2234">                {
</div><div class="line" id="l2235">                    return Entry;
</div><div class="line" id="l2236">                }
</div><div class="line" id="l2237">            }
</div><div class="line" id="l2238"><br></div><div class="line" id="l2239">            public DictionaryEntry Entry 
</div><div class="line" id="l2240">            {
</div><div class="line" id="l2241">                get 
</div><div class="line" id="l2242">                {
</div><div class="line" id="l2243">                    if (!hasCurrent) 
</div><div class="line" id="l2244">                    { 
</div><div class="line" id="l2245">                        throw new InvalidOperationException();
</div><div class="line" id="l2246">                    }
</div><div class="line" id="l2247">                    return new DictionaryEntry(key, curr);
</div><div class="line" id="l2248">                }
</div><div class="line" id="l2249">            }
</div><div class="line" id="l2250"><br></div><div class="line" id="l2251">            public object Key 
</div><div class="line" id="l2252">            {
</div><div class="line" id="l2253">                get 
</div><div class="line" id="l2254">                {
</div><div class="line" id="l2255">                    if (!hasCurrent) 
</div><div class="line" id="l2256">                    { 
</div><div class="line" id="l2257">                        throw new InvalidOperationException();
</div><div class="line" id="l2258">                    }
</div><div class="line" id="l2259">                    return key;
</div><div class="line" id="l2260">                }
</div><div class="line" id="l2261">            }
</div><div class="line" id="l2262"><br></div><div class="line" id="l2263">            public object Value 
</div><div class="line" id="l2264">            {
</div><div class="line" id="l2265">                get 
</div><div class="line" id="l2266">                {
</div><div class="line" id="l2267">                    if (!hasCurrent) 
</div><div class="line" id="l2268">                    { 
</div><div class="line" id="l2269">                        throw new InvalidOperationException();
</div><div class="line" id="l2270">                    }
</div><div class="line" id="l2271">                    return curr;
</div><div class="line" id="l2272">                }
</div><div class="line" id="l2273">            }
</div><div class="line" id="l2274"><br></div><div class="line" id="l2275">            protected object key;
</div><div class="line" id="l2276">        }
</div><div class="line" id="l2277"><br></div><div class="line" id="l2278">        public IEnumerator&lt;V&gt; GetEnumerator(Key from, Key till, IterationOrder order) 
</div><div class="line" id="l2279">        {
</div><div class="line" id="l2280">            return Range(from, till, order).GetEnumerator();
</div><div class="line" id="l2281">        }
</div><div class="line" id="l2282"><br></div><div class="line" id="l2283">        public IEnumerator&lt;V&gt; GetEnumerator(K from, K till, IterationOrder order) 
</div><div class="line" id="l2284">        {
</div><div class="line" id="l2285">            return Range(from, till, order).GetEnumerator();
</div><div class="line" id="l2286">        }
</div><div class="line" id="l2287"><br></div><div class="line" id="l2288">        public IEnumerator&lt;V&gt; GetEnumerator(Key from, Key till) 
</div><div class="line" id="l2289">        {
</div><div class="line" id="l2290">            return Range(from, till).GetEnumerator();
</div><div class="line" id="l2291">        }
</div><div class="line" id="l2292"><br></div><div class="line" id="l2293">        public IEnumerator&lt;V&gt; GetEnumerator(K from, K till) 
</div><div class="line" id="l2294">        {
</div><div class="line" id="l2295">            return Range(from, till).GetEnumerator();
</div><div class="line" id="l2296">        }
</div><div class="line" id="l2297"><br></div><div class="line" id="l2298">        public IEnumerator&lt;V&gt; GetEnumerator(string prefix) 
</div><div class="line" id="l2299">        {
</div><div class="line" id="l2300">            return StartsWith(prefix).GetEnumerator();
</div><div class="line" id="l2301">        }
</div><div class="line" id="l2302"><br></div><div class="line" id="l2303">        public virtual IEnumerable&lt;V&gt; Range(Key from, Key till, IterationOrder order) 
</div><div class="line" id="l2304">        { 
</div><div class="line" id="l2305">            <span class="c">return new BtreeSelectionIterator(this, checkKey(from), checkKey(till), order);</span></div><div class="line" id="l2306">        }
</div><div class="line" id="l2307"><br></div><div class="line" id="l2308">        public virtual IEnumerable&lt;V&gt; Range(Key from, Key till) 
</div><div class="line" id="l2309">        { 
</div><div class="line" id="l2310">            return Range(from, till, IterationOrder.AscentOrder);
</div><div class="line" id="l2311">        }
</div><div class="line" id="l2312"><br></div><div class="line" id="l2313">        public IEnumerable&lt;V&gt; Range(K from, K till, IterationOrder order) 
</div><div class="line" id="l2314">        { 
</div><div class="line" id="l2315">            return Range(KeyBuilder.getKeyFromObject(from), KeyBuilder.getKeyFromObject(till), order);
</div><div class="line" id="l2316">        }
</div><div class="line" id="l2317"><br></div><div class="line" id="l2318">        public IEnumerable&lt;V&gt; Range(K from, K till) 
</div><div class="line" id="l2319">        { 
</div><div class="line" id="l2320">            return Range(KeyBuilder.getKeyFromObject(from), KeyBuilder.getKeyFromObject(till), IterationOrder.AscentOrder);
</div><div class="line" id="l2321">        }
</div><div class="line" id="l2322"><br></div><div class="line" id="l2323">        public IEnumerable&lt;V&gt; Reverse()
</div><div class="line" id="l2324">        { 
</div><div class="line" id="l2325">            return new BtreeSelectionIterator(this, null, null, IterationOrder.DescentOrder);
</div><div class="line" id="l2326">        }
</div><div class="line" id="l2327"><br></div><div class="line" id="l2328">        public IEnumerable&lt;V&gt; StartsWith(string prefix) 
</div><div class="line" id="l2329">        { 
</div><div class="line" id="l2330">            return Range(new Key(prefix), new Key(prefix + Char.MaxValue, false), IterationOrder.AscentOrder);
</div><div class="line" id="l2331">        }
</div><div class="line" id="l2332"><br></div><div class="line" id="l2333">        public virtual IDictionaryEnumerator GetDictionaryEnumerator(Key from, Key till, IterationOrder order) 
</div><div class="line" id="l2334">        { 
</div><div class="line" id="l2335">            return new BtreeDictionarySelectionIterator(this, checkKey(from), checkKey(till), order);
</div><div class="line" id="l2336">        }        
</div><div class="line" id="l2337">    }
</div><div class="line" id="l2338">}
</div>
  </pre>
  </td>
  </tr>
</tbody>
</table>
</body>
</html>