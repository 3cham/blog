
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type=text/css> 
pre,code {font-size:9pt; font:Consolas,Monaco,"Courier New","DejaVu Sans Mono","Bitstream Vera Sans Mono",monospace;}
.c { background-color: #96EBA6; }
</style>
</head>
<body>
<pre><a href="index.html">Home</a> : csharp\src\impl\XMLImporter.cs</pre>
<table cellpadding="0" cellspacing="0">
<tbody>
  <tr>
  <td style="margin:0px; vertical-align:top">
  <pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
<span>7</span>
<span>8</span>
<span>9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span>
<span>22</span>
<span>23</span>
<span>24</span>
<span>25</span>
<span>26</span>
<span>27</span>
<span>28</span>
<span>29</span>
<span>30</span>
<span>31</span>
<span>32</span>
<span>33</span>
<span>34</span>
<span>35</span>
<span>36</span>
<span>37</span>
<span>38</span>
<span>39</span>
<span>40</span>
<span>41</span>
<span>42</span>
<span>43</span>
<span>44</span>
<span>45</span>
<span>46</span>
<span>47</span>
<span>48</span>
<span>49</span>
<span>50</span>
<span>51</span>
<span>52</span>
<span>53</span>
<span>54</span>
<span>55</span>
<span>56</span>
<span>57</span>
<span>58</span>
<span>59</span>
<span>60</span>
<span>61</span>
<span>62</span>
<span>63</span>
<span>64</span>
<span>65</span>
<span>66</span>
<span>67</span>
<span>68</span>
<span>69</span>
<span>70</span>
<span>71</span>
<span>72</span>
<span>73</span>
<span>74</span>
<span>75</span>
<span>76</span>
<span>77</span>
<span>78</span>
<span>79</span>
<span>80</span>
<span>81</span>
<span>82</span>
<span>83</span>
<span>84</span>
<span>85</span>
<span>86</span>
<span>87</span>
<span>88</span>
<span>89</span>
<span>90</span>
<span>91</span>
<span>92</span>
<span>93</span>
<span>94</span>
<span>95</span>
<span>96</span>
<span>97</span>
<span>98</span>
<span>99</span>
<span>100</span>
<span>101</span>
<span>102</span>
<span>103</span>
<span>104</span>
<span>105</span>
<span>106</span>
<span>107</span>
<span>108</span>
<span>109</span>
<span>110</span>
<span>111</span>
<span>112</span>
<span>113</span>
<span>114</span>
<span>115</span>
<span>116</span>
<span>117</span>
<span>118</span>
<span>119</span>
<span>120</span>
<span>121</span>
<span>122</span>
<span>123</span>
<span>124</span>
<span>125</span>
<span>126</span>
<span>127</span>
<span>128</span>
<span>129</span>
<span>130</span>
<span>131</span>
<span>132</span>
<span>133</span>
<span>134</span>
<span>135</span>
<span>136</span>
<span>137</span>
<span>138</span>
<span>139</span>
<span>140</span>
<span>141</span>
<span>142</span>
<span>143</span>
<span>144</span>
<span>145</span>
<span>146</span>
<span>147</span>
<span>148</span>
<span>149</span>
<span>150</span>
<span>151</span>
<span>152</span>
<span>153</span>
<span>154</span>
<span>155</span>
<span>156</span>
<span>157</span>
<span>158</span>
<span>159</span>
<span>160</span>
<span>161</span>
<span>162</span>
<span>163</span>
<span>164</span>
<span>165</span>
<span>166</span>
<span>167</span>
<span>168</span>
<span>169</span>
<span>170</span>
<span>171</span>
<span>172</span>
<span>173</span>
<span>174</span>
<span>175</span>
<span>176</span>
<span>177</span>
<span>178</span>
<span>179</span>
<span>180</span>
<span>181</span>
<span>182</span>
<span>183</span>
<span>184</span>
<span>185</span>
<span>186</span>
<span>187</span>
<span>188</span>
<span>189</span>
<span>190</span>
<span>191</span>
<span>192</span>
<span>193</span>
<span>194</span>
<span>195</span>
<span>196</span>
<span>197</span>
<span>198</span>
<span>199</span>
<span>200</span>
<span>201</span>
<span>202</span>
<span>203</span>
<span>204</span>
<span>205</span>
<span>206</span>
<span>207</span>
<span>208</span>
<span>209</span>
<span>210</span>
<span>211</span>
<span>212</span>
<span>213</span>
<span>214</span>
<span>215</span>
<span>216</span>
<span>217</span>
<span>218</span>
<span>219</span>
<span>220</span>
<span>221</span>
<span>222</span>
<span>223</span>
<span>224</span>
<span>225</span>
<span>226</span>
<span>227</span>
<span>228</span>
<span>229</span>
<span>230</span>
<span>231</span>
<span>232</span>
<span>233</span>
<span>234</span>
<span>235</span>
<span>236</span>
<span>237</span>
<span>238</span>
<span>239</span>
<span>240</span>
<span>241</span>
<span>242</span>
<span>243</span>
<span>244</span>
<span>245</span>
<span>246</span>
<span>247</span>
<span>248</span>
<span>249</span>
<span>250</span>
<span>251</span>
<span>252</span>
<span>253</span>
<span>254</span>
<span>255</span>
<span>256</span>
<span>257</span>
<span>258</span>
<span>259</span>
<span>260</span>
<span>261</span>
<span>262</span>
<span>263</span>
<span>264</span>
<span>265</span>
<span>266</span>
<span>267</span>
<span>268</span>
<span>269</span>
<span>270</span>
<span>271</span>
<span>272</span>
<span>273</span>
<span>274</span>
<span>275</span>
<span>276</span>
<span>277</span>
<span>278</span>
<span>279</span>
<span>280</span>
<span>281</span>
<span>282</span>
<span>283</span>
<span>284</span>
<span>285</span>
<span>286</span>
<span>287</span>
<span>288</span>
<span>289</span>
<span>290</span>
<span>291</span>
<span>292</span>
<span>293</span>
<span>294</span>
<span>295</span>
<span>296</span>
<span>297</span>
<span>298</span>
<span>299</span>
<span>300</span>
<span>301</span>
<span>302</span>
<span>303</span>
<span>304</span>
<span>305</span>
<span>306</span>
<span>307</span>
<span>308</span>
<span>309</span>
<span>310</span>
<span>311</span>
<span>312</span>
<span>313</span>
<span>314</span>
<span>315</span>
<span>316</span>
<span>317</span>
<span>318</span>
<span>319</span>
<span>320</span>
<span>321</span>
<span>322</span>
<span>323</span>
<span>324</span>
<span>325</span>
<span>326</span>
<span>327</span>
<span>328</span>
<span>329</span>
<span>330</span>
<span>331</span>
<span>332</span>
<span>333</span>
<span>334</span>
<span>335</span>
<span>336</span>
<span>337</span>
<span>338</span>
<span>339</span>
<span>340</span>
<span>341</span>
<span>342</span>
<span>343</span>
<span>344</span>
<span>345</span>
<span>346</span>
<span>347</span>
<span>348</span>
<span>349</span>
<span>350</span>
<span>351</span>
<span>352</span>
<span>353</span>
<span>354</span>
<span>355</span>
<span>356</span>
<span>357</span>
<span>358</span>
<span>359</span>
<span>360</span>
<span>361</span>
<span>362</span>
<span>363</span>
<span>364</span>
<span>365</span>
<span>366</span>
<span>367</span>
<span>368</span>
<span>369</span>
<span>370</span>
<span>371</span>
<span>372</span>
<span>373</span>
<span>374</span>
<span>375</span>
<span>376</span>
<span>377</span>
<span>378</span>
<span>379</span>
<span>380</span>
<span>381</span>
<span>382</span>
<span>383</span>
<span>384</span>
<span>385</span>
<span>386</span>
<span>387</span>
<span>388</span>
<span>389</span>
<span>390</span>
<span>391</span>
<span>392</span>
<span>393</span>
<span>394</span>
<span>395</span>
<span>396</span>
<span>397</span>
<span>398</span>
<span>399</span>
<span>400</span>
<span>401</span>
<span>402</span>
<span>403</span>
<span>404</span>
<span>405</span>
<span>406</span>
<span>407</span>
<span>408</span>
<span>409</span>
<span>410</span>
<span>411</span>
<span>412</span>
<span>413</span>
<span>414</span>
<span>415</span>
<span>416</span>
<span>417</span>
<span>418</span>
<span>419</span>
<span>420</span>
<span>421</span>
<span>422</span>
<span>423</span>
<span>424</span>
<span>425</span>
<span>426</span>
<span>427</span>
<span>428</span>
<span>429</span>
<span>430</span>
<span>431</span>
<span>432</span>
<span>433</span>
<span>434</span>
<span>435</span>
<span>436</span>
<span>437</span>
<span>438</span>
<span>439</span>
<span>440</span>
<span>441</span>
<span>442</span>
<span>443</span>
<span>444</span>
<span>445</span>
<span>446</span>
<span>447</span>
<span>448</span>
<span>449</span>
<span>450</span>
<span>451</span>
<span>452</span>
<span>453</span>
<span>454</span>
<span>455</span>
<span>456</span>
<span>457</span>
<span>458</span>
<span>459</span>
<span>460</span>
<span>461</span>
<span>462</span>
<span>463</span>
<span>464</span>
<span>465</span>
<span>466</span>
<span>467</span>
<span>468</span>
<span>469</span>
<span>470</span>
<span>471</span>
<span>472</span>
<span>473</span>
<span>474</span>
<span>475</span>
<span>476</span>
<span>477</span>
<span>478</span>
<span>479</span>
<span>480</span>
<span>481</span>
<span>482</span>
<span>483</span>
<span>484</span>
<span>485</span>
<span>486</span>
<span>487</span>
<span>488</span>
<span>489</span>
<span>490</span>
<span>491</span>
<span>492</span>
<span>493</span>
<span>494</span>
<span>495</span>
<span>496</span>
<span>497</span>
<span>498</span>
<span>499</span>
<span>500</span>
<span>501</span>
<span>502</span>
<span>503</span>
<span>504</span>
<span>505</span>
<span>506</span>
<span>507</span>
<span>508</span>
<span>509</span>
<span>510</span>
<span>511</span>
<span>512</span>
<span>513</span>
<span>514</span>
<span>515</span>
<span>516</span>
<span>517</span>
<span>518</span>
<span>519</span>
<span>520</span>
<span>521</span>
<span>522</span>
<span>523</span>
<span>524</span>
<span>525</span>
<span>526</span>
<span>527</span>
<span>528</span>
<span>529</span>
<span>530</span>
<span>531</span>
<span>532</span>
<span>533</span>
<span>534</span>
<span>535</span>
<span>536</span>
<span>537</span>
<span>538</span>
<span>539</span>
<span>540</span>
<span>541</span>
<span>542</span>
<span>543</span>
<span>544</span>
<span>545</span>
<span>546</span>
<span>547</span>
<span>548</span>
<span>549</span>
<span>550</span>
<span>551</span>
<span>552</span>
<span>553</span>
<span>554</span>
<span>555</span>
<span>556</span>
<span>557</span>
<span>558</span>
<span>559</span>
<span>560</span>
<span>561</span>
<span>562</span>
<span>563</span>
<span>564</span>
<span>565</span>
<span>566</span>
<span>567</span>
<span>568</span>
<span>569</span>
<span>570</span>
<span>571</span>
<span>572</span>
<span>573</span>
<span>574</span>
<span>575</span>
<span>576</span>
<span>577</span>
<span>578</span>
<span>579</span>
<span>580</span>
<span>581</span>
<span>582</span>
<span>583</span>
<span>584</span>
<span>585</span>
<span>586</span>
<span>587</span>
<span>588</span>
<span>589</span>
<span>590</span>
<span>591</span>
<span>592</span>
<span>593</span>
<span>594</span>
<span>595</span>
<span>596</span>
<span>597</span>
<span>598</span>
<span>599</span>
<span>600</span>
<span>601</span>
<span>602</span>
<span>603</span>
<span>604</span>
<span>605</span>
<span>606</span>
<span>607</span>
<span>608</span>
<span>609</span>
<span>610</span>
<span>611</span>
<span>612</span>
<span>613</span>
<span>614</span>
<span>615</span>
<span>616</span>
<span>617</span>
<span>618</span>
<span>619</span>
<span>620</span>
<span>621</span>
<span>622</span>
<span>623</span>
<span>624</span>
<span>625</span>
<span>626</span>
<span>627</span>
<span>628</span>
<span>629</span>
<span>630</span>
<span>631</span>
<span>632</span>
<span>633</span>
<span>634</span>
<span>635</span>
<span>636</span>
<span>637</span>
<span>638</span>
<span>639</span>
<span>640</span>
<span>641</span>
<span>642</span>
<span>643</span>
<span>644</span>
<span>645</span>
<span>646</span>
<span>647</span>
<span>648</span>
<span>649</span>
<span>650</span>
<span>651</span>
<span>652</span>
<span>653</span>
<span>654</span>
<span>655</span>
<span>656</span>
<span>657</span>
<span>658</span>
<span>659</span>
<span>660</span>
<span>661</span>
<span>662</span>
<span>663</span>
<span>664</span>
<span>665</span>
<span>666</span>
<span>667</span>
<span>668</span>
<span>669</span>
<span>670</span>
<span>671</span>
<span>672</span>
<span>673</span>
<span>674</span>
<span>675</span>
<span>676</span>
<span>677</span>
<span>678</span>
<span>679</span>
<span>680</span>
<span>681</span>
<span>682</span>
<span>683</span>
<span>684</span>
<span>685</span>
<span>686</span>
<span>687</span>
<span>688</span>
<span>689</span>
<span>690</span>
<span>691</span>
<span>692</span>
<span>693</span>
<span>694</span>
<span>695</span>
<span>696</span>
<span>697</span>
<span>698</span>
<span>699</span>
<span>700</span>
<span>701</span>
<span>702</span>
<span>703</span>
<span>704</span>
<span>705</span>
<span>706</span>
<span>707</span>
<span>708</span>
<span>709</span>
<span>710</span>
<span>711</span>
<span>712</span>
<span>713</span>
<span>714</span>
<span>715</span>
<span>716</span>
<span>717</span>
<span>718</span>
<span>719</span>
<span>720</span>
<span>721</span>
<span>722</span>
<span>723</span>
<span>724</span>
<span>725</span>
<span>726</span>
<span>727</span>
<span>728</span>
<span>729</span>
<span>730</span>
<span>731</span>
<span>732</span>
<span>733</span>
<span>734</span>
<span>735</span>
<span>736</span>
<span>737</span>
<span>738</span>
<span>739</span>
<span>740</span>
<span>741</span>
<span>742</span>
<span>743</span>
<span>744</span>
<span>745</span>
<span>746</span>
<span>747</span>
<span>748</span>
<span>749</span>
<span>750</span>
<span>751</span>
<span>752</span>
<span>753</span>
<span>754</span>
<span>755</span>
<span>756</span>
<span>757</span>
<span>758</span>
<span>759</span>
<span>760</span>
<span>761</span>
<span>762</span>
<span>763</span>
<span>764</span>
<span>765</span>
<span>766</span>
<span>767</span>
<span>768</span>
<span>769</span>
<span>770</span>
<span>771</span>
<span>772</span>
<span>773</span>
<span>774</span>
<span>775</span>
<span>776</span>
<span>777</span>
<span>778</span>
<span>779</span>
<span>780</span>
<span>781</span>
<span>782</span>
<span>783</span>
<span>784</span>
<span>785</span>
<span>786</span>
<span>787</span>
<span>788</span>
<span>789</span>
<span>790</span>
<span>791</span>
<span>792</span>
<span>793</span>
<span>794</span>
<span>795</span>
<span>796</span>
<span>797</span>
<span>798</span>
<span>799</span>
<span>800</span>
<span>801</span>
<span>802</span>
<span>803</span>
<span>804</span>
<span>805</span>
<span>806</span>
<span>807</span>
<span>808</span>
<span>809</span>
<span>810</span>
<span>811</span>
<span>812</span>
<span>813</span>
<span>814</span>
<span>815</span>
<span>816</span>
<span>817</span>
<span>818</span>
<span>819</span>
<span>820</span>
<span>821</span>
<span>822</span>
<span>823</span>
<span>824</span>
<span>825</span>
<span>826</span>
<span>827</span>
<span>828</span>
<span>829</span>
<span>830</span>
<span>831</span>
<span>832</span>
<span>833</span>
<span>834</span>
<span>835</span>
<span>836</span>
<span>837</span>
<span>838</span>
<span>839</span>
<span>840</span>
<span>841</span>
<span>842</span>
<span>843</span>
<span>844</span>
<span>845</span>
<span>846</span>
<span>847</span>
<span>848</span>
<span>849</span>
<span>850</span>
<span>851</span>
<span>852</span>
<span>853</span>
<span>854</span>
<span>855</span>
<span>856</span>
<span>857</span>
<span>858</span>
<span>859</span>
<span>860</span>
<span>861</span>
<span>862</span>
<span>863</span>
<span>864</span>
<span>865</span>
<span>866</span>
<span>867</span>
<span>868</span>
<span>869</span>
<span>870</span>
<span>871</span>
<span>872</span>
<span>873</span>
<span>874</span>
<span>875</span>
<span>876</span>
<span>877</span>
<span>878</span>
<span>879</span>
<span>880</span>
<span>881</span>
<span>882</span>
<span>883</span>
<span>884</span>
<span>885</span>
<span>886</span>
<span>887</span>
<span>888</span>
<span>889</span>
<span>890</span>
<span>891</span>
<span>892</span>
<span>893</span>
<span>894</span>
<span>895</span>
<span>896</span>
<span>897</span>
<span>898</span>
<span>899</span>
<span>900</span>
<span>901</span>
<span>902</span>
<span>903</span>
<span>904</span>
<span>905</span>
<span>906</span>
<span>907</span>
<span>908</span>
<span>909</span>
<span>910</span>
<span>911</span>
<span>912</span>
<span>913</span>
<span>914</span>
<span>915</span>
<span>916</span>
<span>917</span>
<span>918</span>
<span>919</span>
<span>920</span>
<span>921</span>
<span>922</span>
<span>923</span>
<span>924</span>
<span>925</span>
<span>926</span>
<span>927</span>
<span>928</span>
<span>929</span>
<span>930</span>
<span>931</span>
<span>932</span>
<span>933</span>
<span>934</span>
<span>935</span>
<span>936</span>
<span>937</span>
<span>938</span>
<span>939</span>
<span>940</span>
<span>941</span>
<span>942</span>
<span>943</span>
<span>944</span>
<span>945</span>
<span>946</span>
<span>947</span>
<span>948</span>
<span>949</span>
<span>950</span>
<span>951</span>
<span>952</span>
<span>953</span>
<span>954</span>
<span>955</span>
<span>956</span>
<span>957</span>
<span>958</span>
<span>959</span>
<span>960</span>
<span>961</span>
<span>962</span>
<span>963</span>
<span>964</span>
<span>965</span>
<span>966</span>
<span>967</span>
<span>968</span>
<span>969</span>
<span>970</span>
<span>971</span>
<span>972</span>
<span>973</span>
<span>974</span>
<span>975</span>
<span>976</span>
<span>977</span>
<span>978</span>
<span>979</span>
<span>980</span>
<span>981</span>
<span>982</span>
<span>983</span>
<span>984</span>
<span>985</span>
<span>986</span>
<span>987</span>
<span>988</span>
<span>989</span>
<span>990</span>
<span>991</span>
<span>992</span>
<span>993</span>
<span>994</span>
<span>995</span>
<span>996</span>
<span>997</span>
<span>998</span>
<span>999</span>
<span>1000</span>
<span>1001</span>
<span>1002</span>
<span>1003</span>
<span>1004</span>
<span>1005</span>
<span>1006</span>
<span>1007</span>
<span>1008</span>
<span>1009</span>
<span>1010</span>
<span>1011</span>
<span>1012</span>
<span>1013</span>
<span>1014</span>
<span>1015</span>
<span>1016</span>
<span>1017</span>
<span>1018</span>
<span>1019</span>
<span>1020</span>
<span>1021</span>
<span>1022</span>
<span>1023</span>
<span>1024</span>
<span>1025</span>
<span>1026</span>
<span>1027</span>
<span>1028</span>
<span>1029</span>
<span>1030</span>
<span>1031</span>
<span>1032</span>
<span>1033</span>
<span>1034</span>
<span>1035</span>
<span>1036</span>
<span>1037</span>
<span>1038</span>
<span>1039</span>
<span>1040</span>
<span>1041</span>
<span>1042</span>
<span>1043</span>
<span>1044</span>
<span>1045</span>
<span>1046</span>
<span>1047</span>
<span>1048</span>
<span>1049</span>
<span>1050</span>
<span>1051</span>
<span>1052</span>
<span>1053</span>
<span>1054</span>
<span>1055</span>
<span>1056</span>
<span>1057</span>
<span>1058</span>
<span>1059</span>
<span>1060</span>
<span>1061</span>
<span>1062</span>
<span>1063</span>
<span>1064</span>
<span>1065</span>
<span>1066</span>
<span>1067</span>
<span>1068</span>
<span>1069</span>
<span>1070</span>
<span>1071</span>
<span>1072</span>
<span>1073</span>
<span>1074</span>
<span>1075</span>
<span>1076</span>
<span>1077</span>
<span>1078</span>
<span>1079</span>
<span>1080</span>
<span>1081</span>
<span>1082</span>
<span>1083</span>
<span>1084</span>
<span>1085</span>
<span>1086</span>
<span>1087</span>
<span>1088</span>
<span>1089</span>
<span>1090</span>
<span>1091</span>
<span>1092</span>
<span>1093</span>
<span>1094</span>
<span>1095</span>
<span>1096</span>
<span>1097</span>
<span>1098</span>
<span>1099</span>
<span>1100</span>
<span>1101</span>
<span>1102</span>
<span>1103</span>
<span>1104</span>
<span>1105</span>
<span>1106</span>
<span>1107</span>
<span>1108</span>
<span>1109</span>
<span>1110</span>
<span>1111</span>
<span>1112</span>
<span>1113</span>
<span>1114</span>
<span>1115</span>
<span>1116</span>
<span>1117</span>
<span>1118</span>
<span>1119</span>
<span>1120</span>
<span>1121</span>
<span>1122</span>
<span>1123</span>
<span>1124</span>
<span>1125</span>
<span>1126</span>
<span>1127</span>
<span>1128</span>
<span>1129</span>
<span>1130</span>
<span>1131</span>
<span>1132</span>
<span>1133</span>
<span>1134</span>
<span>1135</span>
<span>1136</span>
<span>1137</span>
<span>1138</span>
<span>1139</span>
<span>1140</span>
<span>1141</span>
<span>1142</span>
<span>1143</span>
<span>1144</span>
<span>1145</span>
<span>1146</span>
<span>1147</span>
<span>1148</span>
<span>1149</span>
<span>1150</span>
<span>1151</span>
<span>1152</span>
<span>1153</span>
<span>1154</span>
<span>1155</span>
<span>1156</span>
<span>1157</span>
<span>1158</span>
<span>1159</span>
<span>1160</span>
<span>1161</span>
<span>1162</span>
<span>1163</span>
<span>1164</span>
<span>1165</span>
<span>1166</span>
<span>1167</span>
<span>1168</span>
<span>1169</span>
<span>1170</span>
<span>1171</span>
<span>1172</span>
<span>1173</span>
<span>1174</span>
<span>1175</span>
<span>1176</span>
<span>1177</span>
<span>1178</span>
<span>1179</span>
<span>1180</span>
<span>1181</span>
<span>1182</span>
<span>1183</span>
<span>1184</span>
<span>1185</span>
<span>1186</span>
<span>1187</span>
<span>1188</span>
<span>1189</span>
<span>1190</span>
<span>1191</span>
<span>1192</span>
<span>1193</span>
<span>1194</span>
<span>1195</span>
<span>1196</span>
<span>1197</span>
<span>1198</span>
<span>1199</span>
<span>1200</span>
<span>1201</span>
<span>1202</span>
<span>1203</span>
<span>1204</span>
<span>1205</span>
<span>1206</span>
<span>1207</span>
<span>1208</span>
<span>1209</span>
<span>1210</span>
<span>1211</span>
<span>1212</span>
<span>1213</span>
<span>1214</span>
<span>1215</span>
<span>1216</span>
<span>1217</span>
<span>1218</span>
<span>1219</span>
<span>1220</span>
<span>1221</span>
<span>1222</span>
<span>1223</span>
<span>1224</span>
<span>1225</span>
<span>1226</span>
<span>1227</span>
<span>1228</span>
<span>1229</span>
<span>1230</span>
<span>1231</span>
<span>1232</span>
<span>1233</span>
<span>1234</span>
<span>1235</span>
<span>1236</span>
<span>1237</span>
<span>1238</span>
<span>1239</span>
<span>1240</span>
<span>1241</span>
<span>1242</span>
<span>1243</span>
<span>1244</span>
<span>1245</span>
<span>1246</span>
<span>1247</span>
<span>1248</span>
<span>1249</span>
<span>1250</span>
<span>1251</span>
<span>1252</span>
<span>1253</span>
<span>1254</span>
<span>1255</span>
<span>1256</span>
<span>1257</span>
<span>1258</span>
<span>1259</span>
<span>1260</span>
<span>1261</span>
<span>1262</span>
<span>1263</span>
<span>1264</span>
<span>1265</span>
<span>1266</span>
<span>1267</span>
<span>1268</span>
<span>1269</span>
<span>1270</span>
<span>1271</span>
<span>1272</span>
<span>1273</span>
<span>1274</span>
<span>1275</span>
<span>1276</span>
<span>1277</span>
<span>1278</span>
<span>1279</span>
<span>1280</span>
<span>1281</span>
<span>1282</span>
<span>1283</span>
<span>1284</span>
<span>1285</span>
<span>1286</span>
<span>1287</span>
<span>1288</span>
<span>1289</span>
<span>1290</span>
<span>1291</span>
<span>1292</span>
<span>1293</span>
<span>1294</span>
<span>1295</span>
<span>1296</span>
<span>1297</span>
<span>1298</span>
<span>1299</span>
<span>1300</span>
<span>1301</span>
<span>1302</span>
<span>1303</span>
<span>1304</span>
<span>1305</span>
<span>1306</span>
<span>1307</span>
<span>1308</span>
<span>1309</span>
<span>1310</span>
<span>1311</span>
<span>1312</span>
<span>1313</span>
<span>1314</span>
<span>1315</span>
<span>1316</span>
<span>1317</span>
<span>1318</span>
<span>1319</span>
<span>1320</span>
<span>1321</span>
<span>1322</span>
<span>1323</span>
<span>1324</span>
<span>1325</span>
<span>1326</span>
<span>1327</span>
<span>1328</span>
<span>1329</span>
<span>1330</span>
<span>1331</span>
<span>1332</span>
<span>1333</span>
<span>1334</span>
<span>1335</span>
<span>1336</span>
<span>1337</span>
<span>1338</span>
<span>1339</span>
<span>1340</span>
<span>1341</span>
<span>1342</span>
<span>1343</span>
<span>1344</span>
<span>1345</span>
<span>1346</span>
<span>1347</span>
<span>1348</span>
<span>1349</span>
<span>1350</span>
<span>1351</span>
<span>1352</span>
<span>1353</span>
<span>1354</span>
<span>1355</span>
<span>1356</span>
<span>1357</span>
<span>1358</span>
<span>1359</span>
<span>1360</span>
<span>1361</span>
<span>1362</span>
<span>1363</span>
<span>1364</span>
<span>1365</span>
<span>1366</span>
<span>1367</span>
<span>1368</span>
<span>1369</span>
<span>1370</span>
<span>1371</span>
<span>1372</span>
<span>1373</span>
<span>1374</span>
<span>1375</span>
<span>1376</span>
<span>1377</span>
<span>1378</span>
<span>1379</span>
<span>1380</span>
<span>1381</span>
<span>1382</span>
<span>1383</span>
<span>1384</span>
<span>1385</span>
<span>1386</span>
<span>1387</span>
<span>1388</span>
<span>1389</span>
<span>1390</span>
<span>1391</span>
<span>1392</span>
<span>1393</span>
<span>1394</span>
<span>1395</span>
<span>1396</span>
<span>1397</span>
<span>1398</span>
<span>1399</span>
<span>1400</span>
<span>1401</span>
<span>1402</span>
<span>1403</span>
<span>1404</span>
<span>1405</span>
<span>1406</span>
<span>1407</span>
<span>1408</span>
<span>1409</span>
<span>1410</span>
<span>1411</span>
<span>1412</span>
<span>1413</span>
<span>1414</span>
<span>1415</span>
<span>1416</span>
<span>1417</span>
<span>1418</span>
<span>1419</span>
<span>1420</span>
<span>1421</span>
<span>1422</span>
<span>1423</span>
<span>1424</span>
<span>1425</span>
<span>1426</span>
<span>1427</span>
<span>1428</span>
<span>1429</span>
<span>1430</span>
<span>1431</span>
<span>1432</span>
<span>1433</span>
<span>1434</span>
<span>1435</span>
<span>1436</span>
<span>1437</span>
<span>1438</span>
<span>1439</span>
<span>1440</span>
<span>1441</span>
<span>1442</span>
<span>1443</span>
<span>1444</span>
<span>1445</span>
<span>1446</span>
<span>1447</span>
<span>1448</span>
<span>1449</span>
<span>1450</span>
<span>1451</span>
<span>1452</span>
<span>1453</span>
<span>1454</span>
<span>1455</span>
<span>1456</span>
<span>1457</span>
<span>1458</span>
<span>1459</span>
<span>1460</span>
<span>1461</span>
<span>1462</span>
<span>1463</span>
<span>1464</span>
<span>1465</span>
<span>1466</span>
<span>1467</span>
<span>1468</span>
<span>1469</span>
<span>1470</span>
<span>1471</span>
<span>1472</span>
<span>1473</span>
<span>1474</span>
<span>1475</span>
<span>1476</span>
<span>1477</span>
<span>1478</span>
<span>1479</span>
<span>1480</span>
<span>1481</span>
<span>1482</span>
<span>1483</span>
<span>1484</span>
<span>1485</span>
<span>1486</span>
<span>1487</span>
<span>1488</span>
<span>1489</span>
<span>1490</span>
<span>1491</span>
<span>1492</span>
<span>1493</span>
<span>1494</span>
<span>1495</span>
<span>1496</span>
<span>1497</span>
<span>1498</span>
<span>1499</span>
<span>1500</span>
<span>1501</span>
<span>1502</span>
<span>1503</span>
<span>1504</span>
<span>1505</span>
<span>1506</span>
<span>1507</span>
<span>1508</span>
<span>1509</span>
<span>1510</span>
<span>1511</span>
<span>1512</span>
<span>1513</span>
<span>1514</span>
<span>1515</span>
<span>1516</span>
<span>1517</span>
<span>1518</span>
<span>1519</span>
<span>1520</span>
<span>1521</span>
<span>1522</span>
<span>1523</span>
<span>1524</span>
<span>1525</span>
<span>1526</span>
<span>1527</span>
<span>1528</span>
<span>1529</span>
<span>1530</span>
<span>1531</span>
<span>1532</span>
<span>1533</span>
<span>1534</span>
<span>1535</span>
<span>1536</span>
<span>1537</span>
<span>1538</span>
<span>1539</span>
<span>1540</span>
<span>1541</span>
<span>1542</span>
<span>1543</span>
<span>1544</span>
<span>1545</span>
<span>1546</span>
<span>1547</span>
<span>1548</span>
<span>1549</span>
<span>1550</span>
<span>1551</span>
<span>1552</span>
<span>1553</span>
<span>1554</span>
<span>1555</span>
<span>1556</span>
<span>1557</span>
<span>1558</span>
<span>1559</span>
<span>1560</span>
<span>1561</span>
<span>1562</span>
<span>1563</span>
<span>1564</span>
<span>1565</span>
<span>1566</span>
<span>1567</span>
<span>1568</span>
<span>1569</span>
<span>1570</span>
<span>1571</span>
<span>1572</span>
<span>1573</span>
<span>1574</span>
<span>1575</span>
<span>1576</span>
<span>1577</span>
<span>1578</span>
<span>1579</span>
<span>1580</span>
<span>1581</span>
<span>1582</span>
<span>1583</span>
<span>1584</span>
<span>1585</span>
<span>1586</span>
<span>1587</span>
<span>1588</span>
<span>1589</span>
<span>1590</span>
<span>1591</span>
<span>1592</span>
<span>1593</span>
<span>1594</span>
<span>1595</span>
<span>1596</span>
<span>1597</span>
<span>1598</span>
<span>1599</span>
<span>1600</span>
<span>1601</span>
<span>1602</span>
<span>1603</span>
<span>1604</span>
<span>1605</span>
<span>1606</span>
<span>1607</span>
<span>1608</span>
<span>1609</span>
<span>1610</span>
<span>1611</span>
<span>1612</span>
<span>1613</span>
<span>1614</span>
<span>1615</span>
<span>1616</span>
<span>1617</span>
<span>1618</span>
<span>1619</span>
<span>1620</span>
<span>1621</span>
<span>1622</span>
<span>1623</span>
<span>1624</span>
<span>1625</span>
<span>1626</span>
<span>1627</span>
<span>1628</span>
<span>1629</span>
<span>1630</span>
<span>1631</span>
<span>1632</span>
<span>1633</span>
<span>1634</span>
<span>1635</span>
<span>1636</span>
<span>1637</span>
<span>1638</span>
<span>1639</span>
<span>1640</span>
<span>1641</span>
<span>1642</span>
<span>1643</span>
<span>1644</span>
<span>1645</span>
<span>1646</span>
<span>1647</span>
<span>1648</span>
<span>1649</span>
<span>1650</span>
<span>1651</span>
<span>1652</span>
<span>1653</span>
<span>1654</span>
<span>1655</span>
<span>1656</span>
<span>1657</span>
<span>1658</span>
<span>1659</span>
<span>1660</span>
<span>1661</span>
<span>1662</span>
<span>1663</span>
<span>1664</span>
<span>1665</span>
<span>1666</span>
<span>1667</span>
<span>1668</span>
<span>1669</span>
<span>1670</span>
<span>1671</span>
<span>1672</span>
<span>1673</span>
<span>1674</span>
<span>1675</span>
<span>1676</span>
<span>1677</span>
<span>1678</span>
<span>1679</span>
<span>1680</span>
<span>1681</span>
<span>1682</span>
<span>1683</span>
<span>1684</span>
<span>1685</span>
<span>1686</span>
<span>1687</span>
<span>1688</span>
<span>1689</span>
<span>1690</span>
<span>1691</span>
<span>1692</span>
<span>1693</span>
<span>1694</span>
<span>1695</span>
<span>1696</span>
<span>1697</span>
<span>1698</span>
<span>1699</span>
<span>1700</span>
<span>1701</span>
<span>1702</span>
<span>1703</span>
<span>1704</span>
<span>1705</span>
<span>1706</span>
<span>1707</span>
<span>1708</span>
<span>1709</span>
<span>1710</span>
<span>1711</span>
<span>1712</span>
<span>1713</span>
<span>1714</span>
<span>1715</span>
<span>1716</span>
<span>1717</span>
<span>1718</span>
<span>1719</span>
<span>1720</span>
<span>1721</span>
<span>1722</span>
<span>1723</span>
<span>1724</span>
<span>1725</span>
<span>1726</span>
<span>1727</span>
<span>1728</span>
<span>1729</span>
<span>1730</span>
<span>1731</span>
<span>1732</span>
<span>1733</span>
<span>1734</span>
<span>1735</span>
<span>1736</span>
<span>1737</span>
<span>1738</span>
<span>1739</span>
<span>1740</span>
<span>1741</span>
<span>1742</span>
<span>1743</span>
<span>1744</span>
<span>1745</span>
<span>1746</span>
<span>1747</span>
<span>1748</span>
<span>1749</span>
<span>1750</span>
<span>1751</span>
<span>1752</span>
<span>1753</span>
<span>1754</span>
<span>1755</span>
<span>1756</span>
<span>1757</span>
<span>1758</span>
<span>1759</span>
<span>1760</span>
<span>1761</span>
<span>1762</span>
<span>1763</span>
<span>1764</span>
<span>1765</span>
<span>1766</span>
<span>1767</span>
<span>1768</span>
<span>1769</span>
<span>1770</span>
<span>1771</span>
<span>1772</span>
<span>1773</span>
<span>1774</span>
<span>1775</span>
<span>1776</span>
<span>1777</span>
<span>1778</span>
<span>1779</span>
<span>1780</span>
<span>1781</span>
<span>1782</span>
<span>1783</span>
<span>1784</span>
<span>1785</span>
<span>1786</span>
<span>1787</span>
<span>1788</span>
<span>1789</span>
<span>1790</span>
<span>1791</span>
<span>1792</span>
<span>1793</span>
<span>1794</span>
<span>1795</span>
<span>1796</span>
<span>1797</span>
<span>1798</span>
<span>1799</span>
<span>1800</span>
<span>1801</span>
<span>1802</span>
<span>1803</span>
<span>1804</span>
<span>1805</span>
<span>1806</span>
<span>1807</span>
<span>1808</span>
<span>1809</span>
<span>1810</span>
<span>1811</span>
<span>1812</span>
<span>1813</span>
<span>1814</span>
<span>1815</span>
<span>1816</span>
<span>1817</span>
<span>1818</span>
<span>1819</span>
<span>1820</span>
<span>1821</span>
<span>1822</span>
<span>1823</span>
<span>1824</span>
<span>1825</span>
<span>1826</span>
<span>1827</span>
<span>1828</span>
<span>1829</span>
<span>1830</span>
<span>1831</span>
<span>1832</span>
<span>1833</span>
<span>1834</span>
<span>1835</span>
<span>1836</span>
<span>1837</span>
<span>1838</span>
<span>1839</span>
<span>1840</span>
<span>1841</span>
<span>1842</span>
<span>1843</span>
<span>1844</span>
<span>1845</span>
<span>1846</span>
<span>1847</span>
<span>1848</span>
<span>1849</span>
<span>1850</span>
<span>1851</span>
<span>1852</span>
<span>1853</span>
<span>1854</span>
<span>1855</span>
<span>1856</span>
<span>1857</span>
<span>1858</span>
<span>1859</span>
<span>1860</span>
<span>1861</span>
<span>1862</span>
<span>1863</span>
<span>1864</span>
<span>1865</span>
<span>1866</span>
<span>1867</span>
<span>1868</span>
<span>1869</span>
<span>1870</span>
<span>1871</span>
<span>1872</span>
<span>1873</span>
<span>1874</span>
<span>1875</span>
<span>1876</span>
<span>1877</span>
<span>1878</span>
<span>1879</span>
<span>1880</span>
<span>1881</span>
<span>1882</span>
<span>1883</span>
<span>1884</span>
<span>1885</span>
<span>1886</span>
<span>1887</span>
<span>1888</span>
<span>1889</span>
<span>1890</span>
<span>1891</span>
<span>1892</span>
<span>1893</span>
<span>1894</span>
<span>1895</span>
<span>1896</span>
<span>1897</span>
<span>1898</span>
<span>1899</span>
<span>1900</span>
<span>1901</span>
<span>1902</span>
<span>1903</span>
<span>1904</span>
<span>1905</span>
<span>1906</span>
<span>1907</span>
<span>1908</span>
<span>1909</span>
<span>1910</span>
<span>1911</span>
<span>1912</span>
<span>1913</span>
<span>1914</span>
<span>1915</span>
<span>1916</span>
<span>1917</span>
<span>1918</span>
<span>1919</span>
<span>1920</span>
<span>1921</span>
<span>1922</span>
<span>1923</span>
<span>1924</span>
<span>1925</span>
<span>1926</span>
<span>1927</span>
<span>1928</span>
<span>1929</span>
<span>1930</span>
<span>1931</span>
<span>1932</span>
<span>1933</span>
<span>1934</span>
<span>1935</span>
<span>1936</span>
<span>1937</span>
<span>1938</span>
<span>1939</span>
<span>1940</span>
<span>1941</span>
<span>1942</span>
<span>1943</span>
<span>1944</span>
<span>1945</span>
<span>1946</span>
<span>1947</span>
<span>1948</span>
<span>1949</span>
<span>1950</span>
<span>1951</span>
<span>1952</span>
<span>1953</span>
<span>1954</span>
<span>1955</span>
<span>1956</span>
<span>1957</span>
<span>1958</span>
<span>1959</span>
<span>1960</span>
<span>1961</span>
<span>1962</span>
<span>1963</span>
<span>1964</span>
<span>1965</span>
<span>1966</span>
<span>1967</span>
<span>1968</span>
<span>1969</span>
<span>1970</span>
<span>1971</span>
<span>1972</span>
<span>1973</span>
<span>1974</span>
<span>1975</span>
<span>1976</span>

  </pre>
  </td>

  <td  style="margin:0px; padding-left:8px; vertical-align:top" width="100%">
  <pre><div class="line" id="l1">#if !OMIT_XML
</div><div class="line" id="l2">namespace NachoDB.Impl
</div><div class="line" id="l3">{
</div><div class="line" id="l4">    using System;
</div><div class="line" id="l5">    using System.Collections;
</div><div class="line" id="l6">    using System.Reflection;
</div><div class="line" id="l7">    using NachoDB;
</div><div class="line" id="l8"><br></div><div class="line" id="l9">    public class XMLImporter
</div><div class="line" id="l10">    {
</div><div class="line" id="l11">        <span class="c">public XMLImporter(StorageImpl storage, System.IO.StreamReader reader)</span></div><div class="line" id="l12">        {
</div><div class="line" id="l13">            <span class="c">this.storage = storage;</span></div><div class="line" id="l14">            <span class="c">scanner = new XMLScanner(reader);</span></div><div class="line" id="l15">            <span class="c">classMap = new Hashtable();</span></div><div class="line" id="l16">        <span class="c">}</span></div><div class="line" id="l17"><br></div><div class="line" id="l18">        public virtual void importDatabase()
</div><div class="line" id="l19">        {
</div><div class="line" id="l20">            <span class="c">if (scanner.scan() != XMLScanner.Token.LT || scanner.scan() != XMLScanner.Token.IDENT || !scanner.Identifier.Equals("database"))</span></div><div class="line" id="l21">            {
</div><div class="line" id="l22">                <span class="c">throwException("No root element");</span></div><div class="line" id="l23">            }
</div><div class="line" id="l24">            <span class="c">if (scanner.scan() != XMLScanner.Token.IDENT || !scanner.Identifier.Equals("root") || scanner.scan() != XMLScanner.Token.EQ || scanner.scan() != XMLScanner.Token.SCONST || scanner.scan() != XMLScanner.Token.GT)</span></div><div class="line" id="l25">            {
</div><div class="line" id="l26">                <span class="c">throwException("Database element should have \"root\" attribute");</span></div><div class="line" id="l27">            }
</div><div class="line" id="l28">            <span class="c">int rootId = 0;</span></div><div class="line" id="l29">            try
</div><div class="line" id="l30">            {
</div><div class="line" id="l31">                <span class="c">rootId = System.Int32.Parse(scanner.String);</span></div><div class="line" id="l32">            }
</div><div class="line" id="l33">            <span class="c">catch (System.FormatException)</span></div><div class="line" id="l34">            {
</div><div class="line" id="l35">                <span class="c">throwException("Incorrect root object specification");</span></div><div class="line" id="l36">            }
</div><div class="line" id="l37">            <span class="c">idMap = new int[rootId * 2];</span></div><div class="line" id="l38">            <span class="c">idMap[rootId] = storage.allocateId();</span></div><div class="line" id="l39">            <span class="c">storage.header.root[1 - storage.currIndex].rootObject = idMap[rootId];</span></div><div class="line" id="l40"><br></div><div class="line" id="l41">            XMLScanner.Token tkn;
</div><div class="line" id="l42">            <span class="c">while ((tkn = scanner.scan()) == XMLScanner.Token.LT)</span></div><div class="line" id="l43">            {
</div><div class="line" id="l44">                <span class="c">if (scanner.scan() != XMLScanner.Token.IDENT)</span></div><div class="line" id="l45">                {
</div><div class="line" id="l46">                    <span class="c">throwException("Element name expected");</span></div><div class="line" id="l47">                }
</div><div class="line" id="l48">                <span class="c">System.String elemName = scanner.Identifier;</span></div><div class="line" id="l49">                <span class="c">if (elemName.StartsWith("NachoDB.Impl.Btree")</span></div><div class="line" id="l50"><span class="c">                    || elemName.StartsWith("NachoDB.Impl.BitIndexImpl")</span></div><div class="line" id="l51"><span class="c">                    || elemName.StartsWith("NachoDB.Impl.PersistentSet")</span></div><div class="line" id="l52"><span class="c">                    || elemName.StartsWith("NachoDB.Impl.BtreeFieldIndex")</span></div><div class="line" id="l53">                    || elemName.StartsWith("NachoDB.Impl.BtreeMultiFieldIndex")<span class="c">)</span></div><div class="line" id="l54">                {
</div><div class="line" id="l55">                    <span class="c">createIndex(elemName);</span></div><div class="line" id="l56">                }
</div><div class="line" id="l57">                else
</div><div class="line" id="l58">                {
</div><div class="line" id="l59">                    <span class="c">createObject(readElement(elemName));</span></div><div class="line" id="l60">                }
</div><div class="line" id="l61">            }
</div><div class="line" id="l62">            <span class="c">if (tkn != XMLScanner.Token.LTS || scanner.scan() != XMLScanner.Token.IDENT || !scanner.Identifier.Equals("database") || scanner.scan() != XMLScanner.Token.GT)</span></div><div class="line" id="l63">            {
</div><div class="line" id="l64">                <span class="c">throwException("Root element is not closed");</span></div><div class="line" id="l65">            }
</div><div class="line" id="l66">        <span class="c">}</span></div><div class="line" id="l67"><br></div><div class="line" id="l68">        internal class XMLElement
</div><div class="line" id="l69">        {
</div><div class="line" id="l70">            internal XMLElement NextSibling
</div><div class="line" id="l71">            {
</div><div class="line" id="l72">                get
</div><div class="line" id="l73">                {
</div><div class="line" id="l74">                    <span class="c">return next;</span></div><div class="line" id="l75">                }
</div><div class="line" id="l76">            }
</div><div class="line" id="l77"><br></div><div class="line" id="l78">            internal int Counter
</div><div class="line" id="l79">            {
</div><div class="line" id="l80">                get
</div><div class="line" id="l81">                {
</div><div class="line" id="l82">                    <span class="c">return counter;</span></div><div class="line" id="l83">                }
</div><div class="line" id="l84">            }
</div><div class="line" id="l85"><br></div><div class="line" id="l86">            internal long IntValue
</div><div class="line" id="l87">            {
</div><div class="line" id="l88">                get
</div><div class="line" id="l89">                {
</div><div class="line" id="l90">                    <span class="c">return ivalue;</span></div><div class="line" id="l91">                }
</div><div class="line" id="l92"><br></div><div class="line" id="l93">                set
</div><div class="line" id="l94">                {
</div><div class="line" id="l95">                    <span class="c">ivalue = value;</span></div><div class="line" id="l96">                    <span class="c">valueType = XMLValueType.INT_VALUE;</span></div><div class="line" id="l97">                <span class="c">}</span></div><div class="line" id="l98">            }
</div><div class="line" id="l99"><br></div><div class="line" id="l100">            internal double RealValue
</div><div class="line" id="l101">            {
</div><div class="line" id="l102">                get
</div><div class="line" id="l103">                {
</div><div class="line" id="l104">                    return rvalue;
</div><div class="line" id="l105">                }
</div><div class="line" id="l106"><br></div><div class="line" id="l107">                set
</div><div class="line" id="l108">                {
</div><div class="line" id="l109">                    rvalue = value;
</div><div class="line" id="l110">                    valueType = XMLValueType.REAL_VALUE;
</div><div class="line" id="l111">                }
</div><div class="line" id="l112">            }
</div><div class="line" id="l113"><br></div><div class="line" id="l114">            internal String StringValue
</div><div class="line" id="l115">            {
</div><div class="line" id="l116">                get
</div><div class="line" id="l117">                {
</div><div class="line" id="l118">                    <span class="c">return svalue;</span></div><div class="line" id="l119">                }
</div><div class="line" id="l120"><br></div><div class="line" id="l121">                set
</div><div class="line" id="l122">                {
</div><div class="line" id="l123">                    <span class="c">svalue = value;</span></div><div class="line" id="l124">                    <span class="c">valueType = XMLValueType.STRING_VALUE;</span></div><div class="line" id="l125">                <span class="c">}</span></div><div class="line" id="l126"><br></div><div class="line" id="l127">            }
</div><div class="line" id="l128"><br></div><div class="line" id="l129">            internal String Name
</div><div class="line" id="l130">            {
</div><div class="line" id="l131">                get
</div><div class="line" id="l132">                {
</div><div class="line" id="l133">                    <span class="c">return name;</span></div><div class="line" id="l134"><br></div><div class="line" id="l135">                }
</div><div class="line" id="l136">            }
</div><div class="line" id="l137"><br></div><div class="line" id="l138">            private XMLElement   next;
</div><div class="line" id="l139">            private XMLElement   prev;
</div><div class="line" id="l140">            private String       name;
</div><div class="line" id="l141">            private Hashtable    siblings;
</div><div class="line" id="l142">            private Hashtable    attributes;
</div><div class="line" id="l143">            private String       svalue;
</div><div class="line" id="l144">            private long         ivalue;
</div><div class="line" id="l145">            private double       rvalue;
</div><div class="line" id="l146">            private XMLValueType valueType;
</div><div class="line" id="l147">            private int          counter;
</div><div class="line" id="l148"><br></div><div class="line" id="l149">            enum XMLValueType 
</div><div class="line" id="l150">            { 
</div><div class="line" id="l151">                NO_VALUE,
</div><div class="line" id="l152">                STRING_VALUE,
</div><div class="line" id="l153">                INT_VALUE,
</div><div class="line" id="l154">                REAL_VALUE,
</div><div class="line" id="l155">                NULL_VALUE
</div><div class="line" id="l156">            }
</div><div class="line" id="l157"><br></div><div class="line" id="l158">            <span class="c">internal XMLElement(System.String name)</span></div><div class="line" id="l159">            {
</div><div class="line" id="l160">                <span class="c">this.name = name;</span></div><div class="line" id="l161">                <span class="c">valueType = XMLValueType.NO_VALUE;</span></div><div class="line" id="l162">            <span class="c">}</span></div><div class="line" id="l163"><br></div><div class="line" id="l164">            internal void  addSibling(XMLElement elem)
</div><div class="line" id="l165">            {
</div><div class="line" id="l166">                <span class="c">if (siblings == null)</span></div><div class="line" id="l167">                {
</div><div class="line" id="l168">                    <span class="c">siblings = new Hashtable();</span></div><div class="line" id="l169">                }
</div><div class="line" id="l170">                <span class="c">XMLElement head = (XMLElement) siblings[elem.name];</span></div><div class="line" id="l171">                <span class="c">if (head != null)</span></div><div class="line" id="l172">                {
</div><div class="line" id="l173">                    <span class="c">elem.next = null;</span></div><div class="line" id="l174">                    <span class="c">elem.prev = head.prev;</span></div><div class="line" id="l175">                    <span class="c">head.prev.next = elem;</span></div><div class="line" id="l176">                    <span class="c">head.prev = elem;</span></div><div class="line" id="l177">                    <span class="c">head.counter += 1;</span></div><div class="line" id="l178">                }
</div><div class="line" id="l179">                else
</div><div class="line" id="l180">                {
</div><div class="line" id="l181">                    <span class="c">elem.prev = elem;</span></div><div class="line" id="l182">                    <span class="c">siblings[elem.name] = elem;</span></div><div class="line" id="l183">                    <span class="c">elem.counter = 1;</span></div><div class="line" id="l184">                }
</div><div class="line" id="l185">            <span class="c">}</span></div><div class="line" id="l186"><br></div><div class="line" id="l187">            internal void  addAttribute(System.String name, System.String val)
</div><div class="line" id="l188">            {
</div><div class="line" id="l189">                <span class="c">if (attributes == null)</span></div><div class="line" id="l190">                {
</div><div class="line" id="l191">                    <span class="c">attributes = new Hashtable();</span></div><div class="line" id="l192">                }
</div><div class="line" id="l193">                <span class="c">attributes[name] = val;</span></div><div class="line" id="l194">            <span class="c">}</span></div><div class="line" id="l195"><br></div><div class="line" id="l196">            internal XMLElement getSibling(System.String name)
</div><div class="line" id="l197">            {
</div><div class="line" id="l198">                <span class="c">if (siblings != null)</span></div><div class="line" id="l199">                {
</div><div class="line" id="l200">                    <span class="c">return (XMLElement)siblings[name];</span></div><div class="line" id="l201">                }
</div><div class="line" id="l202">                <span class="c">return null;</span></div><div class="line" id="l203">            }
</div><div class="line" id="l204"><br></div><div class="line" id="l205">            internal System.String getAttribute(System.String name)
</div><div class="line" id="l206">            {
</div><div class="line" id="l207">                <span class="c">return attributes != null?(System.String) attributes[name]:null;</span></div><div class="line" id="l208">            }
</div><div class="line" id="l209"><br></div><div class="line" id="l210">            internal void  setNullValue()
</div><div class="line" id="l211">            {
</div><div class="line" id="l212">                valueType = XMLValueType.NULL_VALUE;
</div><div class="line" id="l213">            }
</div><div class="line" id="l214"><br></div><div class="line" id="l215">            internal bool isIntValue()
</div><div class="line" id="l216">            {
</div><div class="line" id="l217">                <span class="c">return valueType == XMLValueType.INT_VALUE;</span></div><div class="line" id="l218">            }
</div><div class="line" id="l219"><br></div><div class="line" id="l220">            internal bool isRealValue()
</div><div class="line" id="l221">            {
</div><div class="line" id="l222">                <span class="c">return valueType == XMLValueType.REAL_VALUE;</span></div><div class="line" id="l223">            }
</div><div class="line" id="l224"><br></div><div class="line" id="l225">            internal bool isStringValue()
</div><div class="line" id="l226">            {
</div><div class="line" id="l227">                <span class="c">return valueType == XMLValueType.STRING_VALUE;</span></div><div class="line" id="l228">            }
</div><div class="line" id="l229"><br></div><div class="line" id="l230">            internal bool isNullValue()
</div><div class="line" id="l231">            {
</div><div class="line" id="l232">                <span class="c">return valueType == XMLValueType.NULL_VALUE;</span></div><div class="line" id="l233">            }
</div><div class="line" id="l234">        }
</div><div class="line" id="l235"><br></div><div class="line" id="l236">        internal System.String getAttribute(XMLElement elem, String name)
</div><div class="line" id="l237">        {
</div><div class="line" id="l238">            <span class="c">System.String val = elem.getAttribute(name);</span></div><div class="line" id="l239">            <span class="c">if (val == null)</span></div><div class="line" id="l240">            {
</div><div class="line" id="l241">                <span class="c">throwException("Attribute " + name + " is not set");</span></div><div class="line" id="l242">            }
</div><div class="line" id="l243">            <span class="c">return val;</span></div><div class="line" id="l244">        }
</div><div class="line" id="l245"><br></div><div class="line" id="l246">        internal int getIntAttribute(XMLElement elem, String name)
</div><div class="line" id="l247">        {
</div><div class="line" id="l248">            <span class="c">System.String val = elem.getAttribute(name);</span></div><div class="line" id="l249">            <span class="c">if (val == null)</span></div><div class="line" id="l250">            {
</div><div class="line" id="l251">                <span class="c">throwException("Attribute " + name + " is not set");</span></div><div class="line" id="l252">            }
</div><div class="line" id="l253">            try
</div><div class="line" id="l254">            {
</div><div class="line" id="l255">                <span class="c">return System.Int32.Parse(val);</span></div><div class="line" id="l256">            }
</div><div class="line" id="l257">            <span class="c">catch (System.FormatException)</span></div><div class="line" id="l258">            {
</div><div class="line" id="l259">                <span class="c">throwException("Attribute " + name + " should has integer value");</span></div><div class="line" id="l260">            }
</div><div class="line" id="l261">            <span class="c">return - 1;</span></div><div class="line" id="l262">        <span class="c">}</span></div><div class="line" id="l263"><br></div><div class="line" id="l264">        internal int mapId(int id)
</div><div class="line" id="l265">        {
</div><div class="line" id="l266">            <span class="c">int oid = 0;</span></div><div class="line" id="l267">            <span class="c">if (id != 0)</span></div><div class="line" id="l268">            {
</div><div class="line" id="l269">                <span class="c">if (id &gt;= idMap.Length)</span></div><div class="line" id="l270">                {
</div><div class="line" id="l271">                    <span class="c">int[] newMap = new int[id * 2];</span></div><div class="line" id="l272">                    <span class="c">Array.Copy(idMap, 0, newMap, 0, idMap.Length);</span></div><div class="line" id="l273">                    <span class="c">idMap = newMap;</span></div><div class="line" id="l274">                    <span class="c">idMap[id] = oid = storage.allocateId();</span></div><div class="line" id="l275">                }
</div><div class="line" id="l276">                else
</div><div class="line" id="l277">                {
</div><div class="line" id="l278">                    <span class="c">oid = idMap[id];</span></div><div class="line" id="l279">                    <span class="c">if (oid == 0)</span></div><div class="line" id="l280">                    {
</div><div class="line" id="l281">                        <span class="c">idMap[id] = oid = storage.allocateId();</span></div><div class="line" id="l282">                    }
</div><div class="line" id="l283">                }
</div><div class="line" id="l284">            }
</div><div class="line" id="l285">            <span class="c">return oid;</span></div><div class="line" id="l286">        }
</div><div class="line" id="l287"><br></div><div class="line" id="l288">        internal ClassDescriptor.FieldType mapType(System.String signature)
</div><div class="line" id="l289">        {
</div><div class="line" id="l290">            try 
</div><div class="line" id="l291">            { 
</div><div class="line" id="l292">#if COMPACT_NET_FRAMEWORK
</div><div class="line" id="l293">                return (ClassDescriptor.FieldType)ClassDescriptor.parseEnum(typeof(ClassDescriptor.FieldType), signature);
</div><div class="line" id="l294">#else
</div><div class="line" id="l295">                <span class="c">return (ClassDescriptor.FieldType)Enum.Parse(typeof(ClassDescriptor.FieldType), signature);</span></div><div class="line" id="l296">#endif
</div><div class="line" id="l297">            } 
</div><div class="line" id="l298">            <span class="c">catch (ArgumentException)</span></div><div class="line" id="l299">            {
</div><div class="line" id="l300">                <span class="c">throwException("Bad type");</span></div><div class="line" id="l301">                <span class="c">return ClassDescriptor.FieldType.tpObject;</span></div><div class="line" id="l302">            }
</div><div class="line" id="l303">        <span class="c">}</span></div><div class="line" id="l304"><br></div><div class="line" id="l305">        Key createCompoundKey(ClassDescriptor.FieldType[] types, String[] values) 
</div><div class="line" id="l306">        {
</div><div class="line" id="l307">            ByteBuffer buf = new ByteBuffer(null);
</div><div class="line" id="l308">            int dst = 0;
</div><div class="line" id="l309"><br></div><div class="line" id="l310">            for (int i = 0; i &lt; types.Length; i++) 
</div><div class="line" id="l311">            { 
</div><div class="line" id="l312">                String val = values[i];
</div><div class="line" id="l313">                switch (types[i]) 
</div><div class="line" id="l314">                { 
</div><div class="line" id="l315">                    case ClassDescriptor.FieldType.tpBoolean:
</div><div class="line" id="l316">                        dst = buf.packBool(dst, Int32.Parse(val) != 0);
</div><div class="line" id="l317">                        break;
</div><div class="line" id="l318"><br></div><div class="line" id="l319">                    case ClassDescriptor.FieldType.tpByte:
</div><div class="line" id="l320">                    case ClassDescriptor.FieldType.tpSByte:
</div><div class="line" id="l321">                        dst = buf.packI1(dst, Int32.Parse(val));
</div><div class="line" id="l322">                        break;
</div><div class="line" id="l323"><br></div><div class="line" id="l324">                    case ClassDescriptor.FieldType.tpChar:
</div><div class="line" id="l325">                    case ClassDescriptor.FieldType.tpShort:
</div><div class="line" id="l326">                    case ClassDescriptor.FieldType.tpUShort:
</div><div class="line" id="l327">                        dst = buf.packI2(dst, Int32.Parse(val));
</div><div class="line" id="l328">                        break;
</div><div class="line" id="l329"><br></div><div class="line" id="l330">                    case ClassDescriptor.FieldType.tpInt:
</div><div class="line" id="l331">                        dst = buf.packI4(dst, Int32.Parse(val));
</div><div class="line" id="l332">                        break;
</div><div class="line" id="l333"><br></div><div class="line" id="l334">                    case ClassDescriptor.FieldType.tpEnum:
</div><div class="line" id="l335">                    case ClassDescriptor.FieldType.tpUInt:
</div><div class="line" id="l336">                        dst = buf.packI4(dst, (int)UInt32.Parse(val));
</div><div class="line" id="l337">                        break;
</div><div class="line" id="l338"><br></div><div class="line" id="l339">                    case ClassDescriptor.FieldType.tpObject:
</div><div class="line" id="l340">                    case ClassDescriptor.FieldType.tpOid:
</div><div class="line" id="l341">                        dst = buf.packI4(dst, mapId((int)UInt32.Parse(val)));
</div><div class="line" id="l342">                        break;
</div><div class="line" id="l343"><br></div><div class="line" id="l344">                    case ClassDescriptor.FieldType.tpLong:
</div><div class="line" id="l345">                        dst = buf.packI8(dst, Int64.Parse(val));
</div><div class="line" id="l346">                        break;
</div><div class="line" id="l347"><br></div><div class="line" id="l348">                    case ClassDescriptor.FieldType.tpULong:
</div><div class="line" id="l349">                        dst = buf.packI8(dst, (long)UInt64.Parse(val));
</div><div class="line" id="l350">                        break;
</div><div class="line" id="l351"><br></div><div class="line" id="l352">                    case ClassDescriptor.FieldType.tpDate:
</div><div class="line" id="l353">                        dst = buf.packDate(dst, DateTime.Parse(val));
</div><div class="line" id="l354">                        break;
</div><div class="line" id="l355"><br></div><div class="line" id="l356">                    case ClassDescriptor.FieldType.tpFloat:
</div><div class="line" id="l357">                        dst = buf.packF4(dst, Single.Parse(val));
</div><div class="line" id="l358">                        break;
</div><div class="line" id="l359"><br></div><div class="line" id="l360">                    case ClassDescriptor.FieldType.tpDouble:
</div><div class="line" id="l361">                        dst = buf.packF8(dst, Double.Parse(val));
</div><div class="line" id="l362">                        break;
</div><div class="line" id="l363"><br></div><div class="line" id="l364">                    case ClassDescriptor.FieldType.tpDecimal: 
</div><div class="line" id="l365">                        dst = buf.packDecimal(dst, Decimal.Parse(val));
</div><div class="line" id="l366">                        break;
</div><div class="line" id="l367"><br></div><div class="line" id="l368">                    case ClassDescriptor.FieldType.tpGuid: 
</div><div class="line" id="l369">                        dst = buf.packGuid(dst, new Guid(val));
</div><div class="line" id="l370">                        break;
</div><div class="line" id="l371"><br></div><div class="line" id="l372">                    case ClassDescriptor.FieldType.tpString:
</div><div class="line" id="l373">                        dst = buf.packString(dst, val);
</div><div class="line" id="l374">                        break;
</div><div class="line" id="l375"><br></div><div class="line" id="l376">                    case ClassDescriptor.FieldType.tpArrayOfByte:
</div><div class="line" id="l377">                        buf.extend(dst + 4 + (val.Length &gt;&gt; 1));
</div><div class="line" id="l378">                        Bytes.pack4(buf.arr, dst, val.Length &gt;&gt; 1);
</div><div class="line" id="l379">                        dst += 4;
</div><div class="line" id="l380">                        for (int j = 0, n = val.Length; j &lt; n; j+=2) 
</div><div class="line" id="l381">                        { 
</div><div class="line" id="l382">                            buf.arr[dst++] = (byte)((getHexValue(val[j]) &lt;&lt; 4) | getHexValue(val[j+1]));
</div><div class="line" id="l383">                        }
</div><div class="line" id="l384">                        break;
</div><div class="line" id="l385">                    default:
</div><div class="line" id="l386">                        throwException("Bad key type");
</div><div class="line" id="l387">                        break;
</div><div class="line" id="l388">                }
</div><div class="line" id="l389">            }
</div><div class="line" id="l390">            return new Key(buf.toArray());
</div><div class="line" id="l391">        }
</div><div class="line" id="l392"><br></div><div class="line" id="l393">        Key createKey(ClassDescriptor.FieldType type, String val)
</div><div class="line" id="l394">        {
</div><div class="line" id="l395">            <span class="c">switch (type)</span></div><div class="line" id="l396">            {
</div><div class="line" id="l397">                case ClassDescriptor.FieldType.tpBoolean: 
</div><div class="line" id="l398">                    <span class="c">return new Key(Int32.Parse(val) != 0);</span></div><div class="line" id="l399"><br></div><div class="line" id="l400">                case ClassDescriptor.FieldType.tpByte: 
</div><div class="line" id="l401">                    <span class="c">return new Key(Byte.Parse(val));</span></div><div class="line" id="l402"><br></div><div class="line" id="l403">                case ClassDescriptor.FieldType.tpSByte: 
</div><div class="line" id="l404">                    <span class="c">return new Key(SByte.Parse(val));</span></div><div class="line" id="l405"><br></div><div class="line" id="l406">                case ClassDescriptor.FieldType.tpChar: 
</div><div class="line" id="l407">                    <span class="c">return new Key((char)Int32.Parse(val));</span></div><div class="line" id="l408"><br></div><div class="line" id="l409">                case ClassDescriptor.FieldType.tpShort: 
</div><div class="line" id="l410">                    <span class="c">return new Key(Int16.Parse(val));</span></div><div class="line" id="l411"><br></div><div class="line" id="l412">                case ClassDescriptor.FieldType.tpUShort: 
</div><div class="line" id="l413">                    <span class="c">return new Key(UInt16.Parse(val));</span></div><div class="line" id="l414"><br></div><div class="line" id="l415">                case ClassDescriptor.FieldType.tpInt: 
</div><div class="line" id="l416">                    <span class="c">return new Key(Int32.Parse(val));</span></div><div class="line" id="l417"><br></div><div class="line" id="l418">                case ClassDescriptor.FieldType.tpUInt: 
</div><div class="line" id="l419">                case ClassDescriptor.FieldType.tpEnum:
</div><div class="line" id="l420">                    <span class="c">return new Key(UInt32.Parse(val));</span></div><div class="line" id="l421"><br></div><div class="line" id="l422">                case ClassDescriptor.FieldType.tpOid: 
</div><div class="line" id="l423">                    <span class="c">return new Key(ClassDescriptor.FieldType.tpOid, mapId((int)UInt32.Parse(val)));</span></div><div class="line" id="l424">                case ClassDescriptor.FieldType.tpObject: 
</div><div class="line" id="l425">                    <span class="c">return new Key(new PersistentStub(storage, mapId((int)UInt32.Parse(val))));</span></div><div class="line" id="l426"><br></div><div class="line" id="l427">                case ClassDescriptor.FieldType.tpLong: 
</div><div class="line" id="l428">                    <span class="c">return new Key(Int64.Parse(val));</span></div><div class="line" id="l429"><br></div><div class="line" id="l430">                case ClassDescriptor.FieldType.tpULong: 
</div><div class="line" id="l431">                    <span class="c">return new Key(UInt64.Parse(val));</span></div><div class="line" id="l432"><br></div><div class="line" id="l433">                case ClassDescriptor.FieldType.tpFloat: 
</div><div class="line" id="l434">                    <span class="c">return new Key(Single.Parse(val));</span></div><div class="line" id="l435"><br></div><div class="line" id="l436">                case ClassDescriptor.FieldType.tpDouble: 
</div><div class="line" id="l437">                    <span class="c">return new Key(Double.Parse(val));</span></div><div class="line" id="l438"><br></div><div class="line" id="l439">                case ClassDescriptor.FieldType.tpDecimal: 
</div><div class="line" id="l440">                    <span class="c">return new Key(Decimal.Parse(val));</span></div><div class="line" id="l441"><br></div><div class="line" id="l442">                case ClassDescriptor.FieldType.tpGuid: 
</div><div class="line" id="l443">                    <span class="c">return new Key(new Guid(val));</span></div><div class="line" id="l444"><br></div><div class="line" id="l445">                case ClassDescriptor.FieldType.tpString: 
</div><div class="line" id="l446">                    <span class="c">return new Key(val);</span></div><div class="line" id="l447"><br></div><div class="line" id="l448">                case ClassDescriptor.FieldType.tpArrayOfByte:
</div><div class="line" id="l449">                {
</div><div class="line" id="l450">                    <span class="c">byte[] buf = new byte[val.Length &gt;&gt; 1];</span></div><div class="line" id="l451">                    for (<span class="c">int i = 0;</span> <span class="c">i &lt; buf.Length</span>; <span class="c">i++</span>)</div><div class="line" id="l452">                    { 
</div><div class="line" id="l453">                        <span class="c">buf[i] = (byte)((getHexValue(val[i*2]) &lt;&lt; 4) | getHexValue(val[i*2+1]));</span></div><div class="line" id="l454">                    }
</div><div class="line" id="l455">                    <span class="c">return new Key(buf);</span></div><div class="line" id="l456">                }
</div><div class="line" id="l457"><br></div><div class="line" id="l458">                case ClassDescriptor.FieldType.tpDate: 
</div><div class="line" id="l459">                    <span class="c">return new Key(DateTime.Parse(val));</span></div><div class="line" id="l460"><br></div><div class="line" id="l461">                default: 
</div><div class="line" id="l462">                    <span class="c">throwException("Bad key type");</span></div><div class="line" id="l463">                    break;
</div><div class="line" id="l464"><br></div><div class="line" id="l465">            }
</div><div class="line" id="l466">            <span class="c">return null;</span></div><div class="line" id="l467">        }
</div><div class="line" id="l468"><br></div><div class="line" id="l469">        internal int parseInt(String str)
</div><div class="line" id="l470">        {
</div><div class="line" id="l471">            <span class="c">return Int32.Parse(str);</span></div><div class="line" id="l472">        }
</div><div class="line" id="l473"><br></div><div class="line" id="l474">        internal Type findClassByName(String className) 
</div><div class="line" id="l475">        {
</div><div class="line" id="l476">            <span class="c">Type type = (Type)classMap[className];</span></div><div class="line" id="l477">            <span class="c">if (type == null)</span></div><div class="line" id="l478">            {
</div><div class="line" id="l479">                <span class="c">type = ClassDescriptor.lookup(storage, className);</span></div><div class="line" id="l480">                <span class="c">classMap[className] = type;</span></div><div class="line" id="l481">            }
</div><div class="line" id="l482">            <span class="c">return type;</span></div><div class="line" id="l483">        }
</div><div class="line" id="l484"><br></div><div class="line" id="l485">        internal void  createIndex(String indexType)
</div><div class="line" id="l486">        {
</div><div class="line" id="l487">            XMLScanner.Token tkn;
</div><div class="line" id="l488">            <span class="c">int oid = 0;</span></div><div class="line" id="l489">            <span class="c">bool     unique = false;</span></div><div class="line" id="l490">            <span class="c">String   className = null;</span></div><div class="line" id="l491">            <span class="c">String   fieldName = null;</span></div><div class="line" id="l492">            <span class="c">String[] fieldNames = null;</span></div><div class="line" id="l493">            <span class="c">long     autoinc = 0;</span></div><div class="line" id="l494">            <span class="c">String   type = null;</span></div><div class="line" id="l495">            <span class="c">while ((tkn = scanner.scan()) == XMLScanner.Token.IDENT)</span></div><div class="line" id="l496">            {
</div><div class="line" id="l497">                <span class="c">System.String attrName = scanner.Identifier;</span></div><div class="line" id="l498">                <span class="c">if (scanner.scan() != XMLScanner.Token.EQ || scanner.scan() != XMLScanner.Token.SCONST)</span></div><div class="line" id="l499">                {
</div><div class="line" id="l500">                    <span class="c">throwException("Attribute value expected");</span></div><div class="line" id="l501">                }
</div><div class="line" id="l502">                <span class="c">System.String attrValue = scanner.String;</span></div><div class="line" id="l503">                <span class="c">if (attrName.Equals("id"))</span></div><div class="line" id="l504">                {
</div><div class="line" id="l505">                    <span class="c">oid = mapId(parseInt(attrValue));</span></div><div class="line" id="l506">                }
</div><div class="line" id="l507">                else <span class="c">if (attrName.Equals("unique"))</span></div><div class="line" id="l508">                {
</div><div class="line" id="l509">                    <span class="c">unique = parseInt(attrValue) != 0;</span></div><div class="line" id="l510">                }
</div><div class="line" id="l511">                else <span class="c">if (attrName.Equals("class"))</span></div><div class="line" id="l512">                {
</div><div class="line" id="l513">                    <span class="c">className = attrValue;</span></div><div class="line" id="l514">                }
</div><div class="line" id="l515">                else <span class="c">if (attrName.Equals("type"))</span></div><div class="line" id="l516">                {
</div><div class="line" id="l517">                    <span class="c">type = attrValue;</span></div><div class="line" id="l518">                }
</div><div class="line" id="l519">                else <span class="c">if (attrName.Equals("autoinc"))</span></div><div class="line" id="l520">                {
</div><div class="line" id="l521">                    <span class="c">autoinc = parseInt(attrValue);</span></div><div class="line" id="l522">                }
</div><div class="line" id="l523">                else <span class="c">if (attrName.StartsWith("field"))</span></div><div class="line" id="l524">                {
</div><div class="line" id="l525">                    <span class="c">int len = attrName.Length;</span></div><div class="line" id="l526">                    <span class="c">if (len == 5)</span></div><div class="line" id="l527">                    {
</div><div class="line" id="l528">                        <span class="c">fieldName = attrValue;</span></div><div class="line" id="l529">                    } 
</div><div class="line" id="l530">                    else 
</div><div class="line" id="l531">                    { 
</div><div class="line" id="l532">                        <span class="c">int fieldNo = Int32.Parse(attrName.Substring(5));</span></div><div class="line" id="l533">                        <span class="c">if (fieldNames == null || fieldNames.Length &lt;= fieldNo)</span></div><div class="line" id="l534">                        { 
</div><div class="line" id="l535">                            <span class="c">String[] newFieldNames = new String[fieldNo+1];</span></div><div class="line" id="l536">                            <span class="c">if (fieldNames != null)</span></div><div class="line" id="l537">                            { 
</div><div class="line" id="l538">                                <span class="c">Array.Copy(fieldNames, 0, newFieldNames, 0, fieldNames.Length);</span></div><div class="line" id="l539">                            }
</div><div class="line" id="l540">                            <span class="c">fieldNames = newFieldNames;</span></div><div class="line" id="l541">                        }
</div><div class="line" id="l542">                        <span class="c">fieldNames[fieldNo] = attrValue;</span></div><div class="line" id="l543">                    }
</div><div class="line" id="l544">                }
</div><div class="line" id="l545">            }
</div><div class="line" id="l546">            <span class="c">if (tkn != XMLScanner.Token.GT)</span></div><div class="line" id="l547">            {
</div><div class="line" id="l548">                <span class="c">throwException("Unclosed element tag");</span></div><div class="line" id="l549">            }
</div><div class="line" id="l550">            <span class="c">if (oid == 0)</span></div><div class="line" id="l551">            {
</div><div class="line" id="l552">                <span class="c">throwException("ID is not specified or index");</span></div><div class="line" id="l553">            }
</div><div class="line" id="l554">            <span class="c">ClassDescriptor desc = storage.getClassDescriptor(findClassByName(indexType));</span></div><div class="line" id="l555">            <span class="c">Btree btree = (Btree)desc.newInstance();</span></div><div class="line" id="l556">            <span class="c">if (className != null)</span></div><div class="line" id="l557">            {
</div><div class="line" id="l558">                <span class="c">Type cls = findClassByName(className);</span></div><div class="line" id="l559">                <span class="c">if (fieldName != null)</span></div><div class="line" id="l560">                { 
</div><div class="line" id="l561">                    <span class="c">btree.init(cls, ClassDescriptor.FieldType.tpLast, new string[]{fieldName}, unique, autoinc);</span></div><div class="line" id="l562">                } 
</div><div class="line" id="l563">                else <span class="c">if (fieldNames != null)</span></div><div class="line" id="l564">                { 
</div><div class="line" id="l565">                    <span class="c">btree.init(cls, ClassDescriptor.FieldType.tpLast, fieldNames, unique, autoinc);</span></div><div class="line" id="l566">                } 
</div><div class="line" id="l567">                else
</div><div class="line" id="l568">                {
</div><div class="line" id="l569">                    <span class="c">throwException("Field name is not specified for field index");</span></div><div class="line" id="l570">                }
</div><div class="line" id="l571">            }
</div><div class="line" id="l572">            else
</div><div class="line" id="l573">            {
</div><div class="line" id="l574">                <span class="c">if (type == null)</span></div><div class="line" id="l575">                {
</div><div class="line" id="l576">                    <span class="c">if (indexType.StartsWith("NachoDB.Impl.PersistentSet"))</span></div><div class="line" id="l577">                    { 
</div><div class="line" id="l578">                    } 
</div><div class="line" id="l579">                    else 
</div><div class="line" id="l580">                    {
</div><div class="line" id="l581">                        <span class="c">throwException("Key type is not specified for index");</span></div><div class="line" id="l582">                    }
</div><div class="line" id="l583">                } 
</div><div class="line" id="l584">                else 
</div><div class="line" id="l585">                {
</div><div class="line" id="l586">                    <span class="c">if (indexType.StartsWith("NachoDB.impl.BitIndexImpl"))</span></div><div class="line" id="l587">                    { 
</div><div class="line" id="l588">                    } 
</div><div class="line" id="l589">                    else 
</div><div class="line" id="l590">                    { 
</div><div class="line" id="l591">                        <span class="c">btree.init(null, mapType(type), null, unique, autoinc);</span></div><div class="line" id="l592">                    }
</div><div class="line" id="l593">                }
</div><div class="line" id="l594">            }
</div><div class="line" id="l595">            <span class="c">storage.assignOid(btree, oid);</span></div><div class="line" id="l596"><br></div><div class="line" id="l597">            <span class="c">while ((tkn = scanner.scan()) == XMLScanner.Token.LT)</span></div><div class="line" id="l598">            {
</div><div class="line" id="l599">                <span class="c">if (scanner.scan() != XMLScanner.Token.IDENT || !scanner.Identifier.Equals("ref"))</span></div><div class="line" id="l600">                {
</div><div class="line" id="l601">                    <span class="c">throwException("&lt;ref&gt; element expected");</span></div><div class="line" id="l602">                }
</div><div class="line" id="l603">                <span class="c">XMLElement refElem = readElement("ref");</span></div><div class="line" id="l604">                Key key;
</div><div class="line" id="l605">                <span class="c">if (fieldNames != null)</span></div><div class="line" id="l606">                { 
</div><div class="line" id="l607">                    <span class="c">String[] values = new String[fieldNames.Length];</span></div><div class="line" id="l608">                    <span class="c">ClassDescriptor.FieldType[] types = btree.FieldTypes;</span></div><div class="line" id="l609">                    for (<span class="c">int i = 0;</span> <span class="c">i &lt; values.Length</span>; <span class="c">i++</span>)</div><div class="line" id="l610">                    { 
</div><div class="line" id="l611">                        <span class="c">values[i] = getAttribute(refElem, "key"+i);</span></div><div class="line" id="l612">                    }
</div><div class="line" id="l613">                    <span class="c">key = createCompoundKey(types, values);</span></div><div class="line" id="l614">                } 
</div><div class="line" id="l615">                else 
</div><div class="line" id="l616">                { 
</div><div class="line" id="l617">                    <span class="c">key = createKey(btree.FieldType, getAttribute(refElem, "key"));</span></div><div class="line" id="l618">                }
</div><div class="line" id="l619">                <span class="c">IPersistent obj = new PersistentStub(storage, mapId(getIntAttribute(refElem, "id")));</span></div><div class="line" id="l620">                <span class="c">btree.insert(key, obj, false);</span></div><div class="line" id="l621">            }
</div><div class="line" id="l622">            <span class="c">if (tkn != XMLScanner.Token.LTS</span></div><div class="line" id="l623"><span class="c">                || scanner.scan() != XMLScanner.Token.IDENT</span></div><div class="line" id="l624"><span class="c">                || !scanner.Identifier.Equals(indexType)</span></div><div class="line" id="l625">                || scanner.scan() != XMLScanner.Token.GT<span class="c">)</span></div><div class="line" id="l626">            {
</div><div class="line" id="l627">                <span class="c">throwException("Element is not closed");</span></div><div class="line" id="l628">            }
</div><div class="line" id="l629">            <span class="c">ByteBuffer buf = new ByteBuffer(storage.encoding);</span></div><div class="line" id="l630">            <span class="c">buf.extend(ObjectHeader.Sizeof);</span></div><div class="line" id="l631">            <span class="c">int size = storage.packObject(btree, desc, ObjectHeader.Sizeof, buf, null);</span></div><div class="line" id="l632">            <span class="c">byte[] data = buf.arr;</span></div><div class="line" id="l633">            <span class="c">ObjectHeader.setSize(data, 0, size);</span></div><div class="line" id="l634">            <span class="c">ObjectHeader.setType(data, 0, desc.Oid);</span></div><div class="line" id="l635">            <span class="c">long pos = storage.allocate(size, 0);</span></div><div class="line" id="l636">            <span class="c">storage.setPos(oid, pos | StorageImpl.dbModifiedFlag);</span></div><div class="line" id="l637"><br></div><div class="line" id="l638">            <span class="c">storage.pool.put(pos &amp; ~ StorageImpl.dbFlagsMask, data, size);</span></div><div class="line" id="l639">        <span class="c">}</span></div><div class="line" id="l640"><br></div><div class="line" id="l641">        internal void  createObject(XMLElement elem)
</div><div class="line" id="l642">        {
</div><div class="line" id="l643">            <span class="c">ClassDescriptor desc = storage.getClassDescriptor(findClassByName(elem.Name));</span></div><div class="line" id="l644">            <span class="c">int oid = mapId(getIntAttribute(elem, "id"));</span></div><div class="line" id="l645">            <span class="c">ByteBuffer buf = new ByteBuffer(storage.encoding);</span></div><div class="line" id="l646">            <span class="c">int offs = ObjectHeader.Sizeof;</span></div><div class="line" id="l647">            <span class="c">buf.extend(offs);</span></div><div class="line" id="l648"><br></div><div class="line" id="l649">            <span class="c">offs = packObject(elem, desc, offs, buf);</span></div><div class="line" id="l650"><br></div><div class="line" id="l651">            <span class="c">ObjectHeader.setSize(buf.arr, 0, offs);</span></div><div class="line" id="l652">            <span class="c">ObjectHeader.setType(buf.arr, 0, desc.Oid);</span></div><div class="line" id="l653"><br></div><div class="line" id="l654">            <span class="c">long pos = storage.allocate(offs, 0);</span></div><div class="line" id="l655">            <span class="c">storage.setPos(oid, pos | StorageImpl.dbModifiedFlag);</span></div><div class="line" id="l656">            <span class="c">storage.pool.put(pos, buf.arr, offs);</span></div><div class="line" id="l657">        <span class="c">}</span></div><div class="line" id="l658"><br></div><div class="line" id="l659">        internal int getHexValue(char ch)
</div><div class="line" id="l660">        {
</div><div class="line" id="l661">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9')
</div><div class="line" id="l662">            {
</div><div class="line" id="l663">                return ch - '0';
</div><div class="line" id="l664">            }
</div><div class="line" id="l665">            else if (ch &gt;= 'A' &amp;&amp; ch &lt;= 'F')
</div><div class="line" id="l666">            {
</div><div class="line" id="l667">                return ch - 'A' + 10;
</div><div class="line" id="l668">            }
</div><div class="line" id="l669">            else if (ch &gt;= 'a' &amp;&amp; ch &lt;= 'f')
</div><div class="line" id="l670">            {
</div><div class="line" id="l671">                return ch - 'a' + 10;
</div><div class="line" id="l672">            }
</div><div class="line" id="l673">            else
</div><div class="line" id="l674">            {
</div><div class="line" id="l675">                throwException("Bad hexadecimal constant");
</div><div class="line" id="l676">            }
</div><div class="line" id="l677">            return - 1;
</div><div class="line" id="l678">        }
</div><div class="line" id="l679"><br></div><div class="line" id="l680">        internal int importBinary(XMLElement elem, int offs, ByteBuffer buf, String fieldName) 
</div><div class="line" id="l681">        { 
</div><div class="line" id="l682">            if (elem == null || elem.isNullValue()) 
</div><div class="line" id="l683">            {
</div><div class="line" id="l684">                buf.extend(offs + 4);
</div><div class="line" id="l685">                Bytes.pack4(buf.arr, offs, -1);
</div><div class="line" id="l686">                offs += 4;
</div><div class="line" id="l687">            } 
</div><div class="line" id="l688">            else if (elem.isStringValue()) 
</div><div class="line" id="l689">            {
</div><div class="line" id="l690">                String hexStr = elem.StringValue;
</div><div class="line" id="l691">                int len = hexStr.Length;
</div><div class="line" id="l692">                if (hexStr.StartsWith("#")) 
</div><div class="line" id="l693">                { 
</div><div class="line" id="l694">                    buf.extend(offs + 4 + len/2-1);
</div><div class="line" id="l695">                    Bytes.pack4(buf.arr, offs, -2-getHexValue(hexStr[1]));  
</div><div class="line" id="l696">                    offs += 4;
</div><div class="line" id="l697">                    for (int j = 2; j &lt; len; j += 2) 
</div><div class="line" id="l698">                    { 
</div><div class="line" id="l699">                        buf.arr[offs++] = (byte)((getHexValue(hexStr[j]) &lt;&lt; 4) | getHexValue(hexStr[j+1]));
</div><div class="line" id="l700">                    }
</div><div class="line" id="l701">                } 
</div><div class="line" id="l702">                else 
</div><div class="line" id="l703">                { 
</div><div class="line" id="l704">                    buf.extend(offs + 4 + len/2);
</div><div class="line" id="l705">                    Bytes.pack4(buf.arr, offs, len/2);
</div><div class="line" id="l706">                    offs += 4;
</div><div class="line" id="l707">                    for (int j = 0; j &lt; len; j += 2) 
</div><div class="line" id="l708">                    { 
</div><div class="line" id="l709">                        buf.arr[offs++] = (byte)((getHexValue(hexStr[j]) &lt;&lt; 4) | getHexValue(hexStr[j+1]));
</div><div class="line" id="l710">                    }
</div><div class="line" id="l711">                }
</div><div class="line" id="l712">            } 
</div><div class="line" id="l713">            else 
</div><div class="line" id="l714">            { 
</div><div class="line" id="l715">                XMLElement refElem = elem.getSibling("ref");
</div><div class="line" id="l716">                if (refElem != null) 
</div><div class="line" id="l717">                { 
</div><div class="line" id="l718">                    buf.extend(offs + 4);
</div><div class="line" id="l719">                    Bytes.pack4(buf.arr, offs, mapId(getIntAttribute(refElem, "id")));
</div><div class="line" id="l720">                    offs += 4;
</div><div class="line" id="l721">                } 
</div><div class="line" id="l722">                else 
</div><div class="line" id="l723">                { 
</div><div class="line" id="l724">                    XMLElement item = elem.getSibling("element");
</div><div class="line" id="l725">                    int len = (item == null) ? 0 : item.Counter; 
</div><div class="line" id="l726">                    buf.extend(offs + 4 + len);
</div><div class="line" id="l727">                    Bytes.pack4(buf.arr, offs, len);
</div><div class="line" id="l728">                    offs += 4;
</div><div class="line" id="l729">                    while (--len &gt;= 0) 
</div><div class="line" id="l730">                    { 
</div><div class="line" id="l731">                        if (item.isIntValue()) 
</div><div class="line" id="l732">                        { 
</div><div class="line" id="l733">                            buf.arr[offs] = (byte)item.IntValue;
</div><div class="line" id="l734">                        } 
</div><div class="line" id="l735">                        else if (item.isRealValue()) 
</div><div class="line" id="l736">                        { 
</div><div class="line" id="l737">                            buf.arr[offs] = (byte)item.RealValue;
</div><div class="line" id="l738">                        } 
</div><div class="line" id="l739">                        else 
</div><div class="line" id="l740">                        {
</div><div class="line" id="l741">                            throwException("Conversion for field " + fieldName + " is not possible");
</div><div class="line" id="l742">                        }
</div><div class="line" id="l743">                        item = item.NextSibling;
</div><div class="line" id="l744">                        offs += 1;
</div><div class="line" id="l745">                    }
</div><div class="line" id="l746">                }
</div><div class="line" id="l747">            }
</div><div class="line" id="l748">            return offs;
</div><div class="line" id="l749">        }
</div><div class="line" id="l750"><br></div><div class="line" id="l751">        internal int packObject(XMLElement objElem, ClassDescriptor desc, int offs, ByteBuffer buf)
</div><div class="line" id="l752">        {
</div><div class="line" id="l753">            <span class="c">ClassDescriptor.FieldDescriptor[] flds = desc.allFields;</span></div><div class="line" id="l754">            for (<span class="c">int i = 0,</span> <span class="c">n = flds.Length;</span> <span class="c">i &lt; n</span>; <span class="c">i++</span>)</div><div class="line" id="l755">            {
</div><div class="line" id="l756">                <span class="c">ClassDescriptor.FieldDescriptor fd = flds[i];</span></div><div class="line" id="l757">                <span class="c">FieldInfo f = fd.field;</span></div><div class="line" id="l758">                <span class="c">String fieldName = fd.fieldName;</span></div><div class="line" id="l759">                <span class="c">XMLElement elem = (objElem != null)?objElem.getSibling(fieldName):null;</span></div><div class="line" id="l760"><br></div><div class="line" id="l761">                <span class="c">switch (fd.type)</span></div><div class="line" id="l762">                {
</div><div class="line" id="l763">                    case ClassDescriptor.FieldType.tpByte: 
</div><div class="line" id="l764">                    case ClassDescriptor.FieldType.tpSByte: 
</div><div class="line" id="l765">                        <span class="c">buf.extend(offs + 1);</span></div><div class="line" id="l766">                        <span class="c">if (elem != null)</span></div><div class="line" id="l767">                        {
</div><div class="line" id="l768">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l769">                            {
</div><div class="line" id="l770">                                <span class="c">buf.arr[offs] = (byte) elem.IntValue;</span></div><div class="line" id="l771">                            }
</div><div class="line" id="l772">                            else <span class="c">if (elem.isRealValue())</span></div><div class="line" id="l773">                            {
</div><div class="line" id="l774">                                <span class="c">buf.arr[offs] = (byte) elem.RealValue;</span></div><div class="line" id="l775">                            }
</div><div class="line" id="l776">                            else
</div><div class="line" id="l777">                            {
</div><div class="line" id="l778">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l779">                            }
</div><div class="line" id="l780">                        }
</div><div class="line" id="l781">                        <span class="c">offs += 1;</span></div><div class="line" id="l782">                        <span class="c">continue;</span></div><div class="line" id="l783"><br></div><div class="line" id="l784">                    case ClassDescriptor.FieldType.tpBoolean: 
</div><div class="line" id="l785">                        <span class="c">buf.extend(offs + 1);</span></div><div class="line" id="l786">                        <span class="c">if (elem != null)</span></div><div class="line" id="l787">                        {
</div><div class="line" id="l788">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l789">                            {
</div><div class="line" id="l790">                                <span class="c">buf.arr[offs] = (byte) (elem.IntValue != 0?1:0);</span></div><div class="line" id="l791">                            }
</div><div class="line" id="l792">                            else <span class="c">if (elem.isRealValue())</span></div><div class="line" id="l793">                            {
</div><div class="line" id="l794">                                <span class="c">buf.arr[offs] = (byte) (elem.RealValue != 0.0?1:0);</span></div><div class="line" id="l795">                            }
</div><div class="line" id="l796">                            else
</div><div class="line" id="l797">                            {
</div><div class="line" id="l798">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l799">                            }
</div><div class="line" id="l800">                        }
</div><div class="line" id="l801">                        <span class="c">offs += 1;</span></div><div class="line" id="l802">                        <span class="c">continue;</span></div><div class="line" id="l803"><br></div><div class="line" id="l804">                    case ClassDescriptor.FieldType.tpShort: 
</div><div class="line" id="l805">                    case ClassDescriptor.FieldType.tpUShort: 
</div><div class="line" id="l806">                    case ClassDescriptor.FieldType.tpChar: 
</div><div class="line" id="l807">                        <span class="c">buf.extend(offs + 2);</span></div><div class="line" id="l808">                        <span class="c">if (elem != null)</span></div><div class="line" id="l809">                        {
</div><div class="line" id="l810">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l811">                            {
</div><div class="line" id="l812">                                <span class="c">Bytes.pack2(buf.arr, offs, (short) elem.IntValue);</span></div><div class="line" id="l813">                            }
</div><div class="line" id="l814">                            else <span class="c">if (elem.isRealValue())</span></div><div class="line" id="l815">                            {
</div><div class="line" id="l816">                                <span class="c">Bytes.pack2(buf.arr, offs, (short) elem.RealValue);</span></div><div class="line" id="l817">                            }
</div><div class="line" id="l818">                            else
</div><div class="line" id="l819">                            {
</div><div class="line" id="l820">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l821">                            }
</div><div class="line" id="l822">                        }
</div><div class="line" id="l823">                        <span class="c">offs += 2;</span></div><div class="line" id="l824">                        <span class="c">continue;</span></div><div class="line" id="l825"><br></div><div class="line" id="l826">                    case ClassDescriptor.FieldType.tpEnum: 
</div><div class="line" id="l827">                        <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l828">                        <span class="c">if (elem != null)</span></div><div class="line" id="l829">                        {
</div><div class="line" id="l830">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l831">                            {
</div><div class="line" id="l832">                                <span class="c">Bytes.pack4(buf.arr, offs, (int) elem.IntValue);</span></div><div class="line" id="l833">                            }
</div><div class="line" id="l834">                            else <span class="c">if (elem.isRealValue())</span></div><div class="line" id="l835">                            {
</div><div class="line" id="l836">                                <span class="c">Bytes.pack4(buf.arr, offs, (int) elem.RealValue);</span></div><div class="line" id="l837">                            }
</div><div class="line" id="l838">                            else <span class="c">if (elem.isStringValue())</span></div><div class="line" id="l839">                            {
</div><div class="line" id="l840">                                try 
</div><div class="line" id="l841">                                {
</div><div class="line" id="l842">#if COMPACT_NET_FRAMEWORK
</div><div class="line" id="l843">                                    Bytes.pack4(buf.arr, offs, (int)ClassDescriptor.parseEnum(f.FieldType, elem.StringValue));
</div><div class="line" id="l844">#else
</div><div class="line" id="l845">                                    <span class="c">Bytes.pack4(buf.arr, offs, (int)Enum.Parse(f.FieldType, elem.StringValue));</span></div><div class="line" id="l846">#endif
</div><div class="line" id="l847">                                } 
</div><div class="line" id="l848">                                <span class="c">catch (ArgumentException)</span></div><div class="line" id="l849">                                {
</div><div class="line" id="l850">                                    <span class="c">throwException("Invalid enum value");</span></div><div class="line" id="l851">                                }
</div><div class="line" id="l852">                            }
</div><div class="line" id="l853">                            else
</div><div class="line" id="l854">                            {
</div><div class="line" id="l855">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l856">                            }
</div><div class="line" id="l857">                        }
</div><div class="line" id="l858">                        <span class="c">offs += 4;</span></div><div class="line" id="l859">                        <span class="c">continue;</span></div><div class="line" id="l860"><br></div><div class="line" id="l861">                    case ClassDescriptor.FieldType.tpInt: 
</div><div class="line" id="l862">                    case ClassDescriptor.FieldType.tpUInt: 
</div><div class="line" id="l863">                        <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l864">                        <span class="c">if (elem != null)</span></div><div class="line" id="l865">                        {
</div><div class="line" id="l866">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l867">                            {
</div><div class="line" id="l868">                                <span class="c">Bytes.pack4(buf.arr, offs, (int) elem.IntValue);</span></div><div class="line" id="l869">                            }
</div><div class="line" id="l870">                            else <span class="c">if (elem.isRealValue())</span></div><div class="line" id="l871">                            {
</div><div class="line" id="l872">                                <span class="c">Bytes.pack4(buf.arr, offs, (int) elem.RealValue);</span></div><div class="line" id="l873">                            }
</div><div class="line" id="l874">                            else
</div><div class="line" id="l875">                            {
</div><div class="line" id="l876">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l877">                            }
</div><div class="line" id="l878">                        }
</div><div class="line" id="l879">                        <span class="c">offs += 4;</span></div><div class="line" id="l880">                        <span class="c">continue;</span></div><div class="line" id="l881"><br></div><div class="line" id="l882">                    case ClassDescriptor.FieldType.tpLong: 
</div><div class="line" id="l883">                    case ClassDescriptor.FieldType.tpULong: 
</div><div class="line" id="l884">                        <span class="c">buf.extend(offs + 8);</span></div><div class="line" id="l885">                        <span class="c">if (elem != null)</span></div><div class="line" id="l886">                        {
</div><div class="line" id="l887">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l888">                            {
</div><div class="line" id="l889">                                <span class="c">Bytes.pack8(buf.arr, offs, elem.IntValue);</span></div><div class="line" id="l890">                            }
</div><div class="line" id="l891">                            else <span class="c">if (elem.isRealValue())</span></div><div class="line" id="l892">                            {
</div><div class="line" id="l893">                                <span class="c">Bytes.pack8(buf.arr, offs, (long) elem.RealValue);</span></div><div class="line" id="l894">                            }
</div><div class="line" id="l895">                            else
</div><div class="line" id="l896">                            {
</div><div class="line" id="l897">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l898">                            }
</div><div class="line" id="l899">                        }
</div><div class="line" id="l900">                        <span class="c">offs += 8;</span></div><div class="line" id="l901">                        <span class="c">continue;</span></div><div class="line" id="l902"><br></div><div class="line" id="l903">                    case ClassDescriptor.FieldType.tpFloat: 
</div><div class="line" id="l904">                        <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l905">                        <span class="c">if (elem != null)</span></div><div class="line" id="l906">                        {
</div><div class="line" id="l907">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l908">                            {
</div><div class="line" id="l909">                                <span class="c">Bytes.packF4(buf.arr, offs, (float)elem.IntValue);</span></div><div class="line" id="l910">                            }
</div><div class="line" id="l911">                            else <span class="c">if (elem.isRealValue())</span></div><div class="line" id="l912">                            {
</div><div class="line" id="l913">                                <span class="c">Bytes.packF4(buf.arr, offs, (float) elem.RealValue);</span></div><div class="line" id="l914">                            }
</div><div class="line" id="l915">                            else
</div><div class="line" id="l916">                            {
</div><div class="line" id="l917">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l918">                            }
</div><div class="line" id="l919">                        }
</div><div class="line" id="l920">                        <span class="c">offs += 4;</span></div><div class="line" id="l921">                        <span class="c">continue;</span></div><div class="line" id="l922"><br></div><div class="line" id="l923">                    case ClassDescriptor.FieldType.tpDouble: 
</div><div class="line" id="l924">                        <span class="c">buf.extend(offs + 8);</span></div><div class="line" id="l925">                        <span class="c">if (elem != null)</span></div><div class="line" id="l926">                        {
</div><div class="line" id="l927">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l928">                            {
</div><div class="line" id="l929">                                <span class="c">Bytes.packF8(buf.arr, offs, (double) elem.IntValue);</span></div><div class="line" id="l930">                            }
</div><div class="line" id="l931">                            else <span class="c">if (elem.isRealValue())</span></div><div class="line" id="l932">                            {
</div><div class="line" id="l933">                                <span class="c">Bytes.packF8(buf.arr, offs, elem.RealValue);</span></div><div class="line" id="l934">                            }
</div><div class="line" id="l935">                            else
</div><div class="line" id="l936">                            {
</div><div class="line" id="l937">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l938">                            }
</div><div class="line" id="l939">                        }
</div><div class="line" id="l940">                        <span class="c">offs += 8;</span></div><div class="line" id="l941">                        <span class="c">continue;</span></div><div class="line" id="l942"><br></div><div class="line" id="l943">                    case ClassDescriptor.FieldType.tpDecimal: 
</div><div class="line" id="l944">                        <span class="c">buf.extend(offs + 16);</span></div><div class="line" id="l945">                        <span class="c">if (elem != null)</span></div><div class="line" id="l946">                        {
</div><div class="line" id="l947">                            <span class="c">decimal d = 0;</span></div><div class="line" id="l948">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l949">                            {
</div><div class="line" id="l950">                                <span class="c">d = elem.IntValue;</span></div><div class="line" id="l951">                            }
</div><div class="line" id="l952">                            else <span class="c">if (elem.isRealValue())</span></div><div class="line" id="l953">                            {
</div><div class="line" id="l954">                                <span class="c">d = (decimal)elem.RealValue;</span></div><div class="line" id="l955">                            }
</div><div class="line" id="l956">                            else <span class="c">if (elem.isStringValue())</span></div><div class="line" id="l957">                            {
</div><div class="line" id="l958">                                try 
</div><div class="line" id="l959">                                { 
</div><div class="line" id="l960">                                    <span class="c">d = Decimal.Parse(elem.StringValue);</span></div><div class="line" id="l961">                                } 
</div><div class="line" id="l962">                                <span class="c">catch (FormatException)</span></div><div class="line" id="l963">                                {
</div><div class="line" id="l964">                                    <span class="c">throwException("Invalid date");</span></div><div class="line" id="l965">                                }
</div><div class="line" id="l966">                            }
</div><div class="line" id="l967">                            else
</div><div class="line" id="l968">                            {
</div><div class="line" id="l969">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l970">                            }
</div><div class="line" id="l971">                            <span class="c">Bytes.packDecimal(buf.arr, offs, d);</span></div><div class="line" id="l972"><br></div><div class="line" id="l973">                        }
</div><div class="line" id="l974">                        <span class="c">offs += 16;</span></div><div class="line" id="l975">                        <span class="c">continue;</span></div><div class="line" id="l976"><br></div><div class="line" id="l977">                    case ClassDescriptor.FieldType.tpGuid: 
</div><div class="line" id="l978">                        <span class="c">buf.extend(offs + 16);</span></div><div class="line" id="l979">                        <span class="c">if (elem != null)</span></div><div class="line" id="l980">                        {
</div><div class="line" id="l981">                            <span class="c">if (elem.isStringValue())</span></div><div class="line" id="l982">                            {
</div><div class="line" id="l983">                                <span class="c">Guid guid = new Guid(elem.StringValue);</span></div><div class="line" id="l984">                                <span class="c">byte[] bits = guid.ToByteArray();</span></div><div class="line" id="l985">                                <span class="c">Array.Copy(bits, 0, buf.arr, offs, 16);</span></div><div class="line" id="l986">                            }
</div><div class="line" id="l987">                            else
</div><div class="line" id="l988">                            {
</div><div class="line" id="l989">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l990">                            }
</div><div class="line" id="l991">                        }
</div><div class="line" id="l992">                        <span class="c">offs += 16;</span></div><div class="line" id="l993">                        <span class="c">continue;</span></div><div class="line" id="l994"><br></div><div class="line" id="l995">                    case ClassDescriptor.FieldType.tpDate: 
</div><div class="line" id="l996">                        <span class="c">buf.extend(offs + 8);</span></div><div class="line" id="l997">                        <span class="c">if (elem != null)</span></div><div class="line" id="l998">                        {
</div><div class="line" id="l999">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l1000">                            {
</div><div class="line" id="l1001">                                <span class="c">Bytes.pack8(buf.arr, offs, elem.IntValue);</span></div><div class="line" id="l1002">                            }
</div><div class="line" id="l1003">                            else <span class="c">if (elem.isNullValue())</span></div><div class="line" id="l1004">                            {
</div><div class="line" id="l1005">                                <span class="c">Bytes.pack8(buf.arr, offs, - 1);</span></div><div class="line" id="l1006">                            }
</div><div class="line" id="l1007">                            else <span class="c">if (elem.isStringValue())</span></div><div class="line" id="l1008">                            {
</div><div class="line" id="l1009">                                try 
</div><div class="line" id="l1010">                                { 
</div><div class="line" id="l1011">                                    <span class="c">Bytes.packDate(buf.arr, offs, DateTime.Parse(elem.StringValue));</span></div><div class="line" id="l1012">                                } 
</div><div class="line" id="l1013">                                <span class="c">catch (FormatException)</span></div><div class="line" id="l1014">                                {
</div><div class="line" id="l1015">                                    <span class="c">throwException("Invalid date");</span></div><div class="line" id="l1016">                                }
</div><div class="line" id="l1017">                            }
</div><div class="line" id="l1018">                            else
</div><div class="line" id="l1019">                            {
</div><div class="line" id="l1020">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1021">                            }
</div><div class="line" id="l1022">                        }
</div><div class="line" id="l1023">                        <span class="c">offs += 8;</span></div><div class="line" id="l1024">                        <span class="c">continue;</span></div><div class="line" id="l1025"><br></div><div class="line" id="l1026">                    case ClassDescriptor.FieldType.tpString: 
</div><div class="line" id="l1027">                        <span class="c">if (elem != null)</span></div><div class="line" id="l1028">                        {
</div><div class="line" id="l1029">                            <span class="c">System.String val = null;</span></div><div class="line" id="l1030">                            <span class="c">if (elem.isIntValue())</span></div><div class="line" id="l1031">                            {
</div><div class="line" id="l1032">                                <span class="c">val = System.Convert.ToString(elem.IntValue);</span></div><div class="line" id="l1033">                            }
</div><div class="line" id="l1034">                            else <span class="c">if (elem.isRealValue())</span></div><div class="line" id="l1035">                            {
</div><div class="line" id="l1036">                                <span class="c">val = elem.RealValue.ToString();</span></div><div class="line" id="l1037">                            }
</div><div class="line" id="l1038">                            else <span class="c">if (elem.isStringValue())</span></div><div class="line" id="l1039">                            {
</div><div class="line" id="l1040">                                <span class="c">val = elem.StringValue;</span></div><div class="line" id="l1041">                            }
</div><div class="line" id="l1042">                            else <span class="c">if (elem.isNullValue())</span></div><div class="line" id="l1043">                            {
</div><div class="line" id="l1044">                                <span class="c">val = null;</span></div><div class="line" id="l1045">                            }
</div><div class="line" id="l1046">                            else
</div><div class="line" id="l1047">                            {
</div><div class="line" id="l1048">                                <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1049">                            }
</div><div class="line" id="l1050">                            <span class="c">offs = buf.packString(offs, val);</span></div><div class="line" id="l1051">                            <span class="c">continue;</span></div><div class="line" id="l1052">                        }
</div><div class="line" id="l1053">                        <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1054">                        <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1055">                        <span class="c">offs += 4;</span></div><div class="line" id="l1056">                        <span class="c">continue;</span></div><div class="line" id="l1057"><br></div><div class="line" id="l1058">                    case ClassDescriptor.FieldType.tpOid: 
</div><div class="line" id="l1059">                    case ClassDescriptor.FieldType.tpObject: 
</div><div class="line" id="l1060">                    {
</div><div class="line" id="l1061">                        <span class="c">int oid = 0;</span></div><div class="line" id="l1062">                        <span class="c">if (elem != null)</span></div><div class="line" id="l1063">                        {
</div><div class="line" id="l1064">                            <span class="c">XMLElement refElem = elem.getSibling("ref");</span></div><div class="line" id="l1065">                            <span class="c">if (refElem == null)</span></div><div class="line" id="l1066">                            {
</div><div class="line" id="l1067">                                <span class="c">throwException("&lt;ref&gt; element expected");</span></div><div class="line" id="l1068">                            }
</div><div class="line" id="l1069">                            <span class="c">oid = mapId(getIntAttribute(refElem, "id"));</span></div><div class="line" id="l1070">                        }
</div><div class="line" id="l1071">                        <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1072">                        <span class="c">Bytes.pack4(buf.arr, offs, oid);</span></div><div class="line" id="l1073">                        <span class="c">offs += 4;</span></div><div class="line" id="l1074">                        <span class="c">continue;</span></div><div class="line" id="l1075">                    }
</div><div class="line" id="l1076"><br></div><div class="line" id="l1077">                    case ClassDescriptor.FieldType.tpValue: 
</div><div class="line" id="l1078">                        <span class="c">offs = packObject(elem, fd.valueDesc, offs, buf);</span></div><div class="line" id="l1079">                        <span class="c">continue;</span></div><div class="line" id="l1080"><br></div><div class="line" id="l1081">#if SUPPORT_RAW_TYPE
</div><div class="line" id="l1082">                    case ClassDescriptor.FieldType.tpRaw: 
</div><div class="line" id="l1083">#endif
</div><div class="line" id="l1084">                    case ClassDescriptor.FieldType.tpArrayOfByte: 
</div><div class="line" id="l1085">                    case ClassDescriptor.FieldType.tpArrayOfSByte: 
</div><div class="line" id="l1086">                        <span class="c">offs = importBinary(elem, offs, buf, fieldName);</span></div><div class="line" id="l1087">                        <span class="c">continue;</span></div><div class="line" id="l1088"><br></div><div class="line" id="l1089">                    case ClassDescriptor.FieldType.tpArrayOfBoolean: 
</div><div class="line" id="l1090">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1091">                        {
</div><div class="line" id="l1092">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1093">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1094">                            <span class="c">offs += 4;</span></div><div class="line" id="l1095">                        }
</div><div class="line" id="l1096">                        else
</div><div class="line" id="l1097">                        {
</div><div class="line" id="l1098">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1099">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1100">                            <span class="c">buf.extend(offs + 4 + len);</span></div><div class="line" id="l1101">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1102">                            <span class="c">offs += 4;</span></div><div class="line" id="l1103">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1104">                            {
</div><div class="line" id="l1105">                                <span class="c">if (item.isIntValue())</span></div><div class="line" id="l1106">                                {
</div><div class="line" id="l1107">                                    <span class="c">buf.arr[offs] = (byte) (item.IntValue != 0?1:0);</span></div><div class="line" id="l1108">                                }
</div><div class="line" id="l1109">                                else <span class="c">if (item.isRealValue())</span></div><div class="line" id="l1110">                                {
</div><div class="line" id="l1111">                                    <span class="c">buf.arr[offs] = (byte) (item.RealValue != 0.0?1:0);</span></div><div class="line" id="l1112">                                }
</div><div class="line" id="l1113">                                else
</div><div class="line" id="l1114">                                {
</div><div class="line" id="l1115">                                    <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1116">                                }
</div><div class="line" id="l1117">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1118">                                <span class="c">offs += 1;</span></div><div class="line" id="l1119">                            }
</div><div class="line" id="l1120">                        }
</div><div class="line" id="l1121">                        <span class="c">continue;</span></div><div class="line" id="l1122"><br></div><div class="line" id="l1123">                    case ClassDescriptor.FieldType.tpArrayOfChar: 
</div><div class="line" id="l1124">                    case ClassDescriptor.FieldType.tpArrayOfShort: 
</div><div class="line" id="l1125">                    case ClassDescriptor.FieldType.tpArrayOfUShort: 
</div><div class="line" id="l1126">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1127">                        {
</div><div class="line" id="l1128">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1129">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1130">                            <span class="c">offs += 4;</span></div><div class="line" id="l1131">                        }
</div><div class="line" id="l1132">                        else
</div><div class="line" id="l1133">                        {
</div><div class="line" id="l1134">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1135">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1136">                            <span class="c">buf.extend(offs + 4 + len * 2);</span></div><div class="line" id="l1137">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1138">                            <span class="c">offs += 4;</span></div><div class="line" id="l1139">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1140">                            {
</div><div class="line" id="l1141">                                <span class="c">if (item.isIntValue())</span></div><div class="line" id="l1142">                                {
</div><div class="line" id="l1143">                                    <span class="c">Bytes.pack2(buf.arr, offs, (short) item.IntValue);</span></div><div class="line" id="l1144">                                }
</div><div class="line" id="l1145">                                else <span class="c">if (item.isRealValue())</span></div><div class="line" id="l1146">                                {
</div><div class="line" id="l1147">                                    <span class="c">Bytes.pack2(buf.arr, offs, (short) item.RealValue);</span></div><div class="line" id="l1148">                                }
</div><div class="line" id="l1149">                                else
</div><div class="line" id="l1150">                                {
</div><div class="line" id="l1151">                                    <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1152">                                }
</div><div class="line" id="l1153">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1154">                                <span class="c">offs += 2;</span></div><div class="line" id="l1155">                            }
</div><div class="line" id="l1156">                        }
</div><div class="line" id="l1157">                        <span class="c">continue;</span></div><div class="line" id="l1158"><br></div><div class="line" id="l1159">                    case ClassDescriptor.FieldType.tpArrayOfEnum: 
</div><div class="line" id="l1160">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1161">                        {
</div><div class="line" id="l1162">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1163">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1164">                            <span class="c">offs += 4;</span></div><div class="line" id="l1165">                        }
</div><div class="line" id="l1166">                        else
</div><div class="line" id="l1167">                        {
</div><div class="line" id="l1168">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1169">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1170">                            <span class="c">Type elemType = f.FieldType.GetElementType();</span></div><div class="line" id="l1171">                            <span class="c">buf.extend(offs + 4 + len * 4);</span></div><div class="line" id="l1172">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1173">                            <span class="c">offs += 4;</span></div><div class="line" id="l1174">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1175">                            {
</div><div class="line" id="l1176">                                <span class="c">if (item.isIntValue())</span></div><div class="line" id="l1177">                                {
</div><div class="line" id="l1178">                                    <span class="c">Bytes.pack4(buf.arr, offs, (int) item.IntValue);</span></div><div class="line" id="l1179">                                }
</div><div class="line" id="l1180">                                else <span class="c">if (item.isRealValue())</span></div><div class="line" id="l1181">                                {
</div><div class="line" id="l1182">                                    <span class="c">Bytes.pack4(buf.arr, offs, (int) item.RealValue);</span></div><div class="line" id="l1183">                                }
</div><div class="line" id="l1184">                                else <span class="c">if (item.isStringValue())</span></div><div class="line" id="l1185">                                {
</div><div class="line" id="l1186">                                    try 
</div><div class="line" id="l1187">                                    {
</div><div class="line" id="l1188">#if COMPACT_NET_FRAMEWORK
</div><div class="line" id="l1189">                                        Bytes.pack4(buf.arr, offs, (int)ClassDescriptor.parseEnum(elemType, item.StringValue));
</div><div class="line" id="l1190">#else
</div><div class="line" id="l1191">                                        <span class="c">Bytes.pack4(buf.arr, offs, (int)Enum.Parse(elemType, item.StringValue));</span></div><div class="line" id="l1192">#endif
</div><div class="line" id="l1193">                                    } 
</div><div class="line" id="l1194">                                    <span class="c">catch (ArgumentException)</span></div><div class="line" id="l1195">                                    {
</div><div class="line" id="l1196">                                        <span class="c">throwException("Invalid enum value");</span></div><div class="line" id="l1197">                                    }
</div><div class="line" id="l1198">                                }
</div><div class="line" id="l1199">                                else
</div><div class="line" id="l1200">                                {
</div><div class="line" id="l1201">                                    <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1202">                                }
</div><div class="line" id="l1203">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1204">                                <span class="c">offs += 4;</span></div><div class="line" id="l1205">                            }
</div><div class="line" id="l1206">                        }
</div><div class="line" id="l1207">                        <span class="c">continue;</span></div><div class="line" id="l1208"><br></div><div class="line" id="l1209">                    case ClassDescriptor.FieldType.tpArrayOfInt: 
</div><div class="line" id="l1210">                    case ClassDescriptor.FieldType.tpArrayOfUInt: 
</div><div class="line" id="l1211">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1212">                        {
</div><div class="line" id="l1213">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1214">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1215">                            <span class="c">offs += 4;</span></div><div class="line" id="l1216">                        }
</div><div class="line" id="l1217">                        else
</div><div class="line" id="l1218">                        {
</div><div class="line" id="l1219">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1220">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1221">                            <span class="c">buf.extend(offs + 4 + len * 4);</span></div><div class="line" id="l1222">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1223">                            <span class="c">offs += 4;</span></div><div class="line" id="l1224">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1225">                            {
</div><div class="line" id="l1226">                                <span class="c">if (item.isIntValue())</span></div><div class="line" id="l1227">                                {
</div><div class="line" id="l1228">                                    <span class="c">Bytes.pack4(buf.arr, offs, (int) item.IntValue);</span></div><div class="line" id="l1229">                                }
</div><div class="line" id="l1230">                                else <span class="c">if (item.isRealValue())</span></div><div class="line" id="l1231">                                {
</div><div class="line" id="l1232">                                    <span class="c">Bytes.pack4(buf.arr, offs, (int) item.RealValue);</span></div><div class="line" id="l1233">                                }
</div><div class="line" id="l1234">                                else
</div><div class="line" id="l1235">                                {
</div><div class="line" id="l1236">                                    <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1237">                                }
</div><div class="line" id="l1238">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1239">                                <span class="c">offs += 4;</span></div><div class="line" id="l1240">                            }
</div><div class="line" id="l1241">                        }
</div><div class="line" id="l1242">                        <span class="c">continue;</span></div><div class="line" id="l1243"><br></div><div class="line" id="l1244">                    case ClassDescriptor.FieldType.tpArrayOfLong: 
</div><div class="line" id="l1245">                    case ClassDescriptor.FieldType.tpArrayOfULong: 
</div><div class="line" id="l1246">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1247">                        {
</div><div class="line" id="l1248">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1249">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1250">                            <span class="c">offs += 4;</span></div><div class="line" id="l1251">                        }
</div><div class="line" id="l1252">                        else
</div><div class="line" id="l1253">                        {
</div><div class="line" id="l1254">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1255">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1256">                            <span class="c">buf.extend(offs + 4 + len * 8);</span></div><div class="line" id="l1257">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1258">                            <span class="c">offs += 4;</span></div><div class="line" id="l1259">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1260">                            {
</div><div class="line" id="l1261">                                <span class="c">if (item.isIntValue())</span></div><div class="line" id="l1262">                                {
</div><div class="line" id="l1263">                                    <span class="c">Bytes.pack8(buf.arr, offs, item.IntValue);</span></div><div class="line" id="l1264">                                }
</div><div class="line" id="l1265">                                else <span class="c">if (item.isRealValue())</span></div><div class="line" id="l1266">                                {
</div><div class="line" id="l1267">                                    <span class="c">Bytes.pack8(buf.arr, offs, (long) item.RealValue);</span></div><div class="line" id="l1268">                                }
</div><div class="line" id="l1269">                                else
</div><div class="line" id="l1270">                                {
</div><div class="line" id="l1271">                                    <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1272">                                }
</div><div class="line" id="l1273">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1274">                                <span class="c">offs += 8;</span></div><div class="line" id="l1275">                            }
</div><div class="line" id="l1276">                        }
</div><div class="line" id="l1277">                        <span class="c">continue;</span></div><div class="line" id="l1278"><br></div><div class="line" id="l1279">                    case ClassDescriptor.FieldType.tpArrayOfFloat: 
</div><div class="line" id="l1280">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1281">                        {
</div><div class="line" id="l1282">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1283">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1284">                            <span class="c">offs += 4;</span></div><div class="line" id="l1285">                        }
</div><div class="line" id="l1286">                        else
</div><div class="line" id="l1287">                        {
</div><div class="line" id="l1288">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1289">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1290">                            <span class="c">buf.extend(offs + 4 + len * 4);</span></div><div class="line" id="l1291">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1292">                            <span class="c">offs += 4;</span></div><div class="line" id="l1293">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1294">                            {
</div><div class="line" id="l1295">                                <span class="c">if (item.isIntValue())</span></div><div class="line" id="l1296">                                {
</div><div class="line" id="l1297">                                   <span class="c">Bytes.packF4(buf.arr, offs, (float)item.IntValue);</span></div><div class="line" id="l1298">                                }
</div><div class="line" id="l1299">                                else <span class="c">if (item.isRealValue())</span></div><div class="line" id="l1300">                                {
</div><div class="line" id="l1301">                                    <span class="c">Bytes.packF4(buf.arr, offs, (float)item.RealValue);</span></div><div class="line" id="l1302">                                }
</div><div class="line" id="l1303">                                else
</div><div class="line" id="l1304">                                {
</div><div class="line" id="l1305">                                    <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1306">                                }
</div><div class="line" id="l1307">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1308">                                <span class="c">offs += 4;</span></div><div class="line" id="l1309">                            }
</div><div class="line" id="l1310">                        }
</div><div class="line" id="l1311">                        <span class="c">continue;</span></div><div class="line" id="l1312"><br></div><div class="line" id="l1313">                    case ClassDescriptor.FieldType.tpArrayOfDouble: 
</div><div class="line" id="l1314">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1315">                        {
</div><div class="line" id="l1316">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1317">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1318">                            <span class="c">offs += 4;</span></div><div class="line" id="l1319">                        }
</div><div class="line" id="l1320">                        else
</div><div class="line" id="l1321">                        {
</div><div class="line" id="l1322">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1323">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1324">                            <span class="c">buf.extend(offs + 4 + len * 8);</span></div><div class="line" id="l1325">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1326">                            <span class="c">offs += 4;</span></div><div class="line" id="l1327">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1328">                            {
</div><div class="line" id="l1329">                                <span class="c">if (item.isIntValue())</span></div><div class="line" id="l1330">                                {
</div><div class="line" id="l1331">                                    <span class="c">Bytes.packF8(buf.arr, offs, (double)item.IntValue);</span></div><div class="line" id="l1332">                                }
</div><div class="line" id="l1333">                                else <span class="c">if (item.isRealValue())</span></div><div class="line" id="l1334">                                {
</div><div class="line" id="l1335">                                    <span class="c">Bytes.packF8(buf.arr, offs, item.RealValue);</span></div><div class="line" id="l1336">                                }
</div><div class="line" id="l1337">                                else
</div><div class="line" id="l1338">                                {
</div><div class="line" id="l1339">                                    <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1340">                                }
</div><div class="line" id="l1341">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1342">                                <span class="c">offs += 8;</span></div><div class="line" id="l1343">                            }
</div><div class="line" id="l1344">                        }
</div><div class="line" id="l1345">                        <span class="c">continue;</span></div><div class="line" id="l1346"><br></div><div class="line" id="l1347">                    case ClassDescriptor.FieldType.tpArrayOfDate: 
</div><div class="line" id="l1348">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1349">                        {
</div><div class="line" id="l1350">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1351">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1352">                            <span class="c">offs += 4;</span></div><div class="line" id="l1353">                        }
</div><div class="line" id="l1354">                        else
</div><div class="line" id="l1355">                        {
</div><div class="line" id="l1356">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1357">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1358">                            <span class="c">buf.extend(offs + 4 + len * 8);</span></div><div class="line" id="l1359">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1360">                            <span class="c">offs += 4;</span></div><div class="line" id="l1361">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1362">                            {
</div><div class="line" id="l1363">                                <span class="c">if (item.isNullValue())</span></div><div class="line" id="l1364">                                {
</div><div class="line" id="l1365">                                    <span class="c">Bytes.pack8(buf.arr, offs, - 1);</span></div><div class="line" id="l1366">                                }
</div><div class="line" id="l1367">                                else <span class="c">if (item.isStringValue())</span></div><div class="line" id="l1368">                                {
</div><div class="line" id="l1369">                                    try 
</div><div class="line" id="l1370">                                    { 
</div><div class="line" id="l1371">                                        <span class="c">Bytes.packDate(buf.arr, offs, DateTime.Parse(item.StringValue));</span></div><div class="line" id="l1372">                                    }
</div><div class="line" id="l1373">                                    <span class="c">catch (FormatException)</span></div><div class="line" id="l1374">                                    {
</div><div class="line" id="l1375">                                        <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1376">                                    }
</div><div class="line" id="l1377">                                }
</div><div class="line" id="l1378">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1379">                                <span class="c">offs += 8;</span></div><div class="line" id="l1380">                            }
</div><div class="line" id="l1381">                        }
</div><div class="line" id="l1382">                        <span class="c">continue;</span></div><div class="line" id="l1383"><br></div><div class="line" id="l1384">                    case ClassDescriptor.FieldType.tpArrayOfDecimal: 
</div><div class="line" id="l1385">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1386">                        {
</div><div class="line" id="l1387">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1388">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1389">                            <span class="c">offs += 4;</span></div><div class="line" id="l1390">                        }
</div><div class="line" id="l1391">                        else
</div><div class="line" id="l1392">                        {
</div><div class="line" id="l1393">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1394">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1395">                            <span class="c">buf.extend(offs + 4 + len * 16);</span></div><div class="line" id="l1396">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1397">                            <span class="c">offs += 4;</span></div><div class="line" id="l1398">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1399">                            {
</div><div class="line" id="l1400">                                <span class="c">if (item.isStringValue())</span></div><div class="line" id="l1401">                                {
</div><div class="line" id="l1402">                                    try 
</div><div class="line" id="l1403">                                    { 
</div><div class="line" id="l1404">                                        <span class="c">Bytes.packDecimal(buf.arr, offs, Decimal.Parse(item.StringValue));</span></div><div class="line" id="l1405">                                    }
</div><div class="line" id="l1406">                                    <span class="c">catch (FormatException)</span></div><div class="line" id="l1407">                                    {
</div><div class="line" id="l1408">                                        <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1409">                                    }
</div><div class="line" id="l1410">                                }
</div><div class="line" id="l1411">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1412">                                <span class="c">offs += 16;</span></div><div class="line" id="l1413">                            }
</div><div class="line" id="l1414">                        }
</div><div class="line" id="l1415">                        <span class="c">continue;</span></div><div class="line" id="l1416"><br></div><div class="line" id="l1417">                    case ClassDescriptor.FieldType.tpArrayOfGuid: 
</div><div class="line" id="l1418">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1419">                        {
</div><div class="line" id="l1420">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1421">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1422">                            <span class="c">offs += 4;</span></div><div class="line" id="l1423">                        }
</div><div class="line" id="l1424">                        else
</div><div class="line" id="l1425">                        {
</div><div class="line" id="l1426">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1427">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1428">                            <span class="c">buf.extend(offs + 4 + len * 16);</span></div><div class="line" id="l1429">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1430">                            <span class="c">offs += 4;</span></div><div class="line" id="l1431">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1432">                            {
</div><div class="line" id="l1433">                                <span class="c">if (item.isStringValue())</span></div><div class="line" id="l1434">                                {
</div><div class="line" id="l1435">                                    try 
</div><div class="line" id="l1436">                                    { 
</div><div class="line" id="l1437">                                        <span class="c">Bytes.packGuid(buf.arr, offs, new Guid(item.StringValue));</span></div><div class="line" id="l1438">                                    }
</div><div class="line" id="l1439">                                    <span class="c">catch (FormatException)</span></div><div class="line" id="l1440">                                    {
</div><div class="line" id="l1441">                                        <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1442">                                    }
</div><div class="line" id="l1443">                                }
</div><div class="line" id="l1444">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1445">                                <span class="c">offs += 16;</span></div><div class="line" id="l1446">                            }
</div><div class="line" id="l1447">                        }
</div><div class="line" id="l1448">                        <span class="c">continue;</span></div><div class="line" id="l1449"><br></div><div class="line" id="l1450">                    case ClassDescriptor.FieldType.tpArrayOfString: 
</div><div class="line" id="l1451">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1452">                        {
</div><div class="line" id="l1453">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1454">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1455">                            <span class="c">offs += 4;</span></div><div class="line" id="l1456">                        }
</div><div class="line" id="l1457">                        else
</div><div class="line" id="l1458">                        {
</div><div class="line" id="l1459">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1460">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1461">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1462">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1463">                            <span class="c">offs += 4;</span></div><div class="line" id="l1464">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1465">                            {
</div><div class="line" id="l1466">                                <span class="c">System.String val = null;</span></div><div class="line" id="l1467">                                <span class="c">if (item.isIntValue())</span></div><div class="line" id="l1468">                                {
</div><div class="line" id="l1469">                                    <span class="c">val = System.Convert.ToString(item.IntValue);</span></div><div class="line" id="l1470">                                }
</div><div class="line" id="l1471">                                else <span class="c">if (item.isRealValue())</span></div><div class="line" id="l1472">                                {
</div><div class="line" id="l1473">                                    <span class="c">val = item.RealValue.ToString();</span></div><div class="line" id="l1474">                                }
</div><div class="line" id="l1475">                                else <span class="c">if (item.isStringValue())</span></div><div class="line" id="l1476">                                {
</div><div class="line" id="l1477">                                    <span class="c">val = item.StringValue;</span></div><div class="line" id="l1478">                                }
</div><div class="line" id="l1479">                                else <span class="c">if (item.isNullValue())</span></div><div class="line" id="l1480">                                {
</div><div class="line" id="l1481">                                    <span class="c">val = null;</span></div><div class="line" id="l1482">                                }
</div><div class="line" id="l1483">                                else
</div><div class="line" id="l1484">                                {
</div><div class="line" id="l1485">                                    <span class="c">throwException("Conversion for field " + fieldName + " is not possible");</span></div><div class="line" id="l1486">                                }
</div><div class="line" id="l1487">                                <span class="c">offs = buf.packString(offs, val);</span></div><div class="line" id="l1488">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1489">                            }
</div><div class="line" id="l1490">                        }
</div><div class="line" id="l1491">                        <span class="c">continue;</span></div><div class="line" id="l1492"><br></div><div class="line" id="l1493">                    case ClassDescriptor.FieldType.tpArrayOfObject: 
</div><div class="line" id="l1494">                    case ClassDescriptor.FieldType.tpArrayOfOid: 
</div><div class="line" id="l1495">                    case ClassDescriptor.FieldType.tpLink: 
</div><div class="line" id="l1496">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1497">                        {
</div><div class="line" id="l1498">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1499">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1500">                            <span class="c">offs += 4;</span></div><div class="line" id="l1501">                        }
</div><div class="line" id="l1502">                        else
</div><div class="line" id="l1503">                        {
</div><div class="line" id="l1504">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1505">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1506">                            <span class="c">buf.extend(offs + 4 + len * 4);</span></div><div class="line" id="l1507">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1508">                            <span class="c">offs += 4;</span></div><div class="line" id="l1509">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1510">                            {
</div><div class="line" id="l1511">                                <span class="c">XMLElement href = item.getSibling("ref");</span></div><div class="line" id="l1512">                                <span class="c">if (href == null)</span></div><div class="line" id="l1513">                                {
</div><div class="line" id="l1514">                                    <span class="c">throwException("&lt;ref&gt; element expected");</span></div><div class="line" id="l1515">                                }
</div><div class="line" id="l1516">                                <span class="c">int oid = mapId(getIntAttribute(href, "id"));</span></div><div class="line" id="l1517">                                <span class="c">Bytes.pack4(buf.arr, offs, oid);</span></div><div class="line" id="l1518">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1519">                                <span class="c">offs += 4;</span></div><div class="line" id="l1520">                            }
</div><div class="line" id="l1521">                        }
</div><div class="line" id="l1522">                        <span class="c">continue;</span></div><div class="line" id="l1523"><br></div><div class="line" id="l1524">                    case ClassDescriptor.FieldType.tpArrayOfValue: 
</div><div class="line" id="l1525">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1526">                        {
</div><div class="line" id="l1527">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1528">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1529">                            <span class="c">offs += 4;</span></div><div class="line" id="l1530">                        }
</div><div class="line" id="l1531">                        else
</div><div class="line" id="l1532">                        {
</div><div class="line" id="l1533">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1534">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1535">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1536">                            <span class="c">offs += 4;</span></div><div class="line" id="l1537">                            <span class="c">ClassDescriptor elemDesc = fd.valueDesc;</span></div><div class="line" id="l1538">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1539">                            {
</div><div class="line" id="l1540">                                <span class="c">offs = packObject(item, elemDesc, offs, buf);</span></div><div class="line" id="l1541">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1542">                            }
</div><div class="line" id="l1543">                        }
</div><div class="line" id="l1544">                        <span class="c">continue;</span></div><div class="line" id="l1545"><br></div><div class="line" id="l1546">#if SUPPORT_RAW_TYPE
</div><div class="line" id="l1547">                    case ClassDescriptor.FieldType.tpArrayOfRaw: 
</div><div class="line" id="l1548">                        <span class="c">if (elem == null || elem.isNullValue())</span></div><div class="line" id="l1549">                        {
</div><div class="line" id="l1550">                            <span class="c">buf.extend(offs + 4);</span></div><div class="line" id="l1551">                            <span class="c">Bytes.pack4(buf.arr, offs, - 1);</span></div><div class="line" id="l1552">                            <span class="c">offs += 4;</span></div><div class="line" id="l1553">                        }
</div><div class="line" id="l1554">                        else
</div><div class="line" id="l1555">                        {
</div><div class="line" id="l1556">                            <span class="c">XMLElement item = elem.getSibling("element");</span></div><div class="line" id="l1557">                            <span class="c">int len = (item == null)?0:item.Counter;</span></div><div class="line" id="l1558">                            <span class="c">Bytes.pack4(buf.arr, offs, len);</span></div><div class="line" id="l1559">                            <span class="c">offs += 4;</span></div><div class="line" id="l1560">                            <span class="c">while (--len &gt;= 0)</span></div><div class="line" id="l1561">                            {
</div><div class="line" id="l1562">                                <span class="c">offs = importBinary(item, offs, buf, fieldName);</span></div><div class="line" id="l1563">                                <span class="c">item = item.NextSibling;</span></div><div class="line" id="l1564">                            }
</div><div class="line" id="l1565">                        }
</div><div class="line" id="l1566">                        continue;
</div><div class="line" id="l1567">#endif		
</div><div class="line" id="l1568">                }
</div><div class="line" id="l1569">            }
</div><div class="line" id="l1570">            <span class="c">return offs;</span></div><div class="line" id="l1571">        }
</div><div class="line" id="l1572"><br></div><div class="line" id="l1573">        internal XMLElement readElement(System.String name)
</div><div class="line" id="l1574">        {
</div><div class="line" id="l1575">            <span class="c">XMLElement elem = new XMLElement(name);</span></div><div class="line" id="l1576">            System.String attribute;
</div><div class="line" id="l1577">            XMLScanner.Token tkn;
</div><div class="line" id="l1578">            while (true)
</div><div class="line" id="l1579">            {
</div><div class="line" id="l1580">                <span class="c">switch (scanner.scan())</span></div><div class="line" id="l1581">                {
</div><div class="line" id="l1582">                    case XMLScanner.Token.GTS: 
</div><div class="line" id="l1583">                        <span class="c">return elem;</span></div><div class="line" id="l1584"><br></div><div class="line" id="l1585">                    case XMLScanner.Token.GT: 
</div><div class="line" id="l1586">                        <span class="c">while ((tkn = scanner.scan()) == XMLScanner.Token.LT)</span></div><div class="line" id="l1587">                        {
</div><div class="line" id="l1588">                            <span class="c">if (scanner.scan() != XMLScanner.Token.IDENT)</span></div><div class="line" id="l1589">                            {
</div><div class="line" id="l1590">                                <span class="c">throwException("Element name expected");</span></div><div class="line" id="l1591">                            }
</div><div class="line" id="l1592">                            <span class="c">System.String siblingName = scanner.Identifier;</span></div><div class="line" id="l1593">                            <span class="c">XMLElement sibling = readElement(siblingName);</span></div><div class="line" id="l1594">                            <span class="c">elem.addSibling(sibling);</span></div><div class="line" id="l1595">                        }
</div><div class="line" id="l1596">                        <span class="c">switch (tkn)</span></div><div class="line" id="l1597">                        {
</div><div class="line" id="l1598">                            case XMLScanner.Token.SCONST: 
</div><div class="line" id="l1599">                                <span class="c">elem.StringValue = scanner.String;</span></div><div class="line" id="l1600">                                <span class="c">tkn = scanner.scan();</span></div><div class="line" id="l1601">                                <span class="c">break;</span></div><div class="line" id="l1602"><br></div><div class="line" id="l1603">                            case XMLScanner.Token.ICONST: 
</div><div class="line" id="l1604">                                <span class="c">elem.IntValue = scanner.Int;</span></div><div class="line" id="l1605">                                <span class="c">tkn = scanner.scan();</span></div><div class="line" id="l1606">                                <span class="c">break;</span></div><div class="line" id="l1607"><br></div><div class="line" id="l1608">                            case XMLScanner.Token.FCONST: 
</div><div class="line" id="l1609">                                <span class="c">elem.RealValue = scanner.Real;</span></div><div class="line" id="l1610">                                <span class="c">tkn = scanner.scan();</span></div><div class="line" id="l1611">                                <span class="c">break;</span></div><div class="line" id="l1612"><br></div><div class="line" id="l1613">                            case XMLScanner.Token.IDENT: 
</div><div class="line" id="l1614">                                <span class="c">if (scanner.Identifier.Equals("null"))</span></div><div class="line" id="l1615">                                {
</div><div class="line" id="l1616">                                    <span class="c">elem.setNullValue();</span></div><div class="line" id="l1617">                                }
</div><div class="line" id="l1618">                                else
</div><div class="line" id="l1619">                                {
</div><div class="line" id="l1620">                                    <span class="c">elem.StringValue = scanner.Identifier;</span></div><div class="line" id="l1621">                                }
</div><div class="line" id="l1622">                                <span class="c">tkn = scanner.scan();</span></div><div class="line" id="l1623">                                break;
</div><div class="line" id="l1624"><br></div><div class="line" id="l1625">                        }
</div><div class="line" id="l1626">                        <span class="c">if (tkn != XMLScanner.Token.LTS || scanner.scan() != XMLScanner.Token.IDENT || !scanner.Identifier.Equals(name) || scanner.scan() != XMLScanner.Token.GT)</span></div><div class="line" id="l1627">                        {
</div><div class="line" id="l1628">                            <span class="c">throwException("Element is not closed");</span></div><div class="line" id="l1629">                        }
</div><div class="line" id="l1630">                        <span class="c">return elem;</span></div><div class="line" id="l1631"><br></div><div class="line" id="l1632">                    case XMLScanner.Token.IDENT: 
</div><div class="line" id="l1633">                        <span class="c">attribute = scanner.Identifier;</span></div><div class="line" id="l1634">                        <span class="c">if (scanner.scan() != XMLScanner.Token.EQ || scanner.scan() != XMLScanner.Token.SCONST)</span></div><div class="line" id="l1635">                        {
</div><div class="line" id="l1636">                            <span class="c">throwException("Attribute value expected");</span></div><div class="line" id="l1637">                        }
</div><div class="line" id="l1638">                        <span class="c">elem.addAttribute(attribute, scanner.String);</span></div><div class="line" id="l1639">                        <span class="c">continue;</span></div><div class="line" id="l1640"><br></div><div class="line" id="l1641">                    default: 
</div><div class="line" id="l1642">                        <span class="c">throwException("Unexpected token");</span></div><div class="line" id="l1643">                        <span class="c">break;</span></div><div class="line" id="l1644"><br></div><div class="line" id="l1645">                }
</div><div class="line" id="l1646">            }
</div><div class="line" id="l1647">        }
</div><div class="line" id="l1648"><br></div><div class="line" id="l1649">        internal void  throwException(System.String message)
</div><div class="line" id="l1650">        {
</div><div class="line" id="l1651">            throw new XMLImportException(scanner.Line, scanner.Column, message);
</div><div class="line" id="l1652">        }
</div><div class="line" id="l1653"><br></div><div class="line" id="l1654">        internal StorageImpl storage;
</div><div class="line" id="l1655">        internal XMLScanner  scanner;
</div><div class="line" id="l1656">        internal Hashtable   classMap;
</div><div class="line" id="l1657">        internal int[] idMap; 
</div><div class="line" id="l1658"><br></div><div class="line" id="l1659">        internal class XMLScanner
</div><div class="line" id="l1660">        {
</div><div class="line" id="l1661">            internal virtual System.String Identifier
</div><div class="line" id="l1662">            {
</div><div class="line" id="l1663">                get
</div><div class="line" id="l1664">                {
</div><div class="line" id="l1665">                    <span class="c">return ident;</span></div><div class="line" id="l1666">                }
</div><div class="line" id="l1667">            }
</div><div class="line" id="l1668"><br></div><div class="line" id="l1669">            internal virtual System.String String
</div><div class="line" id="l1670">            {
</div><div class="line" id="l1671">                get
</div><div class="line" id="l1672">                {
</div><div class="line" id="l1673">                    <span class="c">return new String(sconst, 0, slen);</span></div><div class="line" id="l1674">                }
</div><div class="line" id="l1675">            }
</div><div class="line" id="l1676"><br></div><div class="line" id="l1677">            internal virtual long Int
</div><div class="line" id="l1678">            {
</div><div class="line" id="l1679">                get
</div><div class="line" id="l1680">                {
</div><div class="line" id="l1681">                    <span class="c">return iconst;</span></div><div class="line" id="l1682">                }
</div><div class="line" id="l1683">            }
</div><div class="line" id="l1684"><br></div><div class="line" id="l1685">            internal virtual double Real
</div><div class="line" id="l1686">            {
</div><div class="line" id="l1687">                get
</div><div class="line" id="l1688">                {
</div><div class="line" id="l1689">                    return fconst;
</div><div class="line" id="l1690">                }
</div><div class="line" id="l1691">            }
</div><div class="line" id="l1692"><br></div><div class="line" id="l1693">            internal virtual int Line
</div><div class="line" id="l1694">            {
</div><div class="line" id="l1695">                get
</div><div class="line" id="l1696">                {
</div><div class="line" id="l1697">                    return line;
</div><div class="line" id="l1698">                }
</div><div class="line" id="l1699">            }
</div><div class="line" id="l1700"><br></div><div class="line" id="l1701">            internal virtual int Column
</div><div class="line" id="l1702">            {
</div><div class="line" id="l1703">                get
</div><div class="line" id="l1704">                {
</div><div class="line" id="l1705">                    return column;
</div><div class="line" id="l1706">                }
</div><div class="line" id="l1707">            }
</div><div class="line" id="l1708"><br></div><div class="line" id="l1709">            internal enum Token 
</div><div class="line" id="l1710">            {
</div><div class="line" id="l1711">                IDENT,
</div><div class="line" id="l1712">                SCONST,
</div><div class="line" id="l1713">                ICONST,
</div><div class="line" id="l1714">                FCONST,
</div><div class="line" id="l1715">                LT,
</div><div class="line" id="l1716">                GT,
</div><div class="line" id="l1717">                LTS,
</div><div class="line" id="l1718">                GTS,
</div><div class="line" id="l1719">                EQ,
</div><div class="line" id="l1720">                EOF
</div><div class="line" id="l1721">            }
</div><div class="line" id="l1722"><br></div><div class="line" id="l1723">            internal System.IO.StreamReader reader;
</div><div class="line" id="l1724">            internal int    line;
</div><div class="line" id="l1725">            internal int    column;
</div><div class="line" id="l1726">            internal char[] sconst;
</div><div class="line" id="l1727">            internal long   iconst;
</div><div class="line" id="l1728">            internal double fconst;
</div><div class="line" id="l1729">            internal int    slen;
</div><div class="line" id="l1730">            internal String ident;
</div><div class="line" id="l1731">            internal int    size;
</div><div class="line" id="l1732">            internal int    ungetChar;
</div><div class="line" id="l1733">            internal bool   hasUngetChar;
</div><div class="line" id="l1734"><br></div><div class="line" id="l1735">            <span class="c">internal XMLScanner(System.IO.StreamReader reader)</span></div><div class="line" id="l1736">            {
</div><div class="line" id="l1737">                <span class="c">this.reader = reader;</span></div><div class="line" id="l1738">                <span class="c">sconst = new char[size = 1024];</span></div><div class="line" id="l1739">                <span class="c">line = 1;</span></div><div class="line" id="l1740">                <span class="c">column = 0;</span></div><div class="line" id="l1741">                <span class="c">hasUngetChar = false;</span></div><div class="line" id="l1742">            <span class="c">}</span></div><div class="line" id="l1743"><br></div><div class="line" id="l1744">            internal int get()
</div><div class="line" id="l1745">            {
</div><div class="line" id="l1746">                <span class="c">if (hasUngetChar)</span></div><div class="line" id="l1747">                {
</div><div class="line" id="l1748">                    <span class="c">hasUngetChar = false;</span></div><div class="line" id="l1749">                    <span class="c">return ungetChar;</span></div><div class="line" id="l1750">                }
</div><div class="line" id="l1751">                <span class="c">int ch = reader.Read();</span></div><div class="line" id="l1752">                <span class="c">if (ch == '\n')</span></div><div class="line" id="l1753">                {
</div><div class="line" id="l1754">                    <span class="c">line += 1;</span></div><div class="line" id="l1755">                    <span class="c">column = 0;</span></div><div class="line" id="l1756">                }
</div><div class="line" id="l1757">                else <span class="c">if (ch == '\t')</span></div><div class="line" id="l1758">                {
</div><div class="line" id="l1759">                    <span class="c">column += (column + 8) &amp; ~ 7;</span></div><div class="line" id="l1760">                }
</div><div class="line" id="l1761">                else
</div><div class="line" id="l1762">                {
</div><div class="line" id="l1763">                    <span class="c">column += 1;</span></div><div class="line" id="l1764">                }
</div><div class="line" id="l1765">                <span class="c">return ch;</span></div><div class="line" id="l1766">            }
</div><div class="line" id="l1767"><br></div><div class="line" id="l1768">            internal void unget(int ch)
</div><div class="line" id="l1769">            {
</div><div class="line" id="l1770">                <span class="c">if (ch == '\n')</span></div><div class="line" id="l1771">                {
</div><div class="line" id="l1772">                    <span class="c">line -= 1;</span></div><div class="line" id="l1773">                }
</div><div class="line" id="l1774">                else
</div><div class="line" id="l1775">                {
</div><div class="line" id="l1776">                    <span class="c">column -= 1;</span></div><div class="line" id="l1777">                }
</div><div class="line" id="l1778">                <span class="c">ungetChar = ch;</span></div><div class="line" id="l1779">                <span class="c">hasUngetChar = true;</span></div><div class="line" id="l1780">            <span class="c">}</span></div><div class="line" id="l1781"><br></div><div class="line" id="l1782">            internal Token scan()
</div><div class="line" id="l1783">            {
</div><div class="line" id="l1784">                int i, ch;
</div><div class="line" id="l1785">                bool floatingPoint;
</div><div class="line" id="l1786"><br></div><div class="line" id="l1787">                while (true)
</div><div class="line" id="l1788">                {
</div><div class="line" id="l1789">                    do 
</div><div class="line" id="l1790">                    {
</div><div class="line" id="l1791">                        <span class="c">if ((ch = get()) &lt; 0)</span></div><div class="line" id="l1792">                        {
</div><div class="line" id="l1793">                            <span class="c">return Token.EOF;</span></div><div class="line" id="l1794">                        }
</div><div class="line" id="l1795">                    }
</div><div class="line" id="l1796">                    <span class="c">while (ch &lt;= ' ');</span></div><div class="line" id="l1797"><br></div><div class="line" id="l1798">                    <span class="c">switch (ch)</span></div><div class="line" id="l1799">                    {
</div><div class="line" id="l1800">                        case '&lt;': 
</div><div class="line" id="l1801">                            <span class="c">ch = get();</span></div><div class="line" id="l1802">                            <span class="c">if (ch == '?')</span></div><div class="line" id="l1803">                            {
</div><div class="line" id="l1804">                                <span class="c">while ((ch = get()) != '?')</span></div><div class="line" id="l1805">                                {
</div><div class="line" id="l1806">                                    <span class="c">if (ch &lt; 0)</span></div><div class="line" id="l1807">                                    {
</div><div class="line" id="l1808">                                        <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1809">                                    }
</div><div class="line" id="l1810">                                }
</div><div class="line" id="l1811">                                <span class="c">if ((ch = get()) != '&gt;')</span></div><div class="line" id="l1812">                                {
</div><div class="line" id="l1813">                                    <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1814">                                }
</div><div class="line" id="l1815">                                continue;
</div><div class="line" id="l1816">                            }
</div><div class="line" id="l1817">                            <span class="c">if (ch != '/')</span></div><div class="line" id="l1818">                            {
</div><div class="line" id="l1819">                                <span class="c">unget(ch);</span></div><div class="line" id="l1820">                                <span class="c">return Token.LT;</span></div><div class="line" id="l1821">                            }
</div><div class="line" id="l1822">                            <span class="c">return Token.LTS;</span></div><div class="line" id="l1823"><br></div><div class="line" id="l1824">                        case '&gt;': 
</div><div class="line" id="l1825">                            <span class="c">return Token.GT;</span></div><div class="line" id="l1826"><br></div><div class="line" id="l1827">                        case '/': 
</div><div class="line" id="l1828">                            <span class="c">ch = get();</span></div><div class="line" id="l1829">                            <span class="c">if (ch != '&gt;')</span></div><div class="line" id="l1830">                            {
</div><div class="line" id="l1831">                                <span class="c">unget(ch);</span></div><div class="line" id="l1832">                                <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1833">                            }
</div><div class="line" id="l1834">                            <span class="c">return Token.GTS;</span></div><div class="line" id="l1835"><br></div><div class="line" id="l1836">                        case '=': 
</div><div class="line" id="l1837">                            <span class="c">return Token.EQ;</span></div><div class="line" id="l1838"><br></div><div class="line" id="l1839">                        case '"': 
</div><div class="line" id="l1840">                            <span class="c">i = 0;</span></div><div class="line" id="l1841">                            <span class="c">while (true)</span></div><div class="line" id="l1842">                            {
</div><div class="line" id="l1843">                                <span class="c">ch = get();</span></div><div class="line" id="l1844">                                <span class="c">if (ch &lt; 0)</span></div><div class="line" id="l1845">                                {
</div><div class="line" id="l1846">                                    <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1847">                                }
</div><div class="line" id="l1848">                                else <span class="c">if (ch == '&amp;')</span></div><div class="line" id="l1849">                                {
</div><div class="line" id="l1850">                                    <span class="c">switch (get())</span></div><div class="line" id="l1851">                                    {
</div><div class="line" id="l1852">                                        case 'a': 
</div><div class="line" id="l1853">                                            <span class="c">if (get() != 'm' || get() != 'p' || get() != ';')</span></div><div class="line" id="l1854">                                            {
</div><div class="line" id="l1855">                                                <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1856">                                            }
</div><div class="line" id="l1857">                                            <span class="c">ch = '&amp;';</span></div><div class="line" id="l1858">                                            <span class="c">break;</span></div><div class="line" id="l1859"><br></div><div class="line" id="l1860">                                        case 'l': 
</div><div class="line" id="l1861">                                            <span class="c">if (get() != 't' || get() != ';')</span></div><div class="line" id="l1862">                                            {
</div><div class="line" id="l1863">                                                <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1864">                                            }
</div><div class="line" id="l1865">                                            <span class="c">ch = '&lt;';</span></div><div class="line" id="l1866">                                            <span class="c">break;</span></div><div class="line" id="l1867"><br></div><div class="line" id="l1868">                                        case 'g': 
</div><div class="line" id="l1869">                                            <span class="c">if (get() != 't' || get() != ';')</span></div><div class="line" id="l1870">                                            {
</div><div class="line" id="l1871">                                                <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1872">                                            }
</div><div class="line" id="l1873">                                            <span class="c">ch = '&gt;';</span></div><div class="line" id="l1874">                                            <span class="c">break;</span></div><div class="line" id="l1875"><br></div><div class="line" id="l1876">                                        case 'q': 
</div><div class="line" id="l1877">                                            <span class="c">if (get() != 'u' || get() != 'o' || get() != 't' || get() != ';')</span></div><div class="line" id="l1878">                                            {
</div><div class="line" id="l1879">                                                <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1880">                                            }
</div><div class="line" id="l1881">                                            <span class="c">ch = '"';</span></div><div class="line" id="l1882">                                            <span class="c">break;</span></div><div class="line" id="l1883"><br></div><div class="line" id="l1884">                                        default: 
</div><div class="line" id="l1885">                                            <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1886"><br></div><div class="line" id="l1887">                                    }
</div><div class="line" id="l1888">                                }
</div><div class="line" id="l1889">                                else <span class="c">if (ch == '"')</span></div><div class="line" id="l1890">                                {
</div><div class="line" id="l1891">                                    <span class="c">slen = i;</span></div><div class="line" id="l1892">                                    <span class="c">return Token.SCONST;</span></div><div class="line" id="l1893">                                }
</div><div class="line" id="l1894">                                <span class="c">if (i == size)</span></div><div class="line" id="l1895">                                {
</div><div class="line" id="l1896">                                    <span class="c">char[] newBuf = new char[size *= 2];</span></div><div class="line" id="l1897">                                    <span class="c">Array.Copy(sconst, 0, newBuf, 0, i);</span></div><div class="line" id="l1898">                                    <span class="c">sconst = newBuf;</span></div><div class="line" id="l1899">                                }
</div><div class="line" id="l1900">                                <span class="c">sconst[i++] = (char) ch;</span></div><div class="line" id="l1901">                            }
</div><div class="line" id="l1902"><br></div><div class="line" id="l1903">                        case '-': case '0': case '1': case '2': case '3': case '4': case '5': case '6': case '7': case '8': case '9': 
</div><div class="line" id="l1904">                            <span class="c">i = 0;</span></div><div class="line" id="l1905">                            <span class="c">floatingPoint = false;</span></div><div class="line" id="l1906">                            <span class="c">while (true)</span></div><div class="line" id="l1907">                            {
</div><div class="line" id="l1908">                                <span class="c">if (!System.Char.IsDigit((char) ch) &amp;&amp; ch != '-' &amp;&amp; ch != '+' &amp;&amp; ch != '.' &amp;&amp; ch != 'E')</span></div><div class="line" id="l1909">                                {
</div><div class="line" id="l1910">                                    <span class="c">unget(ch);</span></div><div class="line" id="l1911">                                    try
</div><div class="line" id="l1912">                                    {
</div><div class="line" id="l1913">                                        <span class="c">if (floatingPoint)</span></div><div class="line" id="l1914">                                        {
</div><div class="line" id="l1915">                                            <span class="c">fconst = System.Double.Parse(new String(sconst, 0, i));</span></div><div class="line" id="l1916">                                            <span class="c">return Token.FCONST;</span></div><div class="line" id="l1917">                                        }
</div><div class="line" id="l1918">                                        else
</div><div class="line" id="l1919">                                        {
</div><div class="line" id="l1920">                                            <span class="c">iconst = sconst[0] == '-' ? System.Int64.Parse(new String(sconst, 0, i))</span></div><div class="line" id="l1921">                                                : (long)System.UInt64.Parse(new String(sconst, 0, i))<span class="c">;</span></div><div class="line" id="l1922">                                            <span class="c">return Token.ICONST;</span></div><div class="line" id="l1923">                                        }
</div><div class="line" id="l1924">                                    }
</div><div class="line" id="l1925">                                    <span class="c">catch (System.FormatException)</span></div><div class="line" id="l1926">                                    {
</div><div class="line" id="l1927">                                        <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1928">                                    }
</div><div class="line" id="l1929">                                }
</div><div class="line" id="l1930">                                <span class="c">if (i == size)</span></div><div class="line" id="l1931">                                {
</div><div class="line" id="l1932">                                    <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1933">                                }
</div><div class="line" id="l1934">                                <span class="c">sconst[i++] = (char) ch;</span></div><div class="line" id="l1935">                                <span class="c">if (ch == '.')</span></div><div class="line" id="l1936">                                {
</div><div class="line" id="l1937">                                    <span class="c">floatingPoint = true;</span></div><div class="line" id="l1938">                                }
</div><div class="line" id="l1939">                                <span class="c">ch = get();</span></div><div class="line" id="l1940">                            }
</div><div class="line" id="l1941"><br></div><div class="line" id="l1942">                        default: 
</div><div class="line" id="l1943">                            <span class="c">i = 0;</span></div><div class="line" id="l1944">                            <span class="c">while (System.Char.IsLetterOrDigit((char) ch) || ch == '-' || ch == ':' || ch == '_' || ch == '.')</span></div><div class="line" id="l1945">                            {
</div><div class="line" id="l1946">                                <span class="c">if (i == size)</span></div><div class="line" id="l1947">                                {
</div><div class="line" id="l1948">                                    <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1949">                                }
</div><div class="line" id="l1950">                                <span class="c">if (ch == '-')</span></div><div class="line" id="l1951">                                { 
</div><div class="line" id="l1952">                                    <span class="c">ch = '+';</span></div><div class="line" id="l1953">                                }
</div><div class="line" id="l1954">                                <span class="c">sconst[i++] = (char) ch;</span></div><div class="line" id="l1955">                                <span class="c">ch = get();</span></div><div class="line" id="l1956">                            }
</div><div class="line" id="l1957">                            <span class="c">unget(ch);</span></div><div class="line" id="l1958">                            <span class="c">if (i == 0)</span></div><div class="line" id="l1959">                            {
</div><div class="line" id="l1960">                                <span class="c">throw new XMLImportException(line, column, "Bad XML file format");</span></div><div class="line" id="l1961">                            }
</div><div class="line" id="l1962">                            <span class="c">ident = new String(sconst, 0, i);</span></div><div class="line" id="l1963">                            <span class="c">ident = ident.Replace(".1", "`");</span></div><div class="line" id="l1964">                            <span class="c">ident = ident.Replace(".2", ",");</span></div><div class="line" id="l1965">                            <span class="c">ident = ident.Replace(".3", "[");</span></div><div class="line" id="l1966">                            <span class="c">ident = ident.Replace(".4", "]");</span></div><div class="line" id="l1967">                            <span class="c">ident = ident.Replace(".5", "=");</span></div><div class="line" id="l1968">                            <span class="c">return Token.IDENT;</span></div><div class="line" id="l1969">                    }
</div><div class="line" id="l1970">                }
</div><div class="line" id="l1971">            <span class="c">}</span></div><div class="line" id="l1972">        }
</div><div class="line" id="l1973">    }
</div><div class="line" id="l1974">}
</div><div class="line" id="l1975">#endif
</div><div class="line" id="l1976"><br></div>
  </pre>
  </td>
  </tr>
</tbody>
</table>
</body>
</html>